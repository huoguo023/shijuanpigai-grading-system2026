<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3.2 ç”¨æ°”çƒé©±åŠ¨å°è½¦ - å…¨å•å…ƒé—¯å…³æµ‹è¯•</title>
    <style>
        :root {
            --primary: #3F51B5; /* ä¿æŒç¬¬ä¸€è¯¾ä¸»è‰²è°ƒ */
            --accent: #FF4081;  /* ä¿æŒç¬¬ä¸€è¯¾å¼ºè°ƒè‰² */
            --bg: #f0f2f5;
            --card: #ffffff;
            --text: #333;
            --success: #4CAF50;
            --error: #F44336;
        }

        body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 50px; }
        
        /* Header & Layout */
        header { background: linear-gradient(135deg, var(--primary), #1A237E); color: white; padding: 2rem 1rem; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .container { max-width: 900px; margin: -30px auto 0; padding: 0 15px; position: relative; z-index: 2; }
        
        .section-title { border-left: 5px solid var(--accent); padding-left: 15px; margin: 40px 0 20px; font-size: 1.5rem; color: #444; }

        /* Cards */
        .card { background: var(--card); border-radius: 12px; padding: 25px; margin-bottom: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        
        /* --- Review Section (SVG Animations) --- */
        .demo-box { background: #e8eaf6; border-radius: 8px; padding: 15px; margin-top: 15px; text-align: center; border: 1px solid #c5cae9; }
        .demo-controls button { background: var(--primary); color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 5px; transition: 0.2s; }
        .demo-controls button:hover { background: #303F9F; transform: scale(1.05); }
        
        /* Specific Animation Styles for Lesson 2 */
        .air-stream { stroke-dasharray: 5; animation: dash 0.5s linear infinite; opacity: 0; }
        @keyframes dash { to { stroke-dashoffset: -10; } }

        /* --- Quiz Section --- */
        .quiz-status { background: #333; color: white; padding: 15px; border-radius: 8px 8px 0 0; display: flex; justify-content: space-between; font-weight: bold; }
        
        .question-item { padding: 20px 0; border-bottom: 1px solid #eee; }
        .q-badge { display: inline-block; padding: 2px 8px; border-radius: 4px; color: white; font-size: 0.75rem; margin-right: 8px; vertical-align: middle; }
        .badge-choice { background: #2196F3; }
        .badge-fill { background: #9C27B0; }
        .badge-drag { background: #FF9800; }
        .badge-exp { background: #E91E63; }
        
        .q-content { font-weight: 600; font-size: 1.05rem; display: inline; vertical-align: middle; }
        
        /* Form Inputs */
        .options label { display: block; padding: 8px 12px; margin: 5px 0; background: #f9f9f9; border-radius: 6px; cursor: pointer; transition: 0.2s; }
        .options label:hover { background: #e3f2fd; }
        .options input { margin-right: 10px; }
        
        input[type="text"] { border: 1px solid #ccc; padding: 8px; border-radius: 4px; width: 200px; }
        
        /* Drag & Drop Styles */
        .drag-container { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
        .drop-zone { flex: 1; min-width: 120px; border: 2px dashed #bbb; background: #fafafa; padding: 10px; border-radius: 6px; }
        .drop-zone h4 { margin: 0 0 8px 0; text-align: center; color: #666; font-size: 0.9rem; }
        .drag-pool { margin-top: 10px; padding: 10px; background: #eee; border-radius: 6px; display: flex; gap: 8px; flex-wrap: wrap; }
        .drag-item { background: white; padding: 5px 10px; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; user-select: none; font-size: 0.9rem; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .drag-item.selected { border-color: var(--primary); background: #e8eaf6; box-shadow: 0 0 0 2px var(--primary); }

        /* Experiment Question Specifics */
        .exp-box { border: 2px solid #E91E63; border-radius: 8px; padding: 15px; margin-top: 15px; background: #fce4ec; }
        .exp-img-container { background: white; border: 1px solid #ddd; padding: 10px; text-align: center; margin-bottom: 15px; border-radius: 4px; }
        .exp-part { margin-bottom: 12px; }
        .exp-label { display: block; font-weight: bold; color: #880E4F; font-size: 0.9rem; margin-bottom: 4px; }
        textarea { width: 100%; height: 60px; border: 1px solid #ccc; border-radius: 4px; padding: 8px; font-family: inherit; resize: vertical; }

        /* Submit Button */
        .btn-submit { display: block; width: 100%; max-width: 300px; margin: 40px auto; padding: 15px; background: var(--success); color: white; border: none; border-radius: 50px; font-size: 1.2rem; cursor: pointer; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4); transition: transform 0.2s; }
        .btn-submit:hover { transform: scale(1.03); }

        /* Results Overlay */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 1000; overflow-y: auto; }
        .modal-content { background: white; margin: 5vh auto; width: 90%; max-width: 800px; padding: 30px; border-radius: 12px; position: relative; }
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 2rem; cursor: pointer; color: #999; }
        .score-display { text-align: center; font-size: 3rem; color: var(--primary); font-weight: bold; margin: 20px 0; }
        .analysis-card { background: #ffebee; border-left: 4px solid var(--error); padding: 15px; margin-bottom: 15px; }
        .analysis-card strong { display: block; margin-bottom: 5px; }
        .correct-answer { color: var(--success); font-weight: bold; margin-top: 5px; display: block; }
        
    </style>

    <!-- å³æ—¶åé¦ˆç³»ç»Ÿ -->
    <style>
    .feedback-toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px); background: white; padding: 15px 25px; border-radius: 50px; box-shadow: 0 8px 30px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 12px; z-index: 10000; opacity: 0; transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55); font-size: 1.1rem; font-weight: bold; }
    .feedback-toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    .feedback-success { border: 3px solid #4CAF50; color: #2E7D32; }
    .feedback-error { border: 3px solid #FF9800; color: #E65100; }
    .toast-icon { width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; font-weight: bold; }
    .feedback-success .toast-icon { background: #4CAF50; color: white; }
    .feedback-error .toast-icon { background: #FF9800; color: white; }
    .confetti { position: fixed; width: 10px; height: 10px; z-index: 9999; pointer-events: none; }
    @keyframes confetti-fall { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
    @keyframes correct-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); } 20%, 40%, 60%, 80% { transform: translateX(8px); } }
    .option-item.correct-feedback { animation: correct-pulse 0.6s; background: #E8F5E9 !important; border-color: #4CAF50 !important; box-shadow: 0 0 20px rgba(76, 175, 80, 0.3) !important; }
    .option-item.wrong-feedback { animation: shake 0.5s; background: #FFF3E0 !important; border-color: #FF9800 !important; }
    input[type="text"].correct-feedback { animation: correct-pulse 0.6s; background: #E8F5E9 !important; border-color: #4CAF50 !important; }
    input[type="text"].wrong-feedback { animation: shake 0.5s; background: #FFF3E0 !important; border-color: #FF9800 !important; }
    </style>
</head>
<body>

<header>
    <h1>ç¬¬ä¸‰å•å…ƒ ç¬¬äºŒè¯¾ã€Šç”¨æ°”çƒé©±åŠ¨å°è½¦ã€‹</h1>
    <p>å¤ä¹ æ¼”ç¤º & 100åˆ†é—¯å…³æµ‹è¯•</p>
</header>

<div class="container">

    <!-- PART 1: REVIEW SECTION -->
    <div class="section-title">ä¸€ã€ çŸ¥è¯†å¤ä¹ ä¸æ¼”ç¤º</div>
    
    <div class="card">
        <h3>1. åå†²åŠ›åŸç† (Action & Reaction)</h3>
        <p>æŠŠæ°”çƒå¹è¶³æ°”åæ¾å¼€å£éƒ¨ï¼Œæ°”ä½“å‘<strong>å</strong>å–·å‡ºï¼Œæ°”çƒå‘<strong>å‰</strong>è¿åŠ¨ã€‚</p>
        <p><strong>å®šä¹‰ï¼š</strong>æ°”çƒé‡Œçš„æ°”ä½“å–·å‡ºæ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªå’Œå–·å‡ºæ–¹å‘ç›¸åçš„æ¨åŠ›ï¼Œè¿™ä¸ªåŠ›å«<strong>åå†²åŠ›</strong>ã€‚</p>
        <div class="demo-box">
            <svg id="svg-recoil" viewBox="0 0 350 140" width="100%" height="140" style="background:linear-gradient(to bottom, #E8EAF6 0%, #F5F5F5 100%); border-radius:10px;">
                <defs>
                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L0,6 L9,3 z" fill="#F44336" /></marker>
                    <marker id="arrow-blue" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L0,6 L9,3 z" fill="#2196F3" /></marker>
                    <radialGradient id="balloonGrad">
                        <stop offset="0%" style="stop-color:#FF80AB"/>
                        <stop offset="50%" style="stop-color:#FF4081"/>
                        <stop offset="100%" style="stop-color:#C51162"/>
                    </radialGradient>
                    <linearGradient id="carGrad2" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#5C6BC0"/>
                        <stop offset="100%" style="stop-color:#3F51B5"/>
                    </linearGradient>
                    <radialGradient id="wheelGrad2">
                        <stop offset="0%" style="stop-color:#616161"/>
                        <stop offset="60%" style="stop-color:#424242"/>
                        <stop offset="100%" style="stop-color:#212121"/>
                    </radialGradient>
                </defs>
                
                <!-- åœ°é¢å‚è€ƒçº¿ -->
                <line x1="20" y1="100" x2="330" y2="100" stroke="#BDBDBD" stroke-dasharray="5,3" stroke-width="2"/>
                <text x="25" y="115" font-size="10" fill="#757575">åœ°é¢</text>
                
                <!-- æ°”çƒå°è½¦ç»„ -->
                <g id="demo-car-group" transform="translate(175, 50)">
                    <!-- æ°”çƒ -->
                    <ellipse id="anim-balloon" cx="0" cy="0" rx="45" ry="32" fill="url(#balloonGrad)" stroke="#C51162" stroke-width="1.5"/>
                    <ellipse cx="-10" cy="-8" rx="12" ry="15" fill="#FFE0F0" opacity="0.4"/>
                    
                    <!-- æ°”çƒå£ -->
                    <rect x="-48" y="-6" width="12" height="12" fill="#FF4081" rx="2"/>
                    <rect x="-50" y="-4" width="4" height="8" fill="#C51162"/>
                    
                    <!-- æ°”æµçº¿ï¼ˆåˆå§‹éšè—ï¼‰ -->
                    <g id="air-stream" opacity="0">
                        <path d="M-52,-2 Q-65,-2 -75,-2" stroke="#64B5F6" stroke-width="3" fill="none" opacity="0.7">
                            <animate attributeName="stroke-dashoffset" from="0" to="-20" dur="0.3s" repeatCount="indefinite"/>
                        </path>
                        <path d="M-52,0 Q-65,0 -75,0" stroke="#42A5F5" stroke-width="4" fill="none" opacity="0.8" stroke-dasharray="5,3">
                            <animate attributeName="stroke-dashoffset" from="0" to="-20" dur="0.25s" repeatCount="indefinite"/>
                        </path>
                        <path d="M-52,2 Q-65,2 -75,2" stroke="#2196F3" stroke-width="3" fill="none" opacity="0.7">
                            <animate attributeName="stroke-dashoffset" from="0" to="-20" dur="0.35s" repeatCount="indefinite"/>
                        </path>
                    </g>
                    
                    <!-- å°è½¦è½¦èº« -->
                    <rect x="-25" y="25" width="50" height="20" fill="url(#carGrad2)" rx="4" stroke="#1A237E" stroke-width="1.5"/>
                    <rect x="-20" y="28" width="40" height="10" fill="#C5CAE9" opacity="0.5" rx="2"/>
                    
                    <!-- è½¦è½® -->
                    <circle cx="-18" cy="45" r="6" fill="url(#wheelGrad2)" stroke="#212121" stroke-width="1"/>
                    <circle cx="-18" cy="45" r="3" fill="#757575"/>
                    <line x1="-18" y1="42" x2="-18" y2="48" stroke="#424242" stroke-width="0.5"/>
                    <line x1="-21" y1="45" x2="-15" y2="45" stroke="#424242" stroke-width="0.5"/>
                    
                    <circle cx="18" cy="45" r="6" fill="url(#wheelGrad2)" stroke="#212121" stroke-width="1"/>
                    <circle cx="18" cy="45" r="3" fill="#757575"/>
                    <line x1="18" y1="42" x2="18" y2="48" stroke="#424242" stroke-width="0.5"/>
                    <line x1="15" y1="45" x2="21" y2="45" stroke="#424242" stroke-width="0.5"/>
                </g>

                <!-- åŠ›çš„ç®­å¤´ï¼ˆåˆå§‹éšè—ï¼‰ -->
                <g id="demo-arrows" opacity="0">
                    <!-- æ°”ä½“å‘åç®­å¤´ -->
                    <line x1="120" y1="50" x2="75" y2="50" stroke="#2196F3" stroke-width="4" marker-end="url(#arrow-blue)"/>
                    <text x="50" y="42" fill="#1976D2" font-size="13" font-weight="bold">æ°”ä½“å‘å</text>
                    <text x="55" y="55" fill="#1976D2" font-size="10">å–·æ°”æ–¹å‘</text>

                    <!-- å°è½¦å‘å‰ç®­å¤´ -->
                    <line x1="230" y1="50" x2="275" y2="50" stroke="#F44336" stroke-width="4" marker-end="url(#arrow)"/>
                    <text x="255" y="42" fill="#D32F2F" font-size="13" font-weight="bold">å°è½¦å‘å‰</text>
                    <text x="255" y="55" fill="#D32F2F" font-size="10">åå†²åŠ›</text>
                </g>
                
                <!-- è¯´æ˜æ–‡å­— -->
                <text x="175" y="130" text-anchor="middle" font-size="12" fill="#5E35B1" font-weight="bold">ä½œç”¨åŠ›ä¸åä½œç”¨åŠ›æ–¹å‘ç›¸å</text>
            </svg>
            <div class="demo-controls">
                <button onclick="playRecoil()">â–¶ï¸ æ¼”ç¤ºåå†²åŠ›</button>
            </div>
        </div>
    </div>

    <div class="card">
        <h3>2. å½±å“è¡Œé©¶è·ç¦»çš„å› ç´ </h3>
        <ul>
            <li><strong>æ°”çƒå¤§å°ï¼š</strong> æ°”çƒè¶Šå¤§ -> èƒ½é‡è¶Šå¤š -> è·ç¦»è¶Šè¿œã€‚</li>
            <li><strong>å–·ç®¡ç²—ç»†ï¼š</strong> ç²—ç®¡åŠ¨åŠ›å¤§ä½†æ—¶é—´çŸ­ï¼›ç»†ç®¡åŠ¨åŠ›å°ä½†æ—¶é—´é•¿ã€‚</li>
        </ul>
        <div class="demo-box">
            <svg viewBox="0 0 380 160" width="100%" height="160" style="background:linear-gradient(to bottom, #FFF3E0 0%, #F5F5F5 100%); border-radius:10px;">
                <defs>
                    <linearGradient id="nozzleGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#BDBDBD"/>
                        <stop offset="50%" style="stop-color:#E0E0E0"/>
                        <stop offset="100%" style="stop-color:#BDBDBD"/>
                    </linearGradient>
                    <radialGradient id="balloonGrad2">
                        <stop offset="0%" style="stop-color:#FF80AB"/>
                        <stop offset="70%" style="stop-color:#FF4081"/>
                        <stop offset="100%" style="stop-color:#C51162"/>
                    </radialGradient>
                </defs>
                
                <!-- æ ‡é¢˜ -->
                <text x="190" y="20" text-anchor="middle" font-size="14" fill="#E65100" font-weight="bold">å–·ç®¡ç²—ç»†å¯¹æ¯”å®éªŒ</text>
                
                <!-- ç²—å–·ç®¡åœºæ™¯ -->
                <g transform="translate(0, 35)">
                    <text x="30" y="15" font-size="13" font-weight="bold" fill="#D32F2F">ç²—å–·ç®¡:</text>
                    
                    <!-- æ°”çƒ -->
                    <ellipse cx="100" cy="15" rx="25" ry="18" fill="url(#balloonGrad2)" stroke="#C51162" stroke-width="1"/>
                    <ellipse cx="92" cy="10" rx="8" ry="10" fill="#FFE0F0" opacity="0.4"/>
                    
                    <!-- ç²—å–·ç®¡ -->
                    <rect x="125" y="8" width="45" height="14" fill="url(#nozzleGrad)" stroke="#757575" stroke-width="1.5" rx="2"/>
                    <rect x="168" y="10" width="8" height="10" fill="#9E9E9E"/>
                    
                    <!-- ç²—æ°”æµ -->
                    <g class="air-stream" style="opacity:1; animation: dash 0.2s linear infinite;">
                        <line x1="176" y1="12" x2="200" y2="12" stroke="#42A5F5" stroke-width="5" stroke-dasharray="5"/>
                        <line x1="176" y1="15" x2="205" y2="15" stroke="#2196F3" stroke-width="6" stroke-dasharray="5"/>
                        <line x1="176" y1="18" x2="200" y2="18" stroke="#1976D2" stroke-width="5" stroke-dasharray="5"/>
                    </g>
                    
                    <!-- ç‰¹æ€§æ ‡æ³¨ -->
                    <text x="220" y="10" font-size="11" fill="#1976D2">âœ“ å–·æ°”å¿«</text>
                    <text x="220" y="23" font-size="11" fill="#1976D2">âœ“ åŠ¨åŠ›å¤§</text>
                    <text x="220" y="36" font-size="11" fill="#F57C00">âœ— æ—¶é—´çŸ­</text>
                    
                    <!-- èƒ½é‡æ¡ -->
                    <rect x="30" y="45" width="150" height="12" fill="#ECEFF1" stroke="#90A4AE" stroke-width="1" rx="6"/>
                    <rect x="32" y="47" width="90" height="8" fill="#FF9800" rx="4">
                        <animate attributeName="width" values="90;0;90" dur="2.5s" repeatCount="indefinite"/>
                    </rect>
                    <text x="190" y="55" font-size="10" fill="#666">èƒ½é‡æ¶ˆè€—å¿«</text>
                </g>
                
                <!-- ç»†å–·ç®¡åœºæ™¯ -->
                <g transform="translate(0, 100)">
                    <text x="30" y="15" font-size="13" font-weight="bold" fill="#2E7D32">ç»†å–·ç®¡:</text>
                    
                    <!-- æ°”çƒ -->
                    <ellipse cx="100" cy="15" rx="25" ry="18" fill="url(#balloonGrad2)" stroke="#C51162" stroke-width="1"/>
                    <ellipse cx="92" cy="10" rx="8" ry="10" fill="#FFE0F0" opacity="0.4"/>
                    
                    <!-- ç»†å–·ç®¡ -->
                    <rect x="125" y="12" width="45" height="6" fill="url(#nozzleGrad)" stroke="#757575" stroke-width="1.5" rx="1"/>
                    <rect x="168" y="13" width="8" height="4" fill="#9E9E9E"/>
                    
                    <!-- ç»†æ°”æµ -->
                    <g class="air-stream" style="opacity:1; animation: dash 0.8s linear infinite;">
                        <line x1="176" y1="14" x2="200" y2="14" stroke="#64B5F6" stroke-width="2" stroke-dasharray="3"/>
                        <line x1="176" y1="15" x2="205" y2="15" stroke="#42A5F5" stroke-width="2.5" stroke-dasharray="3"/>
                        <line x1="176" y1="16" x2="200" y2="16" stroke="#2196F3" stroke-width="2" stroke-dasharray="3"/>
                    </g>
                    
                    <!-- ç‰¹æ€§æ ‡æ³¨ -->
                    <text x="220" y="10" font-size="11" fill="#F57C00">âœ— å–·æ°”æ…¢</text>
                    <text x="220" y="23" font-size="11" fill="#F57C00">âœ— åŠ¨åŠ›å°</text>
                    <text x="220" y="36" font-size="11" fill="#2E7D32">âœ“ æ—¶é—´é•¿</text>
                    
                    <!-- èƒ½é‡æ¡ -->
                    <rect x="30" y="45" width="150" height="12" fill="#ECEFF1" stroke="#90A4AE" stroke-width="1" rx="6"/>
                    <rect x="32" y="47" width="90" height="8" fill="#4CAF50" rx="4">
                        <animate attributeName="width" values="90;0;90" dur="6.5s" repeatCount="indefinite"/>
                    </rect>
                    <text x="190" y="55" font-size="10" fill="#666">èƒ½é‡æ¶ˆè€—æ…¢</text>
                </g>
                
                <!-- åº•éƒ¨åº”ç”¨è¯´æ˜ -->
                <rect x="10" y="145" width="360" height="1" fill="#E0E0E0"/>
                <text x="20" y="157" font-size="11" fill="#5E35B1" font-weight="bold">ğŸ’¡ åº”ç”¨ï¼š</text>
                <text x="70" y="157" font-size="10" fill="#666">ç«ç®­ã€å–·æ°”å¼é£æœºã€ä¹Œè´¼å–·æ°´ã€çƒŸèŠ±å‡ç©º</text>
            </svg>
        </div>
    </div>

    <!-- PART 2: QUIZ SECTION -->
    <div class="section-title">äºŒã€ å•å…ƒé—¯å…³å¡” (35é¢˜ / 100åˆ†)</div>
    
    <div class="card">
        <div class="quiz-status">
            <span>å…± 35 é¢˜</span>
            <span>æ»¡åˆ† 100 åˆ†</span>
        </div>
        <form id="quiz-form">
            <!-- JS will inject questions here -->
        </form>
        <button type="button" class="btn-submit" onclick="submitQuiz()">æäº¤è¯•å·</button>
    </div>

</div>

<!-- Results Modal -->
<div id="result-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeResult()">&times;</span>
        <h2 style="text-align:center">æµ‹è¯•ç»“æœ</h2>
        <div class="score-display" id="final-score">0</div>
        <div id="analysis-content">
            <!-- Wrong answers injected here -->
        </div>
    </div>
</div>

<script>
// --- å³æ—¶åé¦ˆç³»ç»Ÿ ---
const InstantFeedback = {
    audioCtx: null,
    encouragements: ['å¤ªæ£’äº†ï¼ç»§ç»­åŠ æ²¹ï¼ğŸŒŸ', 'ä½ çœŸèªæ˜ï¼ğŸ‘', 'å®Œå…¨æ­£ç¡®ï¼çœŸå‰å®³ï¼ğŸ¯', 'ç­”å¯¹äº†ï¼ä½ æ˜¯æœ€æ£’çš„ï¼â­', 'å¤ªä¼˜ç§€äº†ï¼ç»§ç»­ä¿æŒï¼ğŸ†', 'çœŸæ˜¯ä¸ªå°å¤©æ‰ï¼ğŸ’¡', 'å›ç­”å¾—éå¸¸å¥½ï¼ğŸ‘', 'ä½ æŒæ¡å¾—å¾ˆå¥½ï¼ğŸ“š'],
    hints: ['å†æƒ³æƒ³å“¦ï¼ä½ å¯ä»¥çš„ï¼ğŸ’ª', 'åˆ«ç°å¿ƒï¼Œå†è¯•ä¸€æ¬¡ï¼ğŸŒˆ', 'åŠ æ²¹ï¼ä»”ç»†çœ‹çœ‹é¢˜ç›®ï¼ğŸ‘€', 'æ²¡å…³ç³»ï¼Œç»§ç»­åŠªåŠ›ï¼ğŸ’«', 'å†çœ‹çœ‹çŸ¥è¯†ç‚¹å§ï¼ğŸ“–', 'ä¸è¦æ”¾å¼ƒï¼Œä½ èƒ½è¡Œï¼ğŸš€', 'æ€è€ƒä¸€ä¸‹ï¼Œä½ ä¸€å®šèƒ½æƒ³åˆ°ï¼ğŸ¤”', 'åŠ æ²¹ï¼ç›¸ä¿¡è‡ªå·±ï¼âœ¨'],
    
    init() { if (!this.audioCtx) this.audioCtx = new (window.AudioContext || window.webkitAudioContext)(); },
    
    playCorrectSound() {
        this.init(); if (this.audioCtx.state === 'suspended') this.audioCtx.resume();
        const notes = [523.25, 659.25, 783.99];
        notes.forEach((freq, i) => {
            const osc = this.audioCtx.createOscillator(); const gain = this.audioCtx.createGain();
            osc.connect(gain); gain.connect(this.audioCtx.destination);
            const now = this.audioCtx.currentTime; const start = now + i * 0.1;
            osc.frequency.value = freq; osc.type = 'sine';
            gain.gain.setValueAtTime(0.15, start); gain.gain.exponentialRampToValueAtTime(0.01, start + 0.3);
            osc.start(start); osc.stop(start + 0.3);
        });
    },
    
    playWrongSound() {
        this.init(); if (this.audioCtx.state === 'suspended') this.audioCtx.resume();
        const osc = this.audioCtx.createOscillator(); const gain = this.audioCtx.createGain();
        osc.connect(gain); gain.connect(this.audioCtx.destination);
        const now = this.audioCtx.currentTime;
        osc.frequency.setValueAtTime(300, now); osc.frequency.linearRampToValueAtTime(250, now + 0.2);
        osc.type = 'triangle';
        gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.2);
        osc.start(now); osc.stop(now + 0.2);
    },
    
    showConfetti() {
        const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE'];
        for (let i = 0; i < 30; i++) {
            setTimeout(() => {
                const c = document.createElement('div'); c.className = 'confetti';
                c.style.cssText = `width: ${Math.random() * 10 + 5}px; height: ${Math.random() * 10 + 5}px; background: ${colors[Math.floor(Math.random() * colors.length)]}; left: ${Math.random() * 100}%; top: -20px; border-radius: ${Math.random() > 0.5 ? '50%' : '0'}; animation: confetti-fall ${Math.random() * 2 + 2}s linear forwards; transform: rotate(${Math.random() * 360}deg);`;
                document.body.appendChild(c);
                setTimeout(() => c.remove(), 4000);
            }, i * 30);
        }
    },
    
    showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.className = `feedback-toast feedback-${type}`;
        toast.innerHTML = `<div class="toast-icon">${type === 'success' ? 'âœ“' : 'âœ—'}</div><div class="toast-message">${message}</div>`;
        document.body.appendChild(toast);
        setTimeout(() => toast.classList.add('show'), 10);
        setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.remove(), 300); }, 2500);
    },
    
    onCorrect(element) {
        this.playCorrectSound(); this.showConfetti();
        const msg = this.encouragements[Math.floor(Math.random() * this.encouragements.length)];
        this.showToast(msg, 'success');
        if (element) { element.classList.add('correct-feedback'); setTimeout(() => element.classList.remove('correct-feedback'), 600); }
    },
    
    onWrong(element, hint = '') {
        this.playWrongSound();
        const msg = this.hints[Math.floor(Math.random() * this.hints.length)] + (hint ? `<br><small style="font-size:0.85em;">ğŸ’¡ ${hint}</small>` : '');
        this.showToast(msg, 'error');
        if (element) { element.classList.add('wrong-feedback'); setTimeout(() => element.classList.remove('wrong-feedback'), 500); }
    }
};
InstantFeedback.init();

// å³æ—¶åé¦ˆå‡½æ•°
function checkChoiceAnswer(qid,selectedAnswer,labelElement,event){
event.preventDefault();
const qData=questions.find(q=>q.id===qid);
if(!qData)return;
const radio=labelElement.querySelector('input[type="radio"]');
radio.checked=true;
const allLabels=labelElement.parentElement.querySelectorAll('label');
allLabels.forEach(l=>l.classList.remove('correct-feedback','wrong-feedback'));
const isCorrect=selectedAnswer===qData.ans;
setTimeout(()=>{
if(isCorrect){
InstantFeedback.onCorrect(labelElement);
}else{
InstantFeedback.onWrong(labelElement,qData.exp);
}
},200);
}

function checkFillAnswer(qid,inputElement){
const qData=questions.find(q=>q.id===qid);
if(!qData)return;
const userAnswer=inputElement.value.trim();
if(!userAnswer)return;
const isCorrect=qData.ans.some?qData.ans.some(a=>userAnswer.includes(a)):userAnswer.includes(qData.ans);
inputElement.classList.remove('correct-feedback','wrong-feedback');
setTimeout(()=>{
if(isCorrect){
InstantFeedback.onCorrect(inputElement);
}else{
InstantFeedback.onWrong(inputElement,qData.exp);
}
},200);
}

// --- 1. Simulation Logic ---
function playRecoil() {
    const group = document.getElementById('demo-car-group');
    const arrows = document.getElementById('demo-arrows');
    const balloon = document.getElementById('anim-balloon');
    const airStream = document.getElementById('air-stream');
    
    // Reset
    group.setAttribute('transform', 'translate(175, 50)');
    arrows.setAttribute('opacity', '0');
    balloon.setAttribute('rx', '45');
    balloon.setAttribute('ry', '32');
    airStream.setAttribute('opacity', '0');
    
    // Animate
    setTimeout(() => {
        arrows.setAttribute('opacity', '1');
        airStream.setAttribute('opacity', '1');
        
        let pos = 175;
        let rx = 45;
        let ry = 32;
        const interval = setInterval(() => {
            pos += 3; // Move right faster
            rx -= 0.6; // Shrink horizontally
            ry -= 0.4; // Shrink vertically
            
            group.setAttribute('transform', `translate(${pos}, 50)`);
            if(rx > 15 && ry > 10) {
                balloon.setAttribute('rx', rx);
                balloon.setAttribute('ry', ry);
            }
            
            if (pos > 280) {
                clearInterval(interval);
                arrows.setAttribute('opacity', '0');
                airStream.setAttribute('opacity', '0');
                setTimeout(() => {
                    // Reset for next demo
                    group.setAttribute('transform', 'translate(175, 50)');
                    balloon.setAttribute('rx', '45');
                    balloon.setAttribute('ry', '32');
                }, 1000);
            }
        }, 20);
    }, 200);
}

// --- 2. Question Database (35 Questions) ---
const questions = [
    // --- é€‰æ‹©é¢˜ (1-20) ---
    { id: 1, type: 'choice', q: '1. æ°”çƒå–·æ°”æ–¹å‘å‘å·¦ï¼Œæ°”çƒä¼šå‘ï¼ˆ ï¼‰è¿åŠ¨ã€‚', opts: ['A. å·¦', 'B. å³', 'C. ä¸Š'], ans: 'B', exp: 'æ°”çƒè¿åŠ¨æ–¹å‘ä¸å–·æ°”æ–¹å‘ç›¸åã€‚' },
    { id: 2, type: 'choice', q: '2. æ°”çƒé‡Œçš„æ°”ä½“å–·å‡ºæ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªå’Œå–·å‡ºæ–¹å‘ç›¸åçš„æ¨åŠ›ï¼Œè¿™ä¸ªåŠ›å«ï¼ˆ ï¼‰ã€‚', opts: ['A. é‡åŠ›', 'B. å¼¹åŠ›', 'C. åå†²åŠ›'], ans: 'C', exp: 'è¿™æ˜¯åå†²åŠ›çš„å®šä¹‰ã€‚' },
    { id: 3, type: 'choice', q: '3. ä¸‹åˆ—ç‰©ä½“ä¸­ï¼Œä¸æ˜¯åˆ©ç”¨åå†²åŠ›è¿åŠ¨çš„æ˜¯ï¼ˆ ï¼‰ã€‚', opts: ['A. å–·æ°”å¼é£æœº', 'B. å¼“ç®­', 'C. ç«ç®­'], ans: 'B', exp: 'å¼“ç®­åˆ©ç”¨çš„æ˜¯å¼¹åŠ›ï¼Œé£æœºå’Œç«ç®­åˆ©ç”¨åå†²åŠ›ã€‚' },
    { id: 4, type: 'choice', q: '4. æƒ³è¦è®©æ°”çƒå°è½¦è¡Œé©¶å¾—æ›´è¿œï¼Œæˆ‘ä»¬å¯ä»¥ï¼ˆ ï¼‰ã€‚', opts: ['A. ç”¨æ›´å°çš„æ°”çƒ', 'B. å¢åŠ è½¦èº«é‡é‡', 'C. å‡è½»è½¦èº«é‡é‡'], ans: 'C', exp: 'è½¦èº«è¶Šè½»ï¼Œèµ·æ­¥è¶Šå¿«ï¼Œå—åˆ°çš„é˜»åŠ›å½±å“ç›¸å¯¹è¾ƒå°ï¼Œè¡Œé©¶æ›´è¿œã€‚' },
    { id: 5, type: 'choice', q: '5. æ°”çƒé£è¡Œçš„æ–¹å‘ï¼ˆ ï¼‰ã€‚', opts: ['A. å¾ˆæœ‰è§„å¾‹', 'B. æ²¡æœ‰è§„å¾‹', 'C. æ€»æ˜¯å‘ä¸‹çš„'], ans: 'B', exp: 'å–·å˜´æ— è§„å¾‹éœ‡åŠ¨å¯¼è‡´æ–¹å‘éšæœºã€‚' },
    { id: 6, type: 'choice', q: '6. å–·æ°”å˜´è¶Šç²—ï¼Œå–·æ°”é€Ÿåº¦è¶Šå¿«ï¼ŒåŠ¨åŠ›ï¼ˆ ï¼‰ï¼Œå–·æ°”æ—¶é—´ï¼ˆ ï¼‰ã€‚', opts: ['A. å¤§ï¼ŒçŸ­', 'B. å°ï¼Œé•¿', 'C. å¤§ï¼Œé•¿'], ans: 'A', exp: 'ç²—ç®¡ï¼šæ°”æµå¤§ï¼ŒåŠ›å¤§ï¼Œæ°”è·‘å¾—å¿«ï¼ˆæ—¶é—´çŸ­ï¼‰ã€‚' },
    { id: 7, type: 'choice', q: '7. ç»„è£…æ°”çƒå°è½¦æ—¶ï¼Œè½¦è½´è½¬åŠ¨ä¸çµæ´»ï¼Œæˆ‘ä»¬å¯ä»¥ï¼ˆ ï¼‰ã€‚', opts: ['A. æ¢å¤§è½®å­', 'B. åŠ æ¶¦æ»‘æ²¹', 'C. å¢åŠ æ°”çƒ'], ans: 'B', exp: 'åŠ æ¶¦æ»‘æ²¹å¯ä»¥å‡å°æ‘©æ“¦åŠ›ã€‚' },
    { id: 8, type: 'choice', q: '8. å……æ°”åçš„æ°”çƒå…·æœ‰ï¼ˆ ï¼‰ï¼Œå–·æ°”æ—¶å¯ä»¥äº§ç”ŸåŠ¨åŠ›ã€‚', opts: ['A. èƒ½é‡', 'B. ç£åŠ›', 'C. æ‘©æ“¦åŠ›'], ans: 'A', exp: 'å‹ç¼©ç©ºæ°”å…·æœ‰èƒ½é‡ã€‚' },
    { id: 9, type: 'choice', q: '9. èŠ‚æ—¥ç‡ƒæ”¾çš„â€œå†²å¤©ç‚®â€æ˜¯åˆ©ç”¨ï¼ˆ ï¼‰å‡ç©ºçš„ã€‚', opts: ['A. å¼¹åŠ›', 'B. é‡åŠ›', 'C. åå†²åŠ›'], ans: 'C', exp: 'ç«è¯æ°”ä½“å‘ä¸‹å–·ï¼Œç‚®å‘ä¸Šå†²ã€‚' },
    { id: 10, type: 'choice', q: '10. åŒæ ·çš„ç»†å–·ç®¡ï¼Œæ°”çƒå¹å¾—è¶Šå¤§ï¼Œè¡Œé©¶è·ç¦»ï¼ˆ ï¼‰ã€‚', opts: ['A. è¶Šè¿‘', 'B. è¶Šè¿œ', 'C. ä¸å˜'], ans: 'B', exp: 'æ°”é‡è¶³ï¼ŒæŒç»­æ—¶é—´é•¿ï¼Œæ€»èƒ½é‡å¤šã€‚' },
    { id: 11, type: 'choice', q: '11. æ°”çƒå°è½¦åŠ¨åŠ›ä¸è¶³æ—¶ï¼Œå¯ä»¥ï¼ˆ ï¼‰ã€‚', opts: ['A. æ¢æ›´å¤§çš„æ°”çƒ', 'B. æŠŠå–·ç®¡å¼„å¾—éå¸¸ç»†', 'C. å¢åŠ è½¦é‡'], ans: 'A', exp: 'å¤§æ°”çƒæä¾›æ›´å¤šèƒ½é‡ï¼›å¤ªç»†çš„ç®¡å­è™½ç„¶æ—¶é—´é•¿ä½†æ¨åŠ›å¯èƒ½ä¸è¶³ä»¥å…‹æœé™æ‘©æ“¦ã€‚' },
    { id: 12, type: 'choice', q: '12. åœ¨å…‰æ»‘çš„åœ°æ¿ä¸Šè¡Œé©¶æ¯”åœ¨æ¯›å·¾ä¸Šè¡Œé©¶ï¼ˆ ï¼‰ã€‚', opts: ['A. æ›´è¿œ', 'B. æ›´è¿‘', 'C. ä¸€æ ·'], ans: 'A', exp: 'å…‰æ»‘åœ°é¢æ‘©æ“¦åŠ›å°ã€‚' },
    { id: 13, type: 'choice', q: '13. æ¶ˆé˜²å‘˜ä½¿ç”¨é«˜å‹æ°´æªç­ç«æ—¶ï¼Œèº«ä½“ä¼šå‘ï¼ˆ ï¼‰å€¾æ–œã€‚', opts: ['A. å‰', 'B. å', 'C. å·¦'], ans: 'B', exp: 'æ°´å‘å‰å–·ï¼Œäººå—å‘åçš„åå†²åŠ›ã€‚' },
    { id: 14, type: 'choice', q: '14. å¦‚æœæ°”çƒå–·å˜´å‘ä¸‹ï¼Œæ°”çƒä¼šï¼ˆ ï¼‰ã€‚', opts: ['A. å‘ä¸Šé£', 'B. å‘ä¸‹é£', 'C. ä¸åŠ¨'], ans: 'A', exp: 'åå†²åŠ›æ–¹å‘å‘ä¸Šã€‚' },
    { id: 15, type: 'choice', q: '15. ä¸‹åˆ—å…³äºåå†²åŠ›çš„è¯´æ³•æ­£ç¡®çš„æ˜¯ï¼ˆ ï¼‰ã€‚', opts: ['A. åªæœ‰æ°”ä½“èƒ½äº§ç”Ÿ', 'B. åªæœ‰æ¶²ä½“èƒ½äº§ç”Ÿ', 'C. æ°”ä½“å’Œæ¶²ä½“å–·å°„éƒ½èƒ½äº§ç”Ÿ'], ans: 'C', exp: 'æ°´æªï¼ˆæ¶²ï¼‰å’Œæ°”çƒï¼ˆæ°”ï¼‰éƒ½æœ‰åå†²åŠ›ã€‚' },
    { id: 16, type: 'choice', q: '16. è¦ä½¿å°è½¦è¿åŠ¨ï¼Œå¤–åŠ›å¿…é¡»ï¼ˆ ï¼‰æ‘©æ“¦åŠ›ã€‚', opts: ['A. å¤§äº', 'B. å°äº', 'C. ç­‰äº'], ans: 'A', exp: 'åŠ¨åŠ›å¤§äºé˜»åŠ›æ‰èƒ½å¯åŠ¨ã€‚' },
    { id: 17, type: 'choice', q: '17. å–·æ°”å˜´ç»†ï¼Œå°è½¦è¡Œé©¶é€Ÿåº¦ï¼ˆ ï¼‰ï¼Œè¡Œé©¶è·ç¦»ï¼ˆ ï¼‰ã€‚', opts: ['A. æ…¢ï¼Œè¿œ', 'B. å¿«ï¼Œè¿‘', 'C. æ…¢ï¼Œè¿‘'], ans: 'A', exp: 'ç»†ç®¡æ¨åŠ›å°ï¼ˆèµ·æ­¥æ…¢ï¼‰ï¼Œä½†æŒä¹…ï¼Œå¾€å¾€èƒ½åˆ©ç”¨æƒ¯æ€§æ»‘è¡Œæ›´è¿œã€‚' },
    { id: 18, type: 'choice', q: '18. ä¹Œè´¼ï¼ˆå¢¨é±¼ï¼‰å–·æ°´å‰è¡Œï¼Œä¹Ÿæ˜¯åˆ©ç”¨äº†ï¼ˆ ï¼‰ã€‚', opts: ['A. æµ®åŠ›', 'B. åå†²åŠ›', 'C. é‡åŠ›'], ans: 'B', exp: 'ç”Ÿç‰©ç•Œçš„åå†²åŠ›åº”ç”¨ã€‚' },
    { id: 19, type: 'choice', q: '19. åˆ¶ä½œå°è½¦æ—¶ï¼Œæ°”çƒå®‰è£…åœ¨ï¼ˆ ï¼‰æœ€åˆé€‚ã€‚', opts: ['A. è½¦å¤´', 'B. è½¦å°¾', 'C. éƒ½å¯ä»¥ï¼Œåªè¦å–·å˜´æœå'], ans: 'C', exp: 'å…³é”®æ˜¯å–·æ°”æ–¹å‘å‘åï¼Œå®‰è£…ä½ç½®ä¸é™ã€‚' },
    { id: 20, type: 'choice', q: '20. æ°”çƒå˜ç˜ªäº†ï¼Œå°è½¦æœ€ç»ˆåœä¸‹æ¥æ˜¯å› ä¸ºï¼ˆ ï¼‰ã€‚', opts: ['A. æ²¡æ°”äº†', 'B. å—åˆ°é˜»åŠ›', 'C. æ²¡æ°”äº†ä¸”å—åˆ°é˜»åŠ›'], ans: 'C', exp: 'åŠ¨åŠ›æ¶ˆå¤±ï¼Œä¸”å§‹ç»ˆå­˜åœ¨æ‘©æ“¦é˜»åŠ›ã€‚' },

    // --- å¡«ç©ºé¢˜ (21-30) ---
    { id: 21, type: 'fill', q: '21. æ°”çƒé‡Œçš„æ°”ä½“å–·å‡ºæ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªå’Œå–·å‡ºæ–¹å‘____çš„æ¨åŠ›ã€‚', ans: 'ç›¸å', exp: 'æ–¹å‘ç›¸åã€‚' },
    { id: 22, type: 'fill', q: '22. è¿™ç§æ¨åŠ¨æ°”çƒè¿åŠ¨çš„åŠ›å«åš____åŠ›ã€‚', ans: 'åå†²', exp: 'å®šä¹‰ï¼šåå†²åŠ›ã€‚' },
    { id: 23, type: 'fill', q: '23. å–·æ°”å¼é£æœºã€ç«ç®­æ˜¯é å–·æ°”å‘åŠ¨æœºäº§ç”Ÿçš„____è¿åŠ¨çš„ã€‚', ans: 'åå†²åŠ›', exp: 'åº”ç”¨å®ä¾‹ã€‚' },
    { id: 24, type: 'fill', q: '24. æ°”çƒå¹å¾—è¶Šå¤§ï¼Œæ°”çƒå…·æœ‰çš„____è¶Šå¤§ã€‚', ans: 'èƒ½é‡', exp: 'å‹ç¼©ç©ºæ°”å‚¨å­˜èƒ½é‡ã€‚' },
    { id: 25, type: 'fill', q: '25. å–·ç®¡è¶Šç²—ï¼Œå–·æ°”é€Ÿåº¦è¶Š____ï¼ŒåŠ¨åŠ›è¶Š____ã€‚', ans: 'å¿«', exp: 'ç²—ç®¡å–·æ°”å¿«ï¼ŒåŠ¨åŠ›å¤§ï¼ˆæ­¤å¤„åªéœ€å¡«å¿«/å¤§ï¼‰ã€‚' },
    { id: 26, type: 'fill', q: '26. å–·ç®¡è¶Šç»†ï¼Œå–·æ°”æ—¶é—´è¶Š____ã€‚', ans: 'é•¿', exp: 'ç»†ç®¡æµé‡å°ï¼Œæ—¶é—´é•¿ã€‚' },
    { id: 27, type: 'fill', q: '27. æ°”çƒå°è½¦çš„åŠ¨åŠ›æ¥æºäºæ°”çƒå–·å‡ºæ°”ä½“äº§ç”Ÿçš„____ã€‚', ans: 'åå†²åŠ›', exp: 'åŠ¨åŠ›æ¥æºã€‚' },
    { id: 28, type: 'fill', q: '28. å‡è½»è½¦èº«____å¯ä»¥ä½¿å°è½¦è¡Œé©¶å¾—æ›´è¿œã€‚', ans: 'é‡é‡', exp: 'è½»é‡åŒ–å‡å°æ‘©æ“¦ã€‚' },
    { id: 29, type: 'fill', q: '29. æ°”çƒåœ¨é£è¡Œä¸­ï¼Œå–·æ°”å˜´ä¼šæ— è§„å¾‹____ï¼Œå¯¼è‡´æ–¹å‘å˜åŒ–ã€‚', ans: 'æŒ¯åŠ¨', exp: 'æŒ¯åŠ¨å¯¼è‡´æ–¹å‘å¤±æ§ã€‚' },
    { id: 30, type: 'fill', q: '30. è½¦è½´å¤„åŠ ____å¯ä»¥å‡å°æ‘©æ“¦åŠ›ã€‚', ans: 'æ¶¦æ»‘æ²¹', exp: 'æ¶¦æ»‘å‡å°‘æ‘©æ“¦ã€‚' },

    // --- æ‹–æ‹½é¢˜ (31-33) ---
    { 
        id: 31, type: 'drag', q: '31. è¯·å°†ä¸‹åˆ—ç°è±¡åˆ†ç±»ï¼ˆå—åŠ›ç±»å‹ï¼‰ï¼š', 
        cats: ['åˆ©ç”¨åå†²åŠ›', 'ä¸æ˜¯åå†²åŠ›'], 
        items: [{t:'ç«ç®­å‡ç©º', c:0}, {t:'æ‹‰å¼“å°„ç®­', c:1}, {t:'æ”¾é£æ°”çƒ', c:0}, {t:'è‹¹æœè½åœ°', c:1}],
        exp: 'ç«ç®­å’Œæ°”çƒæ˜¯åå†²åŠ›ï¼›å¼“ç®­æ˜¯å¼¹åŠ›ï¼Œè‹¹æœæ˜¯é‡åŠ›ã€‚'
    },
    { 
        id: 32, type: 'drag', q: '32. è¯·æ ¹æ®å–·ç®¡ç²—ç»†åˆ†ç±»ç‰¹æ€§ï¼š', 
        cats: ['ç²—å–·ç®¡', 'ç»†å–·ç®¡'], 
        items: [{t:'å–·æ°”å¿«', c:0}, {t:'åŠ¨åŠ›å¤§', c:0}, {t:'æ—¶é—´é•¿', c:1}, {t:'åŠ¨åŠ›å°', c:1}],
        exp: 'ç²—ç®¡ï¼šå¿«ã€å¤§ã€çŸ­ï¼›ç»†ç®¡ï¼šæ…¢ã€å°ã€é•¿ã€‚'
    },
    { 
        id: 33, type: 'drag', q: '33. å½±å“å°è½¦è·ç¦»çš„å› ç´ ï¼š', 
        cats: ['è·ç¦»å˜è¿œ', 'è·ç¦»å˜è¿‘'], 
        items: [{t:'æ°”çƒå¹å¤§', c:0}, {t:'è·¯é¢ç²—ç³™', c:1}, {t:'è½¦èº«å˜è½»', c:0}, {t:'å¢åŠ è½½é‡', c:1}],
        exp: 'æ°”å¤§ã€è½¦è½»ã€è·¯æ»‘ -> è¿œã€‚'
    },

    // --- å®éªŒæ¢ç©¶é¢˜ (34-35) ---
    {
        id: 34, type: 'experiment', 
        q: '34. æŸå°ç»„æ¢ç©¶â€œæ°”çƒå–·ç®¡ç²—ç»†å¯¹å°è½¦è¡Œé©¶è·ç¦»çš„å½±å“â€ï¼Œè®°å½•å¦‚ä¸‹è¡¨ã€‚',
        // ä¿®å¤ï¼šSVG ä½¿ç”¨çº¿æ¡å’Œç‹¬ç«‹æ–‡æœ¬ï¼Œä¸ä½¿ç”¨ \n
        svg: `<svg viewBox="0 0 320 160" style="background:white; border:1px solid #ddd">
                <!-- Header -->
                <rect x="0" y="0" width="320" height="40" fill="#eee"/>
                <text x="50" y="25" text-anchor="middle" font-weight="bold" font-size="14">å–·ç®¡ç±»å‹</text>
                <text x="160" y="25" text-anchor="middle" font-weight="bold" font-size="14">å–·æ°”æ—¶é—´(ç§’)</text>
                <text x="270" y="25" text-anchor="middle" font-weight="bold" font-size="14">è·ç¦»(å˜ç±³)</text>
                
                <!-- Lines -->
                <line x1="0" y1="40" x2="320" y2="40" stroke="#ccc"/>
                <line x1="0" y1="80" x2="320" y2="80" stroke="#ccc"/>
                <line x1="0" y1="120" x2="320" y2="120" stroke="#ccc"/>
                <line x1="100" y1="0" x2="100" y2="160" stroke="#ccc"/>
                <line x1="220" y1="0" x2="220" y2="160" stroke="#ccc"/>

                <!-- Row 1: ç²—å–·ç®¡ -->
                <text x="50" y="65" text-anchor="middle" font-size="14">ç²—å–·ç®¡</text>
                <text x="160" y="65" text-anchor="middle" font-size="14">2.5</text>
                <text x="270" y="65" text-anchor="middle" font-size="14">150</text>
                
                <!-- Row 2: ä¸­å–·ç®¡ -->
                <text x="50" y="105" text-anchor="middle" font-size="14">ä¸­å–·ç®¡</text>
                <text x="160" y="105" text-anchor="middle" font-size="14">4.0</text>
                <text x="270" y="105" text-anchor="middle" font-size="14">210</text>

                <!-- Row 3: ç»†å–·ç®¡ -->
                <text x="50" y="145" text-anchor="middle" font-size="14">ç»†å–·ç®¡</text>
                <text x="160" y="145" text-anchor="middle" font-size="14">6.5</text>
                <text x="270" y="145" text-anchor="middle" font-size="14">280</text>
              </svg>`,
        sub: [
            { label: '1.ã€å¡«ç©ºã€‘æ ¹æ®æ•°æ®ï¼Œå–·ç®¡è¶Šç»†ï¼Œå–·æ°”æ—¶é—´è¶Š____ã€‚', ans: 'é•¿' },
            { label: '2.ã€åˆ†æã€‘å“ªç§å–·ç®¡è®©å°è½¦è¡Œé©¶å¾—æœ€è¿œï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ', ans: 'ç»†å–·ç®¡', key: ['ç»†', 'é•¿'] },
            { label: '3.ã€åŸç†ã€‘è¯´æ˜å–·ç®¡ç²—ç»†é€‰æ‹©çš„ç§‘å­¦åŸç†ã€‚', ans: 'ç»¼åˆè€ƒè™‘åŠ¨åŠ›ä¸æ—¶é—´', key: ['åŠ¨åŠ›', 'æ—¶é—´', 'ç»¼åˆ'] }
        ],
        exp: '1.é•¿ï¼›2.ç»†å–·ç®¡ï¼Œå› ä¸ºå®ƒæä¾›äº†æŒç»­æ›´ä¹…çš„åŠ¨åŠ›ï¼›3.ç²—ç®¡åŠ¨åŠ›å¤§ä½†æ—¶é—´çŸ­ï¼Œç»†ç®¡åŠ¨åŠ›å°ä½†æ—¶é—´é•¿ï¼Œéœ€ç»¼åˆè€ƒè™‘æ‘©æ“¦åŠ›å¤§å°æ¥é€‰æ‹©ã€‚'
    },
    {
        id: 35, type: 'experiment', 
        q: '35. æ¢ç©¶â€œæ°”çƒå¤§å°å¯¹å°è½¦è¡Œé©¶è·ç¦»çš„å½±å“â€ã€‚',
        svg: `<svg viewBox="0 0 300 120" style="background:white; border:1px solid #ddd">
                <circle cx="50" cy="50" r="15" fill="#FF4081" opacity="0.6"/><text x="50" y="85" text-anchor="middle" font-size="12" fill="#333">å°æ°”çƒ</text>
                <circle cx="150" cy="50" r="25" fill="#FF4081" opacity="0.8"/><text x="150" y="95" text-anchor="middle" font-size="12" fill="#333">ä¸­æ°”çƒ</text>
                <circle cx="250" cy="50" r="35" fill="#FF4081"/><text x="250" y="105" text-anchor="middle" font-size="12" fill="#333">å¤§æ°”çƒ</text>
                <line x1="20" y1="110" x2="280" y2="110" stroke="#ddd" stroke-dasharray="4" />
              </svg>`,
        sub: [
            { label: '1.ã€å¡«ç©ºã€‘å®éªŒä¸­å”¯ä¸€æ”¹å˜çš„æ¡ä»¶æ˜¯____ã€‚', ans: 'æ°”çƒå¤§å°' },
            { label: '2.ã€åˆ†æã€‘é¢„æµ‹ï¼š____æ°”çƒé©±åŠ¨çš„å°è½¦è¡Œé©¶å¾—æœ€è¿œã€‚', ans: 'å¤§' },
            { label: '3.ã€åŸç†ã€‘æ°”çƒå¤§å°ä¸è¡Œé©¶è·ç¦»çš„å…³ç³»åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ', ans: 'èƒ½é‡', key: ['èƒ½é‡', 'å¤š', 'è¿œ'] }
        ],
        exp: '1.æ°”çƒå¤§å°ï¼›2.å¤§ï¼›3.æ°”çƒè¶Šå¤§ï¼Œå‚¨å­˜çš„ç©ºæ°”è¶Šå¤šï¼ˆèƒ½é‡è¶Šå¤§ï¼‰ï¼Œäº§ç”Ÿçš„åå†²åŠ›åšåŠŸè¶Šå¤šï¼Œè¡Œé©¶è¶Šè¿œã€‚'
    }
];

// --- 3. Quiz Rendering Logic (From Lesson 1) ---
const form = document.getElementById('quiz-form');

function renderQuiz() {
    questions.forEach(q => {
        const div = document.createElement('div');
        div.className = 'question-item';
        div.id = `q-${q.id}`;
        
        // Badge
        let badgeClass = '';
        let badgeText = '';
        if(q.type === 'choice') { badgeClass = 'badge-choice'; badgeText = 'é€‰æ‹©é¢˜ (2åˆ†)'; }
        if(q.type === 'fill') { badgeClass = 'badge-fill'; badgeText = 'å¡«ç©ºé¢˜ (2åˆ†)'; }
        if(q.type === 'drag') { badgeClass = 'badge-drag'; badgeText = 'æ‹–æ‹½é¢˜ (5åˆ†)'; }
        if(q.type === 'experiment') { badgeClass = 'badge-exp'; badgeText = 'å®éªŒæ¢ç©¶ (12.5åˆ†)'; }
        
        let html = `<div><span class="q-badge ${badgeClass}">${badgeText}</span><div class="q-content">${q.q}</div></div>`;

        // Input Generation
        if (q.type === 'choice') {
            html += `<div class="options">`;
            q.opts.forEach(opt => {
                html += `<label onclick="checkChoiceAnswer(${q.id},'${opt[0]}',this,event)"><input type="radio" name="q${q.id}" value="${opt[0]}"> ${opt}</label>`;
            });
            html += `</div>`;
        } else if (q.type === 'fill') {
            html += `<div style="margin-top:10px"><input type="text" name="q${q.id}" placeholder="è¯·è¾“å…¥ç­”æ¡ˆ" onblur="checkFillAnswer(${q.id},this)"></div>`;
        } else if (q.type === 'drag') {
            html += `<div class="drag-container">`;
            q.cats.forEach((cat, idx) => {
                html += `<div class="drop-zone" ondrop="drop(event, ${q.id}, ${idx})" ondragover="allowDrop(event)"><h4>${cat}</h4><div class="zone-items" id="zone-${q.id}-${idx}"></div></div>`;
            });
            html += `</div><div class="drag-pool">`;
            q.items.forEach((item, idx) => {
                html += `<div class="drag-item" id="d-${q.id}-${idx}" draggable="true" ondragstart="drag(event, ${q.id}, ${idx})" onclick="clickDrag(this, ${q.id}, ${idx})">${item.t}</div>`;
            });
            html += `</div><input type="hidden" id="inp-q${q.id}">`;
        } else if (q.type === 'experiment') {
            html += `<div class="exp-box">`;
            html += `<div class="exp-img-container">${q.svg}</div>`;
            q.sub.forEach((sub, idx) => {
                html += `<div class="exp-part"><span class="exp-label">${sub.label}</span>`;
                if(sub.label.includes('å¡«ç©º')) {
                    html += `<input type="text" name="q${q.id}_s${idx}" placeholder="ç®€çŸ­å›ç­”">`;
                } else {
                    html += `<textarea name="q${q.id}_s${idx}" placeholder="è¯·è¯¦ç»†è¯´æ˜..."></textarea>`;
                }
                html += `</div>`;
            });
            html += `</div>`;
        }

        div.innerHTML = html;
        form.appendChild(div);
    });
}

// --- 4. Drag & Drop Helpers (Mobile Friendly Click + Desktop Drag) ---
let selectedDrag = null;

function allowDrop(ev) { ev.preventDefault(); }
function drag(ev, qid, iidx) { ev.dataTransfer.setData("qid", qid); ev.dataTransfer.setData("iidx", iidx); }
function drop(ev, qid, zidx) {
    ev.preventDefault();
    const iidx = ev.dataTransfer.getData("iidx");
    const item = document.getElementById(`d-${qid}-${iidx}`);
    if(item) appendItem(item, qid, zidx);
}

// Mobile Click Logic
function clickDrag(el, qid, iidx) {
    if(selectedDrag && selectedDrag === el) {
        el.classList.remove('selected'); selectedDrag = null; return;
    }
    if(selectedDrag) selectedDrag.classList.remove('selected');
    selectedDrag = el;
    el.classList.add('selected');
    
    // Bind click events to zones
    const zones = document.querySelectorAll(`#q-${qid} .drop-zone`);
    zones.forEach((z, idx) => {
        z.onclick = () => { if(selectedDrag) { appendItem(selectedDrag, qid, idx); selectedDrag=null; } };
    });
}

function appendItem(item, qid, zidx) {
    document.getElementById(`zone-${qid}-${zidx}`).appendChild(item);
    item.classList.remove('selected');
    updateDragInput(qid);
}

function updateDragInput(qid) {
    let res = [];
    const zones = document.querySelectorAll(`#q-${qid} .drop-zone`);
    zones.forEach((z, zidx) => {
        const items = z.querySelectorAll('.drag-item');
        items.forEach(i => {
            // format: itemIndex:zoneIndex
            const iidx = i.id.split('-')[2];
            res.push(`${iidx}:${zidx}`);
        });
    });
    document.getElementById(`inp-q${qid}`).value = res.join(',');
}

// --- 5. Scoring Logic ---
function submitQuiz() {
    let score = 0;
    let html = '';
    
    questions.forEach(q => {
        let correct = false;
        let userAns = '';
        let points = 0;
        
        if(q.type === 'choice') {
            const el = document.querySelector(`input[name="q${q.id}"]:checked`);
            if(el) userAns = el.value;
            if(userAns === q.ans) { correct = true; score += 2; }
        } 
        else if (q.type === 'fill') {
            const el = document.querySelector(`input[name="q${q.id}"]`);
            userAns = el.value.trim();
            if(userAns.includes(q.ans)) { correct = true; score += 2; }
        }
        else if (q.type === 'drag') {
            const raw = document.getElementById(`inp-q${q.id}`).value;
            if(raw) {
                const pairs = raw.split(',');
                let allRight = true;
                let count = 0;
                pairs.forEach(p => {
                    const [i, z] = p.split(':');
                    if(q.items[i].c != z) allRight = false;
                    count++;
                });
                if(count === q.items.length && allRight) { correct = true; score += 5; }
            }
        }
        else if (q.type === 'experiment') {
            // Partial scoring for experiment questions
            let subPoints = 0;
            let subCorrectCount = 0;
            q.sub.forEach((sub, idx) => {
                const el = document.querySelector(`[name="q${q.id}_s${idx}"]`);
                const val = el ? el.value.trim() : '';
                let isPartRight = false;
                
                if(sub.label.includes('å¡«ç©º')) {
                    if(val.includes(sub.ans)) isPartRight = true;
                } else {
                    // Check keywords
                    if(sub.key && sub.key.some(k => val.includes(k))) isPartRight = true;
                }
                
                if(isPartRight) { 
                    subPoints += (12.5 / q.sub.length); 
                    subCorrectCount++; 
                }
            });
            
            // Allow small float tolerance
            if(subCorrectCount === q.sub.length) { correct = true; }
            score += subPoints;
        }

        if(!correct) {
            html += `<div class="analysis-card">
                <strong>ç¬¬ ${q.id} é¢˜ (${q.type === 'experiment' ? 'å®éªŒæ¢ç©¶' : 'åŸºç¡€çŸ¥è¯†'})</strong>
                <div>${q.q}</div>
                <span class="correct-answer">è§£æï¼š${q.exp}</span>
            </div>`;
        }
    });

    // Final Score Cap
    score = Math.min(100, Math.round(score));
    
    document.getElementById('final-score').innerText = score;
    document.getElementById('analysis-content').innerHTML = html || '<div style="text-align:center; color:green; font-size:1.2rem; padding:20px;">å¤ªæ£’äº†ï¼å…¨éƒ¨æ­£ç¡®ï¼ä½ æ˜¯ç§‘å­¦å°è¾¾äººï¼</div>';
    document.getElementById('result-modal').style.display = 'block';
}

function closeResult() {
    document.getElementById('result-modal').style.display = 'none';
}

// Init
renderQuiz();

</script>
</body>
</html>