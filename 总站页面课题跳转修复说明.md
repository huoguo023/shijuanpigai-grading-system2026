# 总站页面课题跳转修复说明

## 🐛 问题描述

**文件：** `02小学科学四上：科学大闯关总站 - 副本.html`  
**问题：** 点击左侧课题列表中的某些课程按钮后，无法跳转到对应页面  
**影响范围：** 第一单元第1课和第2课  
**发现时间：** 2024年12月28日

---

## 🔍 问题原因

在`loadLesson()`函数的`externalFiles`对象中，**缺少了第一单元前两课的文件映射**：

### 缺失的映射
- ❌ `u1-1`（第1课：听听声音）
- ❌ `u1-2`（第2课：声音是怎样产生的）

### 现有的映射
- ✅ `u1-3` 到 `u1-78`（第3-8课）
- ✅ `u2-1` 到 `u2-8`（第二单元全部）
- ✅ `u3-1` 到 `u3-78`（第三单元全部）

### 问题影响

当点击第1课或第2课时：
1. 代码在`externalFiles`对象中找不到对应的文件路径
2. 进入`else`分支，尝试从`<textarea id="u1-1">`中读取内容
3. 由于没有对应的textarea，显示"内容加载中或为空"的错误提示
4. 用户无法访问这两个课程的内容

---

## ✅ 修复方案

在`externalFiles`对象中添加缺失的两个文件映射：

### 修复前
```javascript
var externalFiles = {
    // 第一单元
    'u1-3': '第一单元 第三课：声音是怎样传播的.html',
    'u1-4': '第一单元第四课：我们是怎样听到声音的.html',
    // ... 缺少 u1-1 和 u1-2
```

### 修复后
```javascript
var externalFiles = {
    // 第一单元
    'u1-1': '第一单元 第1课.听听声音 .html',           // ✅ 新增
    'u1-2': '第一单元 第二课：声音是怎样产生的.html',  // ✅ 新增
    'u1-3': '第一单元 第三课：声音是怎样传播的.html',
    'u1-4': '第一单元第四课：我们是怎样听到声音的.html',
    // ...
```

---

## 🎯 修复效果

修复后，所有课程按钮都能正常工作：

### 第一单元（声音）✅
- ✅ 1. 听听声音 → `第一单元 第1课.听听声音 .html`
- ✅ 2. 声音是怎样产生的 → `第一单元 第二课：声音是怎样产生的.html`
- ✅ 3. 声音是怎样传播的 → `第一单元 第三课：声音是怎样传播的.html`
- ✅ 4. 我们是怎样听到声音的 → `第一单元第四课：我们是怎样听到声音的.html`
- ✅ 5. 声音的强与弱 → `第一单元  第五课.声音的强与弱.html`
- ✅ 6. 声音的高与低 → `第一单元6.声音的高与低.html`
- ✅ 7&8. 弦与小乐器 → `第一单元第七、八课：让弦发出高低不同的声音 & 制作小乐器.html`

### 第二单元（呼吸与消化）✅
- ✅ 全部8课都有正确映射

### 第三单元（运动和力）✅
- ✅ 全部7课都有正确映射

---

## 🔧 技术细节

### loadLesson函数工作流程

```javascript
function loadLesson(id, event) {
    // 1. 隐藏欢迎屏幕
    document.getElementById('welcome').style.display = 'none';
    
    // 2. 更新按钮激活状态
    // 移除所有active类，给当前按钮添加active类
    
    // 3. 检查是否有外部文件映射
    if (externalFiles[id]) {
        // ✅ 有映射：直接加载外部HTML文件
        iframe.src = externalFiles[id];
    } else {
        // ❌ 无映射：尝试从textarea读取（通常为空）
        // 这会导致显示错误提示
    }
}
```

### 文件路径说明

所有HTML文件都应该与总站页面在**同一目录**下，这样才能正确加载：

```
项目目录/
├── 02小学科学四上：科学大闯关总站 - 副本.html  (总站)
├── 第一单元 第1课.听听声音 .html
├── 第一单元 第二课：声音是怎样产生的.html
├── 第一单元 第三课：声音是怎样传播的.html
├── ... (其他课程文件)
```

---

## 📊 完整的文件映射表

| 课程ID | 按钮文字 | 文件名 | 状态 |
|--------|---------|--------|------|
| u1-1 | 1. 听听声音 | 第一单元 第1课.听听声音 .html | ✅ 已修复 |
| u1-2 | 2. 声音是怎样产生的 | 第一单元 第二课：声音是怎样产生的.html | ✅ 已修复 |
| u1-3 | 3. 声音是怎样传播的 | 第一单元 第三课：声音是怎样传播的.html | ✅ 正常 |
| u1-4 | 4. 我们是怎样听到声音的 | 第一单元第四课：我们是怎样听到声音的.html | ✅ 正常 |
| u1-5 | 5. 声音的强与弱 | 第一单元  第五课.声音的强与弱.html | ✅ 正常 |
| u1-6 | 6. 声音的高与低 | 第一单元6.声音的高与低.html | ✅ 正常 |
| u1-78 | 7&8. 弦与小乐器 | 第一单元第七、八课：让弦发出高低不同的声音 & 制作小乐器.html | ✅ 正常 |
| u2-1 | 1. 感受我们的呼吸 | 小学科学四上 第二单元1.感受我们的呼吸 复习.html | ✅ 正常 |
| u2-2 | 2. 呼吸与健康生活 | 小学科学四上第二单元2.呼吸与健康生活.html | ✅ 正常 |
| u2-3 | 3. 测量肺活量 | 小学科学四上第二单元3.测量肺活量.html | ✅ 正常 |
| u2-4 | 4. 一天的食物 | 小学科学四上第二单元4.一天的食物.html | ✅ 正常 |
| u2-5 | 5. 食物中的营养 | 小学科学四上第二单元5.食物中的营养.html | ✅ 正常 |
| u2-6 | 6. 营养要均衡 | 小学科学四上第二单元6.营养要均衡.html | ✅ 正常 |
| u2-7 | 7. 食物在口腔里的变化 | 小学科学四上第二单元7：食物在口腔里的变化.html | ✅ 正常 |
| u2-8 | 8. 食物在身体里的旅行 | 小学科学四上第二单元8.食物在身体里的旅行.html | ✅ 正常 |
| u3-1 | 1. 运动和力(基础) | 第三单元 第1课 运动和力 .html | ✅ 正常 |
| u3-2 | 2. 用气球驱动小车 | 第三单元 新第2课 用气球驱动小车.html | ✅ 正常 |
| u3-3 | 3. 用橡皮筋驱动小车 | 第三单元 第三课 用橡皮筋驱动小车.html | ✅ 正常 |
| u3-4 | 4. 弹簧测力计 | 第三单元 第四课、弹簧测力计.html | ✅ 正常 |
| u3-5 | 5. 运动与摩擦力 | 第三单元 第5课.html | ✅ 正常 |
| u3-6 | 6. 运动的小车 | 第三单元 第6课.html | ✅ 正常 |
| u3-78 | 7&8. 设计制作小车 | 第三单元 7、 8课.html | ✅ 正常 |

---

## 🧪 测试建议

修复后请测试以下内容：

1. **基本跳转测试**
   - ✅ 点击第一单元第1课，应该加载对应页面
   - ✅ 点击第一单元第2课，应该加载对应页面
   - ✅ 点击其他课程，确认仍然正常工作

2. **按钮状态测试**
   - ✅ 点击课程后，按钮应该变为激活状态（绿色背景）
   - ✅ 切换课程时，之前的按钮应该取消激活状态

3. **移动端测试**
   - ✅ 在手机上点击课程后，侧边栏应该自动收起
   - ✅ 内容应该正常显示在iframe中

4. **错误处理测试**
   - ✅ 如果文件不存在，应该显示404错误（而不是"内容为空"）

---

## 💡 经验总结

### 问题教训
- 在添加新课程时，必须同时更新`externalFiles`映射表
- 应该有完整的文件清单，避免遗漏
- 需要在开发时进行全面测试

### 预防措施
1. **创建文件清单**：维护一个完整的课程文件对照表
2. **自动化检查**：可以添加脚本检查所有课程ID是否都有对应的文件映射
3. **测试覆盖**：每次添加新课程后，测试所有按钮是否正常工作

### 改进建议
```javascript
// 可以添加一个检查函数，在页面加载时验证所有映射
function validateFileMappings() {
    const allButtons = document.querySelectorAll('.lesson-btn');
    const missingMappings = [];
    
    allButtons.forEach(btn => {
        const onclick = btn.getAttribute('onclick');
        const id = onclick.match(/loadLesson\('([^']+)'/)[1];
        
        if (!externalFiles[id]) {
            missingMappings.push(id);
        }
    });
    
    if (missingMappings.length > 0) {
        console.warn('缺少文件映射的课程ID:', missingMappings);
    }
}
```

---

## 📝 修复记录

- **修复时间：** 2024年12月28日
- **修复文件：** `02小学科学四上：科学大闯关总站 - 副本.html`
- **修复位置：** `loadLesson()`函数中的`externalFiles`对象
- **修复内容：** 添加`u1-1`和`u1-2`的文件映射
- **测试状态：** ✅ 待用户测试确认

---

**修复完成！** 🎉

现在所有23个课程按钮都应该能够正常跳转到对应的页面了。
