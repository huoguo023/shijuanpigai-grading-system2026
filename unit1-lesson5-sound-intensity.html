<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¬¬äº”è¯¾ï¼šå£°éŸ³çš„å¼ºä¸å¼± - ç§‘å­¦å¤§é—¯å…³</title>
    <style>
        :root {
            --bg-color: #F3E5F5;
            --card-bg: #FFFFFF;
            --primary: #9C27B0;
            --secondary: #FFCA28;
            --text: #4A148C;
            --font-main: "Microsoft YaHei", -apple-system, sans-serif;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text);
            margin: 0;
            padding: 10px;
            min-height: 100vh;
            background-image: radial-gradient(#E1BEE7 15%, transparent 16%);
            background-size: 25px 25px;
        }

        .container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            padding: 20px;
            text-align: center;
            border: 4px solid #CE93D8;
            overflow: hidden;
        }

        h1 { color: #7B1FA2; margin-top: 0; font-size: 1.6em; margin-bottom: 5px; }
        .subtitle { color: #FB8C00; font-size: 1em; margin-bottom: 15px; font-weight: bold; }

        /* åŒºåŸŸåˆ‡æ¢ */
        .section { display: none; animation: zoomIn 0.4s ease-out; }
        .active { display: block; }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        /* çŸ¥è¯†ç‚¹å¡ç‰‡ */
        .knowledge-box {
            background: #F3E5F5;
            border-radius: 12px;
            padding: 15px;
            text-align: left;
            border-left: 5px solid #AB47BC;
            margin-bottom: 20px;
        }
        .knowledge-box h3 { margin: 0 0 10px 0; color: #6A1B9A; border-bottom: 1px dashed #CE93D8; padding-bottom: 5px; }
        .k-point { margin-bottom: 8px; font-size: 1em; line-height: 1.6; }
        .highlight { color: #C2185B; font-weight: bold; background: #F8BBD0; padding: 0 4px; border-radius: 3px; }

        /* SVG æ¼”ç¤ºåŒº */
        .svg-stage {
            background: #FFF;
            border: 2px dashed #BA68C8;
            border-radius: 10px;
            padding: 10px;
            margin: 15px 0;
            text-align: center;
            position: relative;
        }
        .svg-caption { font-size: 0.9em; color: #757575; margin-top: 5px; font-style: italic; }
        
        .ctrl-btn {
            background: #AB47BC; color: white; border: none; padding: 8px 20px; 
            border-radius: 20px; margin: 5px; cursor: pointer; font-size: 0.9em;
            box-shadow: 0 3px 0 #7B1FA2; transition: 0.1s;
        }
        .ctrl-btn:active { transform: translateY(2px); box-shadow: 0 1px 0 #7B1FA2; }

        /* æŒ‰é’® */
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 0;
            width: 100%;
            font-size: 1.1em;
            border-radius: 50px;
            cursor: pointer;
            margin: 15px 0;
            font-weight: bold;
            box-shadow: 0 4px 0 #6A1B9A;
            transition: 0.1s;
        }
        .btn:active { transform: translateY(3px); box-shadow: 0 1px 0 #6A1B9A; }
        .btn-next { background: #FFCA28; box-shadow: 0 4px 0 #F57F17; color: #3E2723; }

        /* é¢˜ç›®åŒº */
        .progress-container { height: 10px; background: #EDE7F6; border-radius: 5px; margin-bottom: 5px; overflow: hidden; }
        .progress-bar { height: 100%; background: #9C27B0; width: 0%; transition: width 0.3s; }
        
        .question-card { background: #FAFAFA; border-radius: 10px; padding: 15px; text-align: left; border: 2px solid #E0E0E0; margin-top: 10px; }
        .q-tag { background: #E1BEE7; color: #4A148C; padding: 3px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; margin-right: 5px; }
        .q-content { font-size: 1.2em; font-weight: bold; margin: 10px 0 20px 0; line-height: 1.4; }

        /* é€‰é¡¹ */
        .option-item {
            background: white; border: 2px solid #D1C4E9; padding: 12px; border-radius: 8px;
            margin-bottom: 10px; cursor: pointer; transition: 0.2s;
        }
        .option-item.selected { background: #E1BEE7; border-color: #8E24AA; font-weight: bold; color: #4A148C; }

        .fill-input { border: none; border-bottom: 3px solid #9C27B0; background: transparent; width: 120px; text-align: center; font-size: 1.2em; color: #C2185B; border-radius: 0; }

        /* è¿çº¿é¢˜ */
        .match-row { display: flex; justify-content: space-between; gap: 10px; margin-bottom: 10px; }
        .match-col { width: 48%; display: flex; flex-direction: column; gap: 10px; }
        .match-btn {
            padding: 10px; background: #FFF; border: 2px solid #B39DDB; border-radius: 8px;
            text-align: center; cursor: pointer; font-size: 0.9em;
        }
        .match-btn.selected { background: #FFF59D; border-color: #FBC02D; transform: scale(1.05); }
        .match-btn.matched { background: #C8E6C9; border-color: #43A047; opacity: 0.6; pointer-events: none; }

        /* é”™é¢˜è§£æ */
        .wrong-item { background: #FFEBEE; border-left: 4px solid #EF5350; padding: 10px; margin-bottom: 10px; text-align: left; border-radius: 4px; }
        .score-display { font-size: 4em; color: #FF9800; font-weight: bold; margin: 10px 0; }

    </style>
</head>
<body>

    <!-- 1. å¤ä¹ åŒº -->
    <div id="section-review" class="container section active">
        <h1>ğŸ”Š çŸ¥è¯†å¤ä¹ </h1>
        <p class="subtitle">ç¬¬äº”è¯¾ï¼šå£°éŸ³çš„å¼ºä¸å¼±</p>

        <!-- çŸ¥è¯†ç‚¹ 1 & 2: å®šä¹‰ -->
        <div class="knowledge-box">
            <h3>1. å£°éŸ³çš„å¼ºå¼±ï¼ˆéŸ³é‡ï¼‰</h3>
            <div class="k-point">ğŸ”ˆ <strong>å¼ºå¼±</strong>ï¼šæŒ‡å£°éŸ³çš„è½»é‡ã€‚</div>
            <div class="k-point">ğŸ“ <strong>æè¿°</strong>ï¼šå¯ä»¥ç”¨<span class="highlight">éŸ³é‡</span>æ¥æè¿°ã€‚</div>
            <div class="svg-stage">
                <svg width="100%" height="100" viewBox="0 0 320 100" style="background:linear-gradient(to right, #F3E5F5 0%, #E1BEE7 100%); border-radius:10px;">
                    <defs>
                        <linearGradient id="weakWaveGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#CE93D8"/>
                            <stop offset="100%" style="stop-color:#BA68C8"/>
                        </linearGradient>
                        <linearGradient id="strongWaveGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#7B1FA2"/>
                            <stop offset="100%" style="stop-color:#4A148C"/>
                        </linearGradient>
                    </defs>
                    
                    <!-- å¼±å£°éŸ³åŒºåŸŸ -->
                    <rect x="10" y="10" width="140" height="80" rx="8" fill="#F8BBD0" opacity="0.3" stroke="#E91E63" stroke-width="1" stroke-dasharray="3,2"/>
                    <text x="80" y="25" text-anchor="middle" font-size="13" font-weight="bold" fill="#C2185B">è½»è½»è¯´ (å¼±)</text>
                    <text x="15" y="85" font-size="10" fill="#880E4F">ğŸ”‰ éŸ³é‡å°</text>
                    <!-- å¼±å£°æ³¢å½¢ (å°æŒ¯å¹…) -->
                    <path d="M30,50 L140,50" stroke="url(#weakWaveGrad)" stroke-width="3" fill="none">
                        <animate attributeName="d" values="M30,50 Q50,45 70,50 Q90,55 110,50 Q130,45 140,50; M30,50 Q50,55 70,50 Q90,45 110,50 Q130,55 140,50; M30,50 Q50,45 70,50 Q90,55 110,50 Q130,45 140,50" dur="1.5s" repeatCount="indefinite"/>
                    </path>
                    <!-- æŒ¯å¹…æ ‡æ³¨ -->
                    <line x1="25" y1="45" x2="25" y2="55" stroke="#BA68C8" stroke-width="1.5"/>
                    <text x="20" y="50" text-anchor="end" font-size="9" fill="#7B1FA2">å°</text>
                    
                    <!-- å¼ºå£°éŸ³åŒºåŸŸ -->
                    <rect x="170" y="10" width="140" height="80" rx="8" fill="#E1BEE7" opacity="0.3" stroke="#7B1FA2" stroke-width="2" stroke-dasharray="3,2"/>
                    <text x="240" y="25" text-anchor="middle" font-size="13" font-weight="bold" fill="#4A148C">å¤§å£°å–Š (å¼º)</text>
                    <text x="175" y="85" font-size="10" fill="#4A148C">ğŸ”Š éŸ³é‡å¤§</text>
                    <!-- å¼ºå£°æ³¢å½¢ (å¤§æŒ¯å¹…) -->
                    <path d="M190,50 L300,50" stroke="url(#strongWaveGrad)" stroke-width="4" fill="none">
                        <animate attributeName="d" values="M190,50 Q205,25 220,50 Q235,75 250,50 Q265,25 280,50 Q295,75 300,50; M190,50 Q205,75 220,50 Q235,25 250,50 Q265,75 280,50 Q295,25 300,50; M190,50 Q205,25 220,50 Q235,75 250,50 Q265,25 280,50 Q295,75 300,50" dur="0.8s" repeatCount="indefinite"/>
                    </path>
                    <!-- æŒ¯å¹…æ ‡æ³¨ -->
                    <line x1="185" y1="25" x2="185" y2="75" stroke="#4A148C" stroke-width="2"/>
                    <text x="180" y="50" text-anchor="end" font-size="9" fill="#4A148C" font-weight="bold">å¤§</text>
                    
                    <!-- å¯¹æ¯”ç®­å¤´ -->
                    <path d="M150,50 L165,50" fill="none" stroke="#666" stroke-width="2" marker-end="url(#arrowCompare)"/>
                    <defs>
                        <marker id="arrowCompare" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                            <path d="M0,0 L8,4 L0,8 z" fill="#666"/>
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <!-- çŸ¥è¯†ç‚¹ 3: é¼“é¢ä¸è±†å­ -->
        <div class="knowledge-box">
            <h3>2. é¼“é¢ä¸è±†å­ (æŒ¯åŠ¨å¹…åº¦)</h3>
            <div class="k-point">ğŸ¥ <strong>å®éªŒ</strong>ï¼šé¼“é¢ä¸Šæ”¾è±†å­/çº¸å±‘ï¼Œä¸ºäº†çœ‹æ¸…æŒ¯åŠ¨ã€‚</div>
            <div class="k-point">ğŸ’¥ <strong>è§„å¾‹</strong>ï¼š
                <br>è½»è½»æ•² -> æŒ¯åŠ¨å¹…åº¦<span class="highlight">å°</span> -> å£°éŸ³<span class="highlight">å¼±</span>
                <br>ç”¨åŠ›æ•² -> æŒ¯åŠ¨å¹…åº¦<span class="highlight">å¤§</span> -> å£°éŸ³<span class="highlight">å¼º</span>
            </div>
            
            <div class="svg-stage">
                <button class="ctrl-btn" onclick="animDrum('weak')">è½»è½»æ•²</button>
                <button class="ctrl-btn" onclick="animDrum('strong')">ç”¨åŠ›æ•²</button>
                <br>
                <svg width="100%" height="140" viewBox="0 0 220 140" id="svg-drum" style="background:linear-gradient(to bottom, #FFF3E0 0%, #F5F5F5 100%); border-radius:10px;">
                    <defs>
                        <linearGradient id="drumBodyGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#FFCCBC"/>
                            <stop offset="100%" style="stop-color:#FF8A65"/>
                        </linearGradient>
                        <radialGradient id="drumTopGrad">
                            <stop offset="0%" style="stop-color:#FFF3E0"/>
                            <stop offset="100%" style="stop-color:#FFAB91"/>
                        </radialGradient>
                        <linearGradient id="stickGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#6D4C41"/>
                            <stop offset="100%" style="stop-color:#4E342E"/>
                        </linearGradient>
                        <radialGradient id="stickHeadGrad">
                            <stop offset="0%" style="stop-color:#A1887F"/>
                            <stop offset="100%" style="stop-color:#6D4C41"/>
                        </radialGradient>
                    </defs>
                    
                    <!-- é¼“åº•é˜´å½± -->
                    <ellipse cx="110" cy="115" rx="62" ry="8" fill="#263238" opacity="0.2"/>
                    
                    <!-- é¼“èº« (ç«‹ä½“) -->
                    <ellipse cx="110" cy="85" rx="60" ry="20" fill="url(#drumBodyGrad)" stroke="#D84315" stroke-width="2"/>
                    <path d="M50,85 L50,115 Q110,135 170,115 L170,85" fill="url(#drumBodyGrad)" stroke="#D84315" stroke-width="2"/>
                    <!-- é¼“èº«çº¹ç† -->
                    <ellipse cx="110" cy="100" rx="55" ry="15" fill="none" stroke="#E64A19" stroke-width="1" opacity="0.3"/>
                    
                    <!-- é¼“é¢ -->
                    <ellipse cx="110" cy="85" rx="60" ry="20" fill="url(#drumTopGrad)" stroke="#D84315" stroke-width="2" opacity="0.9"/>
                    <!-- é¼“é¢ç»†èŠ‚ -->
                    <ellipse cx="110" cy="85" rx="50" ry="16" fill="none" stroke="#FF7043" stroke-width="1" opacity="0.5"/>
                    <ellipse cx="110" cy="85" rx="40" ry="12" fill="none" stroke="#FF5722" stroke-width="1" opacity="0.3"/>
                    
                    <!-- é¼“æ§Œ -->
                    <g id="drumstick" transform="rotate(-30 160 30)">
                        <rect x="155" y="25" width="8" height="55" rx="4" fill="url(#stickGrad)" stroke="#3E2723" stroke-width="1"/>
                        <!-- é¼“æ§Œé«˜å…‰ -->
                        <rect x="156" y="30" width="2" height="40" rx="1" fill="white" opacity="0.3"/>
                        <circle cx="159" cy="80" r="10" fill="url(#stickHeadGrad)" stroke="#4E342E" stroke-width="1"/>
                        <ellipse cx="159" cy="78" rx="4" ry="3" fill="white" opacity="0.4"/>
                    </g>
                    
                    <!-- è±†å­ (æ›´å¤§æ›´æ˜æ˜¾) -->
                    <circle id="bean1" cx="90" cy="88" r="4" fill="#66BB6A" stroke="#2E7D32" stroke-width="1">
                        <animate attributeName="fill" values="#66BB6A;#81C784;#66BB6A" dur="0.5s" repeatCount="indefinite"/>
                    </circle>
                    <circle id="bean2" cx="110" cy="83" r="4" fill="#4CAF50" stroke="#2E7D32" stroke-width="1">
                        <animate attributeName="fill" values="#4CAF50;#66BB6A;#4CAF50" dur="0.5s" begin="0.1s" repeatCount="indefinite"/>
                    </circle>
                    <circle id="bean3" cx="130" cy="88" r="4" fill="#66BB6A" stroke="#2E7D32" stroke-width="1">
                        <animate attributeName="fill" values="#66BB6A;#81C784;#66BB6A" dur="0.5s" begin="0.2s" repeatCount="indefinite"/>
                    </circle>
                    
                    <!-- æŒ¯åŠ¨æ³¢çº¹ -->
                    <ellipse id="drum-wave" cx="110" cy="85" rx="60" ry="20" stroke="#FF5722" stroke-width="3" fill="none" opacity="0"/>
                    
                    <!-- æ ‡æ³¨ -->
                    <text x="110" y="15" text-anchor="middle" font-size="11" fill="#D84315" font-weight="bold">ç‚¹å‡»æŒ‰é’®è§‚å¯Ÿè±†å­è·³åŠ¨</text>
                </svg>
            </div>
        </div>

        <!-- çŸ¥è¯†ç‚¹ 4: é’¢å°ºå®éªŒ -->
        <div class="knowledge-box">
            <h3>3. é’¢å°ºçš„æŒ¯åŠ¨</h3>
            <div class="k-point">ğŸ“ <strong>æ“ä½œ</strong>ï¼šä¼¸å‡ºçº¦20cmï¼Œå‹ä½ä¸€ç«¯ã€‚</div>
            <div class="k-point">ğŸ” <strong>æ ¸å¿ƒ</strong>ï¼šå£°éŸ³å¼ºå¼±ä¸<span class="highlight">æŒ¯åŠ¨å¹…åº¦</span>æœ‰å…³ã€‚</div>
            <div class="k-point">ğŸ‘‰ <strong>ç»“è®º</strong>ï¼š
                <br>æŒ¯å¹…å¤§ = å£°éŸ³å¼º
                <br>æŒ¯å¹…å° = å£°éŸ³å¼±
            </div>

            <div class="svg-stage">
                <button class="ctrl-btn" onclick="animRuler('weak')">è½»è½»æ‹¨ (æŒ¯å¹…å°)</button>
                <button class="ctrl-btn" onclick="animRuler('strong')">ç”¨åŠ›æ‹¨ (æŒ¯å¹…å¤§)</button>
                <svg width="100%" height="120" viewBox="0 0 200 120" id="svg-ruler">
                    <!-- æ¡Œå­ -->
                    <rect x="0" y="60" width="80" height="60" fill="#8D6E63"/>
                    <text x="20" y="90" fill="white" font-size="12">æ¡Œé¢</text>
                    <!-- æ‰‹å‹ä½ -->
                    <ellipse cx="70" cy="55" rx="15" ry="10" fill="#FFCCBC" stroke="#E64A19"/>
                    <!-- é’¢å°º -->
                    <path id="ruler-blade" d="M80,60 L180,60" stroke="#607D8B" stroke-width="6"/>
                    <!-- æŒ¯åŠ¨å¹…åº¦æŒ‡ç¤ºè™šçº¿ -->
                    <path id="amp-line" d="M180,40 L180,80" stroke="#AB47BC" stroke-width="2" stroke-dasharray="4" opacity="0"/>
                    <text id="amp-text" x="160" y="30" font-size="10" fill="#AB47BC" opacity="0">æŒ¯åŠ¨å¹…åº¦</text>
                </svg>
            </div>
        </div>

        <!-- çŸ¥è¯†ç‚¹ 5: éŸ³å‰ä¸å°çƒ -->
        <div class="knowledge-box">
            <h3>4. éŸ³å‰ä¸ä¹’ä¹“çƒ</h3>
            <div class="k-point">ğŸ± <strong>å°çƒä½œç”¨</strong>ï¼šæŠŠéŸ³å‰å¾®å°çš„æŒ¯åŠ¨<span class="highlight">æ”¾å¤§</span>ã€‚</div>
            <div class="k-point">ğŸ“ <strong>è§„å¾‹</strong>ï¼š
                <br>å°çƒå¼¹å¾—è¿œ -> æŒ¯å¹…å¤§ -> å£°éŸ³å¼º
                <br>å°çƒå¼¹å¾—è¿‘ -> æŒ¯å¹…å° -> å£°éŸ³å¼±
            </div>
            
            <div class="svg-stage">
                <button class="ctrl-btn" onclick="animFork('weak')">è½»æ•² (å¼±éŸ³)</button>
                <button class="ctrl-btn" onclick="animFork('strong')">é‡æ•² (å¼ºéŸ³)</button>
                <svg width="100%" height="120" viewBox="0 0 200 120" id="svg-fork-container">
                    <!-- éŸ³å‰ -->
                    <path id="fork-body" d="M50,110 L50,70 Q50,40 70,40 Q90,40 90,70 L90,110" fill="none" stroke="#90A4AE" stroke-width="8" stroke-linecap="round"/>
                    <rect x="65" y="110" width="10" height="10" fill="#546E7A"/>
                    <!-- æ‚¬æŒ‚çº¿ -->
                    <line x1="110" y1="10" x2="110" y2="50" stroke="#333" stroke-width="1"/>
                    <!-- å°çƒ -->
                    <circle id="ball" cx="110" cy="55" r="8" fill="#FF5722"/>
                    <text x="130" y="110" font-size="10" fill="#555">å°çƒå¼¹å¼€è·ç¦»</text>
                </svg>
            </div>
        </div>

        <button class="btn" onclick="startQuiz()">è¿›å…¥35é¢˜é—¯å…³å¡”ï¼ğŸš€</button>
    </div>

    <!-- 2. é—¯å…³åŒº -->
    <div id="section-quiz" class="container section">
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div style="text-align:right; font-size:0.9em; color:#7B1FA2;">é¢˜ç›®ï¼š<span id="q-index">1</span> / 35</div>

        <div id="question-area"></div>
        
        <button class="btn btn-next" id="nextBtn" onclick="nextQuestion()">ä¸‹ä¸€é¢˜ â–¶</button>
    </div>

    <!-- 3. ç»“ç®—åŒº -->
    <div id="section-result" class="container section">
        <h1>ğŸ† é—¯å…³æˆç»©</h1>
        <div class="score-display"><span id="final-score">0</span>åˆ†</div>
        <p id="reward-text"></p>
        
        <div id="wrong-list" style="display:none;">
            <h3 style="color:#D32F2F;">âŒ é”™é¢˜è§£æ</h3>
            <!-- é”™é¢˜å†…å®¹ -->
        </div>
        <button class="btn" onclick="location.reload()">ğŸ”„ é‡æ–°æŒ‘æˆ˜</button>
    </div>

    <script>
        // --- SVG åŠ¨ç”»é€»è¾‘ ---
        
        function animDrum(type) {
            const wave = document.getElementById('drum-wave');
            const beans = [document.getElementById('bean1'), document.getElementById('bean2'), document.getElementById('bean3')];
            const stick = document.getElementById('drumstick');
            
            // é¼“æ§ŒåŠ¨ç”»
            // å…ˆæ¸…é™¤æ—§åŠ¨ç”»
            while(stick.firstChild) stick.removeChild(stick.firstChild);
            
            // åˆ›å»ºæ–°åŠ¨ç”»
            const stickAnim = document.createElementNS("http://www.w3.org/2000/svg", "animateTransform");
            stickAnim.setAttribute("attributeName", "transform");
            stickAnim.setAttribute("type", "rotate");
            stickAnim.setAttribute("values", "-30 150 20; -50 150 20; -30 150 20");
            stickAnim.setAttribute("dur", "0.15s");
            stickAnim.setAttribute("repeatCount", "1");
            stick.appendChild(stickAnim);
            stickAnim.beginElement();

            let jumpH = type === 'strong' ? 40 : 10; // è·³è·ƒé«˜åº¦
            let waveH = type === 'strong' ? 15 : 5;  // æŒ¯åŠ¨å¹…åº¦

            // è±†å­è·³åŠ¨
            beans.forEach((b, i) => {
                let cy = 80 + (i%2)*5;
                while(b.firstChild) b.removeChild(b.firstChild); // Clear
                const bAnim = document.createElementNS("http://www.w3.org/2000/svg", "animate");
                bAnim.setAttribute("attributeName", "cy");
                bAnim.setAttribute("values", `${cy};${cy-jumpH};${cy}`);
                bAnim.setAttribute("dur", "0.4s");
                bAnim.setAttribute("begin", "0.15s");
                bAnim.setAttribute("repeatCount", "2");
                b.appendChild(bAnim);
                bAnim.beginElement();
            });

            // é¼“é¢æŒ¯åŠ¨
            wave.setAttribute('opacity', '1');
            while(wave.firstChild) wave.removeChild(wave.firstChild);
            const wAnim = document.createElementNS("http://www.w3.org/2000/svg", "animate");
            wAnim.setAttribute("attributeName", "d");
            wAnim.setAttribute("values", `M50,80 Q100,${80-waveH} 150,80; M50,80 Q100,${80+waveH} 150,80; M50,80 Q100,80 150,80`);
            wAnim.setAttribute("dur", "0.1s");
            wAnim.setAttribute("begin", "0.15s");
            wAnim.setAttribute("repeatCount", "5");
            wave.appendChild(wAnim);
            wAnim.beginElement();
            
            setTimeout(()=> wave.setAttribute('opacity', '0'), 800);
        }

        function animRuler(type) {
            const blade = document.getElementById('ruler-blade');
            const ampLine = document.getElementById('amp-line');
            const ampText = document.getElementById('amp-text');
            
            let swing = type === 'strong' ? 30 : 8;
            
            while(blade.firstChild) blade.removeChild(blade.firstChild);
            
            const rAnim = document.createElementNS("http://www.w3.org/2000/svg", "animate");
            rAnim.setAttribute("attributeName", "d");
            rAnim.setAttribute("values", `M80,60 Q130,${60-swing} 180,${60-swing}; M80,60 Q130,${60+swing} 180,${60+swing}; M80,60 L180,60`);
            rAnim.setAttribute("dur", "0.1s");
            rAnim.setAttribute("repeatCount", "10");
            blade.appendChild(rAnim);
            rAnim.beginElement();
            
            // å¹…åº¦æŒ‡ç¤º
            ampLine.setAttribute('opacity', 1);
            ampText.setAttribute('opacity', 1);
            ampLine.setAttribute('d', `M180,${60-swing} L180,${60+swing}`);
            
            setTimeout(() => {
                ampLine.setAttribute('opacity', 0);
                ampText.setAttribute('opacity', 0);
            }, 1200);
        }

        function animFork(type) {
            const ball = document.getElementById('ball');
            const forkBody = document.getElementById('fork-body');
            
            // æ¸…é™¤æ—§åŠ¨ç”»
            while(ball.firstChild) ball.removeChild(ball.firstChild);
            while(forkBody.firstChild) forkBody.removeChild(forkBody.firstChild);

            // 1. å°çƒå¼¹å¼€åŠ¨ç”»
            let targetX = type === 'strong' ? 170 : 125; 
            const ballAnim = document.createElementNS("http://www.w3.org/2000/svg", "animate");
            ballAnim.setAttribute("attributeName", "cx");
            // æ¨¡æ‹Ÿå¼¹å¼€ï¼šåŸç‚¹ -> æœ€è¿œ -> åŸç‚¹ -> å°å¼¹ -> åŸç‚¹
            ballAnim.setAttribute("values", `110; ${targetX}; 110; ${110 + (targetX-110)*0.3}; 110`);
            ballAnim.setAttribute("dur", "1s");
            ballAnim.setAttribute("fill", "freeze");
            ball.appendChild(ballAnim);
            ballAnim.beginElement();

            // 2. éŸ³å‰æŒ¯åŠ¨æ•ˆæœ (æè¾¹ç²—ç»†å˜åŒ–æ¨¡æ‹ŸæŒ¯åŠ¨)
            const forkAnim = document.createElementNS("http://www.w3.org/2000/svg", "animate");
            forkAnim.setAttribute("attributeName", "stroke-width");
            forkAnim.setAttribute("values", "8; 6; 8");
            forkAnim.setAttribute("dur", "0.05s");
            forkAnim.setAttribute("repeatCount", type === 'strong' ? "20" : "10");
            forkBody.appendChild(forkAnim);
            forkAnim.beginElement();
        }

        // --- å³æ—¶åé¦ˆç³»ç»Ÿ ---
        const InstantFeedback = {
            audioCtx: null,
            encouragements: ['å¤ªæ£’äº†ï¼ç»§ç»­åŠ æ²¹ï¼ğŸŒŸ', 'ä½ çœŸèªæ˜ï¼ğŸ‘', 'å®Œå…¨æ­£ç¡®ï¼çœŸå‰å®³ï¼ğŸ¯', 'ç­”å¯¹äº†ï¼ä½ æ˜¯æœ€æ£’çš„ï¼â­', 'å¤ªä¼˜ç§€äº†ï¼ç»§ç»­ä¿æŒï¼ğŸ†', 'çœŸæ˜¯ä¸ªå°å¤©æ‰ï¼ğŸ’¡', 'å›ç­”å¾—éå¸¸å¥½ï¼ğŸ‘', 'ä½ æŒæ¡å¾—å¾ˆå¥½ï¼ğŸ“š'],
            hints: ['å†æƒ³æƒ³å“¦ï¼ä½ å¯ä»¥çš„ï¼ğŸ’ª', 'åˆ«ç°å¿ƒï¼Œå†è¯•ä¸€æ¬¡ï¼ğŸŒˆ', 'åŠ æ²¹ï¼ä»”ç»†çœ‹çœ‹é¢˜ç›®ï¼ğŸ‘€', 'æ²¡å…³ç³»ï¼Œç»§ç»­åŠªåŠ›ï¼ğŸ’«', 'å†çœ‹çœ‹çŸ¥è¯†ç‚¹å§ï¼ğŸ“–', 'ä¸è¦æ”¾å¼ƒï¼Œä½ èƒ½è¡Œï¼ğŸš€', 'æ€è€ƒä¸€ä¸‹ï¼Œä½ ä¸€å®šèƒ½æƒ³åˆ°ï¼ğŸ¤”', 'åŠ æ²¹ï¼ç›¸ä¿¡è‡ªå·±ï¼âœ¨'],
            
            init() { if (!this.audioCtx) this.audioCtx = new (window.AudioContext || window.webkitAudioContext)(); },
            
            playCorrectSound() {
                this.init(); if (this.audioCtx.state === 'suspended') this.audioCtx.resume();
                const notes = [523.25, 659.25, 783.99];
                notes.forEach((freq, i) => {
                    const osc = this.audioCtx.createOscillator(); const gain = this.audioCtx.createGain();
                    osc.connect(gain); gain.connect(this.audioCtx.destination);
                    const now = this.audioCtx.currentTime; const start = now + i * 0.1;
                    osc.frequency.value = freq; osc.type = 'sine';
                    gain.gain.setValueAtTime(0.15, start); gain.gain.exponentialRampToValueAtTime(0.01, start + 0.3);
                    osc.start(start); osc.stop(start + 0.3);
                });
            },
            
            playWrongSound() {
                this.init(); if (this.audioCtx.state === 'suspended') this.audioCtx.resume();
                const osc = this.audioCtx.createOscillator(); const gain = this.audioCtx.createGain();
                osc.connect(gain); gain.connect(this.audioCtx.destination);
                const now = this.audioCtx.currentTime;
                osc.frequency.setValueAtTime(300, now); osc.frequency.linearRampToValueAtTime(250, now + 0.2);
                osc.type = 'triangle';
                gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(now); osc.stop(now + 0.2);
            },
            
            showConfetti() {
                const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE'];
                for (let i = 0; i < 30; i++) {
                    setTimeout(() => {
                        const c = document.createElement('div'); c.className = 'confetti';
                        c.style.cssText = `width: ${Math.random() * 10 + 5}px; height: ${Math.random() * 10 + 5}px; background: ${colors[Math.floor(Math.random() * colors.length)]}; left: ${Math.random() * 100}%; top: -20px; border-radius: ${Math.random() > 0.5 ? '50%' : '0'}; animation: confetti-fall ${Math.random() * 2 + 2}s linear forwards; transform: rotate(${Math.random() * 360}deg);`;
                        document.body.appendChild(c);
                        setTimeout(() => c.remove(), 4000);
                    }, i * 30);
                }
            },
            
            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `feedback-toast feedback-${type}`;
                toast.innerHTML = `<div class="toast-icon">${type === 'success' ? 'âœ“' : 'âœ—'}</div><div class="toast-message">${message}</div>`;
                document.body.appendChild(toast);
                setTimeout(() => toast.classList.add('show'), 10);
                setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.remove(), 300); }, 2500);
            },
            
            onCorrect(element) {
                this.playCorrectSound(); this.showConfetti();
                const msg = this.encouragements[Math.floor(Math.random() * this.encouragements.length)];
                this.showToast(msg, 'success');
                if (element) { element.classList.add('correct-feedback'); setTimeout(() => element.classList.remove('correct-feedback'), 600); }
            },
            
            onWrong(element, hint = '') {
                this.playWrongSound();
                const msg = this.hints[Math.floor(Math.random() * this.hints.length)] + (hint ? `<br><small style="font-size:0.85em;">ğŸ’¡ ${hint}</small>` : '');
                this.showToast(msg, 'error');
                if (element) { element.classList.add('wrong-feedback'); setTimeout(() => element.classList.remove('wrong-feedback'), 500); }
            }
        };
        InstantFeedback.init();

        // --- 35é“é¢˜åº“ ---
        const quizData = [
            // 1. åŸºç¡€æ¦‚å¿µ (6é¢˜)
            { type: 'mcq', q: 'åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸æŠŠå£°éŸ³çš„è½»é‡ç§°ä¸ºå£°éŸ³çš„ï¼Ÿ', opts: ['é«˜ä½', 'å¼ºå¼±', 'éŸ³è‰²'], a: 1, exp: 'å£°éŸ³çš„è½»é‡ = å¼ºå¼±ã€‚' },
            { type: 'mcq', q: 'å£°éŸ³çš„å¼ºå¼±å¯ä»¥ç”¨____æ¥æè¿°ã€‚', opts: ['éŸ³é«˜', 'éŸ³é‡', 'é¢‘ç‡'], a: 1, exp: 'éŸ³é‡æè¿°å¼ºå¼±ï¼ŒéŸ³é«˜æè¿°é«˜ä½ã€‚' },
            { type: 'mcq', q: 'å¤§å£°è¯´è¯å’Œè½»å£°ç»†è¯­ï¼Œä¸»è¦æ˜¯å£°éŸ³çš„____ä¸åŒã€‚', opts: ['å¼ºå¼±', 'é«˜ä½', 'å¥½å¬ç¨‹åº¦'], a: 0, exp: 'å¤§å£°=å¼ºï¼Œè½»å£°=å¼±ã€‚' },
            { type: 'fill', q: 'ç‰©ä½“æŒ¯åŠ¨çš„å¹…åº¦è¶Šå¤§ï¼Œå£°éŸ³è¶Š____ã€‚', a: ['å¼º'], exp: 'æŒ¯å¹…å¤§=å£°éŸ³å¼ºã€‚' },
            { type: 'fill', q: 'ç‰©ä½“æŒ¯åŠ¨çš„å¹…åº¦è¶Šå°ï¼Œå£°éŸ³è¶Š____ã€‚', a: ['å¼±'], exp: 'æŒ¯å¹…å°=å£°éŸ³å¼±ã€‚' },
            { type: 'matching', q: 'è¯·è¿çº¿æè¿°ï¼š', pairs: [{l:'ç”¨åŠ›æ•²', r:'å£°éŸ³å¼º'}, {l:'è½»è½»æ•²', r:'å£°éŸ³å¼±'}, {l:'æŒ¯å¹…å¤§', r:'éŸ³é‡å¤§'}], exp: 'åŠ›ã€æŒ¯å¹…ä¸éŸ³é‡çš„å…³ç³»ã€‚' },

            // 2. é’¢å°ºå®éªŒ (8é¢˜)
            { type: 'mcq', q: 'åšé’¢å°ºå®éªŒæ—¶ï¼Œé’¢å°ºä¼¸å‡ºæ¡Œé¢çš„é•¿åº¦åº”è¯¥ï¼Ÿ', opts: ['ä¸æ–­å˜åŒ–', 'ä¿æŒä¸å˜(çº¦20cm)', 'è¶Šé•¿è¶Šå¥½'], a: 1, exp: 'ç ”ç©¶å¼ºå¼±æ—¶ï¼Œè¦æ§åˆ¶é•¿åº¦ä¸å˜ï¼ˆæ§åˆ¶å˜é‡ï¼‰ã€‚' },
            { type: 'mcq', q: 'è½»è½»æ‹¨åŠ¨é’¢å°ºï¼Œé’¢å°ºçš„æŒ¯åŠ¨å¹…åº¦____ï¼Œå‘å‡ºçš„å£°éŸ³____ã€‚', opts: ['å¤§ï¼Œå¼º', 'å°ï¼Œå¼±', 'å°ï¼Œå¼º'], a: 1, exp: 'åŠ›å°->æŒ¯å¹…å°->å£°éŸ³å¼±ã€‚' },
            { type: 'mcq', q: 'ç”¨åŠ›æ‹¨åŠ¨é’¢å°ºï¼Œé’¢å°ºçš„æŒ¯åŠ¨å¹…åº¦____ï¼Œå‘å‡ºçš„å£°éŸ³____ã€‚', opts: ['å¤§ï¼Œå¼º', 'å°ï¼Œå¼±', 'å¤§ï¼Œå¼±'], a: 0, exp: 'åŠ›å¤§->æŒ¯å¹…å¤§->å£°éŸ³å¼ºã€‚' },
            { type: 'mcq', q: 'å¦‚æœæŠŠé’¢å°ºä¼¸å‡ºé•¿åº¦å˜é•¿ï¼Œæˆ‘ä»¬ç ”ç©¶çš„æ˜¯å£°éŸ³çš„ï¼Ÿ', opts: ['å¼ºå¼±', 'é«˜ä½', 'ä¼ æ’­'], a: 1, exp: 'æ”¹å˜é•¿åº¦æ˜¯ç ”ç©¶éŸ³é«˜ï¼ˆé«˜ä½ï¼‰çš„å®éªŒã€‚' },
            { type: 'fill', q: 'å£°éŸ³çš„å¼ºå¼±å’Œç‰©ä½“çš„____æœ‰å…³ã€‚', a: ['æŒ¯åŠ¨å¹…åº¦'], exp: 'æ ¸å¿ƒç»“è®ºï¼šå¼ºå¼±çœ‹æŒ¯å¹…ã€‚' },
            { type: 'mcq', q: 'åšå®éªŒæ—¶ï¼Œè¦ç”¨æ‰‹____é’¢å°ºåœ¨æ¡Œé¢ä¸Šçš„ä¸€ç«¯ã€‚', opts: ['å‹ä½', 'æ‹¿ç€', 'æ‚¬ç©º'], a: 0, exp: 'å‹ä½é˜²æ­¢å°ºå­æ‰è½æˆ–äº§ç”Ÿæ‚éŸ³ã€‚' },
            { type: 'mcq', q: 'é€šè¿‡é’¢å°ºå®éªŒï¼Œæˆ‘ä»¬å‘ç°ç”¨åŠ›è¶Šå¤§ï¼Œé’¢å°ºä¸Šä¸‹æ‘†åŠ¨çš„å¹…åº¦ï¼Ÿ', opts: ['è¶Šå°', 'è¶Šå¤§', 'ä¸å˜'], a: 1, exp: 'åŠ›å¤§æŒ¯å¹…å¤§ã€‚' },
            { type: 'matching', q: 'è¿çº¿é’¢å°ºå®éªŒç°è±¡ï¼š', pairs: [{l:'è½»è½»æ‹¨', r:'æŒ¯åŠ¨å¹…åº¦å°'}, {l:'ç”¨åŠ›æ‹¨', r:'æŒ¯åŠ¨å¹…åº¦å¤§'}, {l:'å£°éŸ³å¼º', r:'ç”¨åŠ›å¤§'}], exp: 'å®éªŒç°è±¡å¯¹åº”ã€‚' },

            // 3. é¼“é¢ä¸è±†å­ (6é¢˜)
            { type: 'mcq', q: 'åœ¨é¼“é¢ä¸Šæ”¾è±†å­æ˜¯ä¸ºäº†ï¼Ÿ', opts: ['ä¸ºäº†å¥½å¬', 'ä¸ºäº†çœ‹æ¸…é¼“é¢çš„æŒ¯åŠ¨', 'ä¸ºäº†å¢åŠ é‡é‡'], a: 1, exp: 'æ”¾å¤§æŒ¯åŠ¨ç°è±¡ï¼ˆè½¬æ¢æ³•ï¼‰ã€‚' },
            { type: 'mcq', q: 'ç”¨åŠ›æ•²é¼“ï¼Œè±†å­è·³å¾—____ï¼Œé¼“å£°è¶Š____ã€‚', opts: ['ä½ï¼Œå¼±', 'é«˜ï¼Œå¼º', 'é«˜ï¼Œå¼±'], a: 1, exp: 'åŠ›å¤§ï¼ŒæŒ¯å¹…å¤§ï¼Œè±†å­é«˜ï¼Œå£°å¼ºã€‚' },
            { type: 'mcq', q: 'è½»è½»æ•²é¼“ï¼Œè±†å­è·³å¾—____ï¼Œé¼“å£°è¶Š____ã€‚', opts: ['ä½ï¼Œå¼±', 'é«˜ï¼Œå¼º', 'ä½ï¼Œå¼º'], a: 0, exp: 'åŠ›å°ï¼ŒæŒ¯å¹…å°ï¼Œè±†å­ä½ï¼Œå£°å¼±ã€‚' },
            { type: 'mcq', q: 'è±†å­è·³èµ·çš„é«˜åº¦ä»£è¡¨äº†é¼“é¢æŒ¯åŠ¨çš„ï¼Ÿ', opts: ['å¿«æ…¢', 'å¹…åº¦', 'æ—¶é—´'], a: 1, exp: 'é«˜åº¦=å¹…åº¦ã€‚' },
            { type: 'fill', q: 'æˆ‘ä»¬ç”¨ä¸åŒçš„____æ•²å‡»é¼“é¢ï¼Œæ¥ç ”ç©¶å£°éŸ³å¼ºå¼±ã€‚', a: ['åŠ›é‡', 'åŠ›'], exp: 'æ”¹å˜ç”¨åŠ›å¤§å°ã€‚' },
            { type: 'mcq', q: 'å¦‚æœé¼“é¢ä¸Šä¸æ”¾è±†å­ï¼Œç”¨åŠ›æ•²é¼“æ—¶ï¼Ÿ', opts: ['é¼“é¢ä¸æŒ¯åŠ¨', 'æŒ¯åŠ¨ä½†ä¸æ˜æ˜¾', 'å£°éŸ³å˜å°'], a: 1, exp: 'ä¾ç„¶æŒ¯åŠ¨ï¼Œåªæ˜¯è‚‰çœ¼ä¸æ˜“è§‚å¯Ÿã€‚' },

            // 4. éŸ³å‰ä¸å°çƒ (6é¢˜)
            { type: 'mcq', q: 'æ‚¬æŒ‚ä¸€ä¸ªå°çƒé è¿‘éŸ³å‰ï¼Œæ˜¯ä¸ºäº†ï¼Ÿ', opts: ['è£…é¥°', 'æ˜¾ç¤ºéŸ³å‰æŒ¯åŠ¨å¹…åº¦çš„å˜åŒ–', 'æ”¹å˜éŸ³è‰²'], a: 1, exp: 'æ”¾å¤§æŒ¯åŠ¨å¹…åº¦ã€‚' },
            { type: 'mcq', q: 'å°çƒè¢«å¼¹å¾—è¶Šè¿œï¼Œè¯´æ˜éŸ³å‰æŒ¯åŠ¨çš„å¹…åº¦ï¼Ÿ', opts: ['è¶Šå°', 'è¶Šå¤§', 'ä¸å˜'], a: 1, exp: 'å¼¹å¾—è¿œ=æŒ¯å¹…å¤§ã€‚' },
            { type: 'mcq', q: 'å½“å°çƒè¢«å¼¹å¾—è¶Šè¿‘æ—¶ï¼Œæˆ‘ä»¬å¬åˆ°çš„å£°éŸ³ï¼Ÿ', opts: ['è¶Šå¼º', 'è¶Šå¼±', 'è¶Šé«˜'], a: 1, exp: 'å¼¹å¾—è¿‘=æŒ¯å¹…å°=å£°éŸ³å¼±ã€‚' },
            { type: 'matching', q: 'è¿çº¿éŸ³å‰å®éªŒï¼š', pairs: [{l:'é‡æ•²éŸ³å‰', r:'å°çƒå¼¹å¾—è¿œ'}, {l:'è½»æ•²éŸ³å‰', r:'å°çƒå¼¹å¾—è¿‘'}, {l:'å°çƒä¸åŠ¨', r:'æ— å£°éŸ³'}], exp: 'ç°è±¡å¯¹åº”ã€‚' },
            { type: 'fill', q: 'éŸ³å‰æŒ¯åŠ¨çš„å¹…åº¦è¶Š____ï¼Œå°çƒè¢«å¼¹å¼€çš„è·ç¦»è¶Šè¿œã€‚', a: ['å¤§'], exp: 'æŒ¯å¹…å¤§å¼¹å¾—è¿œã€‚' },
            { type: 'mcq', q: 'è¿™ä¸ªå®éªŒè¯´æ˜ï¼Œå£°éŸ³çš„å¼ºå¼±æ˜¯ç”±____å†³å®šçš„ã€‚', opts: ['æŒ¯åŠ¨å¿«æ…¢', 'æŒ¯åŠ¨å¹…åº¦', 'ç‰©ä½“ææ–™'], a: 1, exp: 'å¼ºå¼±ç”±æŒ¯å¹…å†³å®šã€‚' },

            // 5. ç»¼åˆä¸è¾¨æ (9é¢˜)
            { type: 'mcq', q: 'å…³äºå£°éŸ³çš„å¼ºå¼±ï¼Œä¸‹åˆ—è¯´æ³•æ­£ç¡®çš„æ˜¯ï¼Ÿ', opts: ['æŒ¯åŠ¨è¶Šå¿«å£°éŸ³è¶Šå¼º', 'æŒ¯åŠ¨å¹…åº¦è¶Šå¤§å£°éŸ³è¶Šå¼º', 'ç‰©ä½“è¶Šé•¿å£°éŸ³è¶Šå¼º'], a: 1, exp: 'å¼ºå¼±çœ‹å¹…åº¦ã€‚' },
            { type: 'mcq', q: 'è°ƒèŠ‚ç”µè§†æœºçš„éŸ³é‡æŒ‰é’®ï¼Œæ”¹å˜çš„æ˜¯å£°éŸ³çš„ï¼Ÿ', opts: ['é«˜ä½', 'å¼ºå¼±', 'éŸ³è‰²'], a: 1, exp: 'éŸ³é‡=å¼ºå¼±ã€‚' },
            { type: 'mcq', q: 'è€å¸ˆè®©ä½ â€œå¤§å£°ç‚¹â€ï¼Œæ˜¯è®©ä½ æ”¹å˜å£°éŸ³çš„ï¼Ÿ', opts: ['å¼ºå¼±', 'é«˜ä½', 'é€Ÿåº¦'], a: 0, exp: 'å¤§å£°=å¢å¼ºéŸ³é‡ã€‚' },
            { type: 'mcq', q: 'èšŠå­çš„å«å£°è™½ç„¶é«˜ï¼Œä½†æ˜¯å¾ˆ____ã€‚', opts: ['å¼º', 'å¼±'], a: 1, exp: 'èšŠå­å£°éŸ³å°–ï¼ˆé«˜ï¼‰ä½†éŸ³é‡å°ï¼ˆå¼±ï¼‰ã€‚' },
            { type: 'mcq', q: 'é›·å£°é€šå¸¸å¾ˆ____ï¼Œé›¨å£°é€šå¸¸å¾ˆ____ã€‚', opts: ['å¼±ï¼Œå¼º', 'å¼ºï¼Œå¼±', 'é«˜ï¼Œä½'], a: 1, exp: 'é›·å£°å¼ºï¼Œé›¨å£°å¼±ã€‚' },
            { type: 'fill', q: 'å£°éŸ³çš„å¼ºå¼±å•ä½æ˜¯åˆ†è´ï¼Œåˆ†è´æ•°è¶Š____ï¼Œå£°éŸ³è¶Šå¼ºã€‚', a: ['å¤§', 'é«˜'], exp: 'æ‹“å±•ï¼šåˆ†è´è¶Šå¤§è¶Šåµã€‚' },
            { type: 'mcq', q: 'è¦æƒ³è®©çš®ç­‹å‘å‡ºçš„å£°éŸ³å˜å¼ºï¼Œåº”è¯¥ï¼Ÿ', opts: ['æŠŠçš®ç­‹æ‹‰ç´§ç‚¹', 'ç”¨åŠ›æ‹¨åŠ¨çš®ç­‹', 'æ¢æ ¹ç²—çš®ç­‹'], a: 1, exp: 'ç”¨åŠ›æ‹¨åŠ¨å¢å¤§æŒ¯å¹…ã€‚' },
            { type: 'mcq', q: 'æŒ¯åŠ¨å¹…åº¦æ˜¯æŒ‡ç‰©ä½“æŒ¯åŠ¨æ—¶åç¦»ä¸­å¿ƒä½ç½®çš„ï¼Ÿ', opts: ['é€Ÿåº¦', 'è·ç¦»', 'æ¬¡æ•°'], a: 1, exp: 'æŒ¯å¹…æ˜¯åç¦»çš„è·ç¦»ã€‚' },
            { type: 'mcq', q: 'ä¸‹åˆ—å“ªä¸ªåŠ¨ä½œèƒ½è®©å£°éŸ³å˜å¼±ï¼Ÿ', opts: ['ç”¨åŠ›å¹', 'è½»è½»æ•²', 'ä½¿åŠ²å–Š'], a: 1, exp: 'è½»è½»æ•²å‡å°æŒ¯å¹…ã€‚' }
        ];

        // --- é€»è¾‘æ§åˆ¶ ---
        let currentQIndex = 0;
        let userScoreRaw = 0;
        let userMistakes = [];
        let selectedOption = null;
        let matchState = { left: null, right: null, matchedCount: 0, userPairs: [] };
        
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;
            if (type === 'correct') {
                osc.frequency.setValueAtTime(600, now); osc.frequency.exponentialRampToValueAtTime(1200, now + 0.15);
                gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.15);
                osc.start(now); osc.stop(now + 0.15);
            } else if (type === 'wrong') {
                osc.type = 'triangle'; osc.frequency.setValueAtTime(150, now); osc.frequency.linearRampToValueAtTime(100, now + 0.2);
                gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(now); osc.stop(now + 0.2);
            } else if (type === 'click') {
                osc.frequency.setValueAtTime(800, now); gain.gain.setValueAtTime(0.02, now); gain.gain.linearRampToValueAtTime(0, now + 0.05);
                osc.start(now); osc.stop(now + 0.05);
            }
        }

        function startQuiz() {
            document.getElementById('section-review').classList.remove('active');
            document.getElementById('section-quiz').classList.add('active');
            renderQuestion();
        }

        function renderQuestion() {
            const qData = quizData[currentQIndex];
            const area = document.getElementById('question-area');
            const nextBtn = document.getElementById('nextBtn');
            
            document.getElementById('q-index').innerText = currentQIndex + 1;
            document.getElementById('progressBar').style.width = ((currentQIndex) / quizData.length * 100) + "%";
            
            area.innerHTML = '';
            nextBtn.disabled = true; nextBtn.style.opacity = 0.5;
            selectedOption = null;

            const card = document.createElement('div');
            card.className = 'question-card';
            
            let tagText = qData.type === 'mcq' ? 'é€‰æ‹©é¢˜' : (qData.type === 'fill' ? 'å¡«ç©ºé¢˜' : 'è¿çº¿é¢˜');
            card.innerHTML = `<div class="q-content"><span class="q-tag">${tagText}</span>${qData.q}</div>`;

            if (qData.type === 'mcq') {
                qData.opts.forEach((opt, idx) => {
                    const btn = document.createElement('div');
                    btn.className = 'option-item'; btn.innerText = opt;
                    btn.onclick = () => selectMCQ(btn, idx);
                    card.appendChild(btn);
                });
            } else if (qData.type === 'fill') {
                const input = document.createElement('input');
                input.className = 'fill-input'; input.type = 'text'; input.placeholder = 'è¾“å…¥ç­”æ¡ˆ';
                input.oninput = (e) => {
                    selectedOption = e.target.value.trim();
                    nextBtn.disabled = !selectedOption;
                    nextBtn.style.opacity = selectedOption ? 1 : 0.5;
                };
                // æ·»åŠ å¤±ç„¦å³æ—¶åé¦ˆ
                input.onblur = () => {
                    if (selectedOption) {
                        const isCorrect = qData.a.some(ans => selectedOption.includes(ans));
                        setTimeout(() => {
                            if (isCorrect) {
                                InstantFeedback.onCorrect(input);
                            } else {
                                InstantFeedback.onWrong(input, qData.exp);
                            }
                        }, 200);
                    }
                };
                card.appendChild(input);
            } else if (qData.type === 'matching') {
                renderMatching(card, qData);
            }
            area.appendChild(card);
        }

        function selectMCQ(el, idx) {
            playSound('click');
            
            // ç§»é™¤å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.option-item').forEach(d => {
                d.classList.remove('selected', 'correct-feedback', 'wrong-feedback');
            });
            el.classList.add('selected');
            selectedOption = idx;
            
            // ç«‹å³æ£€æŸ¥ç­”æ¡ˆå¹¶ç»™å‡ºåé¦ˆ
            const qData = quizData[currentQIndex];
            let isCorrect = false;
            
            if (qData.type === 'fill') {
                if (qData.a.some(ans => idx.includes(ans))) isCorrect = true;
            } else {
                if (idx === qData.a) isCorrect = true;
            }
            
            // å»¶è¿Ÿåé¦ˆï¼Œè®©ç”¨æˆ·çœ‹åˆ°é€‰ä¸­æ•ˆæœ
            setTimeout(() => {
                if (isCorrect) {
                    InstantFeedback.onCorrect(el);
                } else {
                    InstantFeedback.onWrong(el, qData.exp);
                }
            }, 200);
            
            // å¯ç”¨ä¸‹ä¸€é¢˜æŒ‰é’®
            document.getElementById('nextBtn').disabled = false;
            document.getElementById('nextBtn').style.opacity = 1;
        }

        function renderMatching(card, qData) {
            const container = document.createElement('div');
            const leftCol = document.createElement('div'); leftCol.className = 'match-col';
            const rightCol = document.createElement('div'); rightCol.className = 'match-col';
            const row = document.createElement('div'); row.className = 'match-row';

            let rItems = [...qData.pairs].sort(()=>Math.random()-0.5);
            matchState = { left: null, right: null, matchedCount: 0, userPairs: [] };

            qData.pairs.forEach(p => {
                const btn = document.createElement('div');
                btn.className = 'match-btn'; btn.innerText = p.l; btn.dataset.val = p.l; btn.dataset.side = 'left';
                btn.onclick = (e) => handleMatchClick(e.target, qData.pairs.length);
                leftCol.appendChild(btn);
            });
            rItems.forEach(p => {
                const btn = document.createElement('div');
                btn.className = 'match-btn'; btn.innerText = p.r; btn.dataset.val = p.r; btn.dataset.side = 'right';
                btn.onclick = (e) => handleMatchClick(e.target, qData.pairs.length);
                rightCol.appendChild(btn);
            });

            row.appendChild(leftCol); row.appendChild(rightCol);
            card.appendChild(row);
        }

        function handleMatchClick(el, totalPairs) {
            playSound('click');
            const side = el.dataset.side;
            el.parentElement.querySelectorAll('.match-btn').forEach(b => b.classList.remove('selected'));
            el.classList.add('selected');
            
            if (side === 'left') matchState.left = el;
            else matchState.right = el;

            if (matchState.left && matchState.right) {
                matchState.userPairs.push({l: matchState.left.dataset.val, r: matchState.right.dataset.val});
                matchState.left.classList.remove('selected'); matchState.left.classList.add('matched');
                matchState.right.classList.remove('selected'); matchState.right.classList.add('matched');
                matchState.left = null; matchState.right = null;
                matchState.matchedCount++;
                if (matchState.matchedCount === totalPairs) {
                    document.getElementById('nextBtn').disabled = false;
                    document.getElementById('nextBtn').style.opacity = 1;
                }
            }
        }

        function nextQuestion() {
            const qData = quizData[currentQIndex];
            let isCorrect = false;
            let myAns = "";

            if (qData.type === 'mcq') {
                if (selectedOption === qData.a) isCorrect = true;
                myAns = qData.opts[selectedOption];
            } else if (qData.type === 'fill') {
                if (qData.a.some(ans => selectedOption.includes(ans))) isCorrect = true;
                myAns = selectedOption;
            } else if (qData.type === 'matching') {
                let correctCount = 0;
                matchState.userPairs.forEach(up => {
                    if (qData.pairs.some(p => p.l === up.l && p.r === up.r)) correctCount++;
                });
                if (correctCount === qData.pairs.length) isCorrect = true;
                myAns = "é…å¯¹é”™è¯¯";
            }

            if (isCorrect) {
                userScoreRaw++;
                playSound('correct');
            } else {
                playSound('wrong');
                userMistakes.push({ q: qData.q, my: myAns, exp: qData.exp });
            }

            currentQIndex++;
            if (currentQIndex < quizData.length) renderQuestion();
            else showResults();
        }

        function showResults() {
            document.getElementById('section-quiz').classList.remove('active');
            document.getElementById('section-result').classList.add('active');
            
            let finalScore = Math.round((userScoreRaw / quizData.length) * 100);
            let temp = 0;
            const scoreEl = document.getElementById('final-score');
            const timer = setInterval(() => {
                if(temp >= finalScore) { clearInterval(timer); scoreEl.innerText = finalScore; }
                else { temp++; scoreEl.innerText = temp; }
            }, 20);

            const reward = document.getElementById('reward-text');
            if(finalScore === 100) reward.innerText = "ğŸ‰ å®Œç¾ï¼ä½ æ˜¯éŸ³é‡æŒæ§è€…ï¼";
            else if(finalScore >= 80) reward.innerText = "ğŸŒŸ ä¼˜ç§€ï¼å¯¹å£°éŸ³å¼ºå¼±å¾ˆæ•æ„Ÿï¼";
            else reward.innerText = "ğŸ’ª åŠ æ²¹ï¼å†å¤ä¹ ä¸€ä¸‹æŒ¯åŠ¨å¹…åº¦çš„ç§˜å¯†ï¼";

            if (userMistakes.length > 0) {
                const list = document.getElementById('wrong-list');
                list.style.display = 'block';
                let html = '';
                userMistakes.forEach((m, i) => {
                    html += `<div class="wrong-item"><strong>${i+1}. ${m.q}</strong><br><span style="font-size:0.9em; color:#D32F2F">ä½ çš„å›ç­”ï¼š${m.my}</span><br><span style="font-size:0.9em; color:#388E3C">ğŸ’¡ è§£æï¼š${m.exp}</span></div>`;
                });
                list.innerHTML += html;
            }
        }
    </script>
</body>
</html>