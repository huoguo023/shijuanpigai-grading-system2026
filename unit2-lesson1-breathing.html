<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¬¬äºŒå•å…ƒï¼šæ„Ÿå—æˆ‘ä»¬çš„å‘¼å¸ - ç§‘å­¦å¤§é—¯å…³</title>
    <style>
        :root {
            --bg-color: #E8F5E9; /* æ¸…æ–°å‘¼å¸ç»¿ */
            --card-bg: #FFFFFF;
            --primary: #66BB6A; /* æ´»åŠ›ç»¿ */
            --secondary: #42A5F5; /* æ°§æ°”è“ */
            --accent: #FF7043; /* è­¦ç¤ºæ©™ */
            --text: #2E7D32;
            --font-main: "Microsoft YaHei", -apple-system, sans-serif;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text);
            margin: 0;
            padding: 10px;
            min-height: 100vh;
            background-image: radial-gradient(#C8E6C9 15%, transparent 16%);
            background-size: 25px 25px;
        }

        .container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            padding: 20px;
            text-align: center;
            border: 4px solid #A5D6A7;
            overflow: hidden;
        }

        h1 { color: #2E7D32; margin-top: 0; font-size: 1.6em; margin-bottom: 5px; }
        .subtitle { color: #43A047; font-size: 1em; margin-bottom: 15px; font-weight: bold; }

        /* åŒºåŸŸåˆ‡æ¢ */
        .section { display: none; animation: fadeIn 0.4s ease-out; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* çŸ¥è¯†ç‚¹å¡ç‰‡ */
        .knowledge-box {
            background: #F1F8E9;
            border-radius: 12px;
            padding: 15px;
            text-align: left;
            border-left: 5px solid #66BB6A;
            margin-bottom: 20px;
        }
        .knowledge-box h3 { margin: 0 0 10px 0; color: #1B5E20; border-bottom: 1px dashed #C8E6C9; padding-bottom: 5px; }
        .k-point { margin-bottom: 8px; font-size: 1em; line-height: 1.6; }
        .highlight { color: #E65100; font-weight: bold; background: #FFCCBC; padding: 0 4px; border-radius: 3px; }

        /* SVG æ¼”ç¤ºåŒº */
        .svg-stage {
            background: #FFF;
            border: 2px dashed #81C784;
            border-radius: 10px;
            padding: 10px;
            margin: 15px 0;
            text-align: center;
            position: relative;
        }
        .svg-caption { font-size: 0.9em; color: #558B2F; margin-top: 5px; font-style: italic; }

        .ctrl-btn {
            background: #66BB6A; color: white; border: none; padding: 8px 20px; 
            border-radius: 20px; margin: 5px; cursor: pointer; font-size: 0.9em;
            box-shadow: 0 3px 0 #2E7D32; transition: 0.1s;
        }
        .ctrl-btn:active { transform: translateY(2px); box-shadow: 0 1px 0 #2E7D32; }
        .ctrl-btn.blue { background: #42A5F5; box-shadow: 0 3px 0 #1565C0; }

        /* æŒ‰é’® */
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 0;
            width: 100%;
            font-size: 1.1em;
            border-radius: 50px;
            cursor: pointer;
            margin: 15px 0;
            font-weight: bold;
            box-shadow: 0 4px 0 #2E7D32;
            transition: 0.1s;
        }
        .btn:active { transform: translateY(3px); box-shadow: 0 1px 0 #2E7D32; }
        .btn-next { background: #FF7043; box-shadow: 0 4px 0 #E64A19; }

        /* é¢˜ç›®åŒº */
        .progress-container { height: 10px; background: #E0E0E0; border-radius: 5px; margin-bottom: 5px; overflow: hidden; }
        .progress-bar { height: 100%; background: #66BB6A; width: 0%; transition: width 0.3s; }
        
        .question-card { background: #FAFAFA; border-radius: 10px; padding: 15px; text-align: left; border: 2px solid #E0E0E0; margin-top: 10px; }
        .q-tag { background: #C8E6C9; color: #1B5E20; padding: 3px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; margin-right: 5px; }
        .q-content { font-size: 1.2em; font-weight: bold; margin: 10px 0 20px 0; line-height: 1.4; }

        /* é€‰é¡¹ */
        .option-item {
            background: white; border: 2px solid #A5D6A7; padding: 12px; border-radius: 8px;
            margin-bottom: 10px; cursor: pointer; transition: 0.2s;
        }
        .option-item.selected { background: #C8E6C9; border-color: #2E7D32; font-weight: bold; color: #1B5E20; }

        .fill-input { border: none; border-bottom: 3px solid #66BB6A; background: transparent; width: 120px; text-align: center; font-size: 1.2em; color: #2E7D32; border-radius: 0; }

        /* æ’åºé¢˜ (æ¨¡æ‹Ÿæ‹–æ‹½) */
        .sort-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .sort-item { 
            background: #E3F2FD; border: 1px solid #2196F3; color: #1565C0;
            padding: 8px 12px; border-radius: 20px; font-size: 0.9em; cursor: pointer;
        }
        .sort-box { 
            min-height: 50px; border: 2px dashed #BDBDBD; border-radius: 8px; 
            margin-top: 10px; padding: 10px; display: flex; flex-wrap: wrap; gap: 8px;
            background: #FAFAFA; align-items: center;
        }
        .sort-placeholder { color: #999; font-size: 0.9em; width: 100%; text-align: center; }

        /* é”™é¢˜è§£æ */
        .wrong-item { background: #FFEBEE; border-left: 4px solid #EF5350; padding: 10px; margin-bottom: 10px; text-align: left; border-radius: 4px; }
        .score-display { font-size: 4em; color: #FF7043; font-weight: bold; margin: 10px 0; }

    </style>

    <!-- å³æ—¶åé¦ˆç³»ç»Ÿ -->
    <style>
    .feedback-toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px); background: white; padding: 15px 25px; border-radius: 50px; box-shadow: 0 8px 30px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 12px; z-index: 10000; opacity: 0; transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55); font-size: 1.1rem; font-weight: bold; }
    .feedback-toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    .feedback-success { border: 3px solid #4CAF50; color: #2E7D32; }
    .feedback-error { border: 3px solid #FF9800; color: #E65100; }
    .toast-icon { width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; font-weight: bold; }
    .feedback-success .toast-icon { background: #4CAF50; color: white; }
    .feedback-error .toast-icon { background: #FF9800; color: white; }
    .confetti { position: fixed; width: 10px; height: 10px; z-index: 9999; pointer-events: none; }
    @keyframes confetti-fall { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
    @keyframes correct-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); } 20%, 40%, 60%, 80% { transform: translateX(8px); } }
    .option-item.correct-feedback { animation: correct-pulse 0.6s; background: #E8F5E9 !important; border-color: #4CAF50 !important; box-shadow: 0 0 20px rgba(76, 175, 80, 0.3) !important; }
    .option-item.wrong-feedback { animation: shake 0.5s; background: #FFF3E0 !important; border-color: #FF9800 !important; }
    .fill-input.correct-feedback { animation: correct-pulse 0.6s; background: #E8F5E9 !important; border-color: #4CAF50 !important; }
    .fill-input.wrong-feedback { animation: shake 0.5s; background: #FFF3E0 !important; border-color: #FF9800 !important; }
    </style>
</head>
<body>

    <!-- 1. å¤ä¹ åŒº -->
    <div id="section-review" class="container section active">
        <h1>ğŸ« çŸ¥è¯†å¤ä¹ </h1>
        <p class="subtitle">ç¬¬äºŒå•å…ƒç¬¬ä¸€è¯¾ï¼šæ„Ÿå—æˆ‘ä»¬çš„å‘¼å¸</p>

        <!-- çŸ¥è¯†ç‚¹ 1: å‘¼å¸å™¨å®˜ -->
        <div class="knowledge-box">
            <h3>1. å‘¼å¸å™¨å®˜ä¸è¿‡ç¨‹</h3>
            <div class="k-point">ğŸŒ¬ï¸ <strong>ä¸€æ¬¡å‘¼å¸</strong> = ä¸€å‘¼ + ä¸€å¸ã€‚</div>
            <div class="k-point">ğŸ›£ï¸ <strong>è·¯å¾„</strong>ï¼šé¼»è…”/å£è…” â†’ æ°”ç®¡ â†’ æ”¯æ°”ç®¡ â†’ <span class="highlight">è‚º</span>ã€‚</div>
            <div class="k-point">ğŸ”„ <strong>äº¤æ¢</strong>ï¼šè‚ºæ˜¯æ°”ä½“äº¤æ¢çš„åœºæ‰€ï¼ˆå¸å…¥æ°§æ°”ï¼Œå‘¼å‡ºäºŒæ°§åŒ–ç¢³ï¼‰ã€‚</div>
            
            <div class="svg-stage">
                <svg width="100%" height="150" viewBox="0 0 300 150">
                    <!-- äººä½“è½®å»“ç®€å›¾ -->
                    <path d="M130,20 Q150,20 170,20 Q180,40 170,60 L170,140 L130,140 L130,60 Q120,40 130,20" fill="none" stroke="#81C784" stroke-width="2"/>
                    <!-- å‘¼å¸é“ -->
                    <path d="M145,40 L150,40 L150,70" fill="none" stroke="#FF7043" stroke-width="4" stroke-linecap="round"/>
                    <text x="110" y="45" font-size="10" fill="#E64A19">é¼»/å£</text>
                    <text x="110" y="65" font-size="10" fill="#E64A19">æ°”ç®¡</text>
                    <!-- è‚º -->
                    <path d="M150,70 Q130,90 130,110 Q130,130 150,120" fill="#FFCCBC" stroke="#E64A19"/>
                    <path d="M150,70 Q170,90 170,110 Q170,130 150,120" fill="#FFCCBC" stroke="#E64A19"/>
                    <text x="180" y="100" font-size="10" fill="#E64A19">è‚º</text>
                    
                    <!-- æ°”ä½“é¢—ç²’åŠ¨ç”» -->
                    <circle id="air-particle" cx="145" cy="40" r="4" fill="#42A5F5"/>
                </svg>
                <button class="ctrl-btn blue" onclick="animRespiration()">æ¼”ç¤ºå‘¼å¸è·¯å¾„</button>
            </div>
        </div>

        <!-- çŸ¥è¯†ç‚¹ 2 & 5: è†ˆè‚Œä¸æ¨¡æ‹Ÿå®éªŒ -->
        <div class="knowledge-box">
            <h3>2. è†ˆè‚Œä¸å‘¼å¸è¿åŠ¨ (æ¨¡æ‹Ÿå®éªŒ)</h3>
            <div class="k-point">ğŸˆ <strong>å¸æ°”</strong>ï¼šè†ˆè‚Œ<span class="highlight">ä¸‹å‹</span> â†’ è‚ºéƒ¨æ‰©å¼  (æ°”çƒå˜å¤§)ã€‚</div>
            <div class="k-point">ğŸ’¨ <strong>å‘¼æ°”</strong>ï¼šè†ˆè‚Œ<span class="highlight">ä¸Šæ</span> â†’ è‚ºéƒ¨æ”¶ç¼© (æ°”çƒå˜å°)ã€‚</div>
            <div class="svg-stage">
                <svg width="100%" height="160" viewBox="0 0 200 160">
                    <!-- ç“¶å­ -->
                    <path d="M60,140 L60,40 Q100,10 140,40 L140,140" fill="none" stroke="#555" stroke-width="2"/>
                    <text x="150" y="80" font-size="10">èƒ¸è…”(ç“¶å­)</text>
                    <!-- æ°”ç®¡ -->
                    <line x1="100" y1="20" x2="100" y2="60" stroke="#555" stroke-width="4"/>
                    <text x="110" y="30" font-size="10">æ°”ç®¡</text>
                    <!-- è‚º(æ°”çƒ) -->
                    <path id="lung-balloon" d="M100,60 Q70,100 100,120 Q130,100 100,60" fill="#EF5350"/>
                    <text x="150" y="100" font-size="10">è‚º(æ°”çƒ)</text>
                    <!-- è†ˆè‚Œ(æ©¡èƒ¶è†œ) -->
                    <path id="diaphragm" d="M60,140 Q100,120 140,140" fill="none" stroke="#FFA726" stroke-width="4"/>
                    <text x="150" y="150" font-size="10" fill="#E65100">è†ˆè‚Œ(æ©¡èƒ¶è†œ)</text>
                    <!-- æ‰‹ -->
                    <path id="hand" d="M90,150 L110,150 L100,160 Z" fill="#8D6E63" transform="translate(0, -10)"/>
                </svg>
                <br>
                <button class="ctrl-btn" onclick="animSim('inhale')">ğŸ‘‡ æ‹‰ä¸‹ (å¸æ°”)</button>
                <button class="ctrl-btn" onclick="animSim('exhale')">ğŸ‘† é¡¶ä¸Š (å‘¼æ°”)</button>
            </div>
        </div>

        <!-- çŸ¥è¯†ç‚¹ 3 & 4: èƒ¸è…¹å˜åŒ– -->
        <div class="knowledge-box">
            <h3>3. èº«ä½“çš„å˜åŒ–</h3>
            <div class="k-point">ğŸ“¥ <strong>å¸æ°”</strong>ï¼šå«æœ‰æ°§æ°”çš„ç©ºæ°”è¿›å…¥ã€‚èƒ¸è…”<span class="highlight">æ‰©å¼ </span>ï¼Œè…¹éƒ¨æ”¶ç¼©ã€‚</div>
            <div class="k-point">ğŸ“¤ <strong>å‘¼æ°”</strong>ï¼šåºŸæ°”æ’å‡ºã€‚èƒ¸è…”<span class="highlight">æ”¶ç¼©</span>ï¼Œè…¹éƒ¨æ”¾æ¾ã€‚</div>
            <div class="k-point">ğŸŒ± <strong>æ°”ä½“ä½œç”¨</strong>ï¼šæ°§æ°”ç»´æŒç”Ÿå‘½ï¼ŒäºŒæ°§åŒ–ç¢³æ˜¯æ¤ç‰©å…»æ–™ã€‚</div>
            
            <div class="svg-stage">
                <svg width="100%" height="120" viewBox="0 0 300 120">
                    <!-- èº«ä½“è½®å»“ -->
                    <path id="body-outline" d="M120,20 L120,100" stroke="#333" stroke-width="2" fill="none"/>
                    <!-- èƒ¸éƒ¨ -->
                    <path id="chest" d="M120,30 Q150,30 150,60 Q150,90 120,90" fill="#E1F5FE" stroke="#0288D1"/>
                    <!-- ç®­å¤´ -->
                    <path id="chest-arrow" d="M160,60 L180,60" stroke="#FF7043" stroke-width="2" marker-end="url(#arrowhead)"/>
                    
                    <text x="200" y="50" font-size="12" fill="#333">çŠ¶æ€ï¼š<tspan id="status-text" font-weight="bold">å¹³é™</tspan></text>
                    <text x="200" y="70" font-size="10" fill="#555">èƒ¸è…”å˜åŒ–</text>

                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#FF7043" />
                        </marker>
                    </defs>
                </svg>
                <button class="ctrl-btn blue" onclick="animBody('in')">å¸æ°”æ¼”ç¤º</button>
                <button class="ctrl-btn" onclick="animBody('out')">å‘¼æ°”æ¼”ç¤º</button>
            </div>
        </div>

        <button class="btn" onclick="startQuiz()">è¿›å…¥35é¢˜é—¯å…³å¡”ï¼ğŸš€</button>
    </div>

    <!-- 2. é—¯å…³åŒº -->
    <div id="section-quiz" class="container section">
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div style="text-align:right; font-size:0.9em; color:#2E7D32;">é¢˜ç›®ï¼š<span id="q-index">1</span> / 35</div>

        <div id="question-area"></div>
        
        <button class="btn btn-next" id="nextBtn" onclick="nextQuestion()">ä¸‹ä¸€é¢˜ â–¶</button>
    </div>

    <!-- 3. ç»“ç®—åŒº -->
    <div id="section-result" class="container section">
        <h1>ğŸ† é—¯å…³æˆç»©</h1>
        <div class="score-display"><span id="final-score">0</span>åˆ†</div>
        <p id="reward-text"></p>
        
        <div id="wrong-list" style="display:none;">
            <h3 style="color:#D32F2F;">âŒ é”™é¢˜è§£æ</h3>
            <!-- é”™é¢˜å†…å®¹ -->
        </div>
        <button class="btn" onclick="location.reload()">ğŸ”„ é‡æ–°æŒ‘æˆ˜</button>
    </div>

    <script>
        // --- å³æ—¶åé¦ˆç³»ç»Ÿ ---
        const InstantFeedback = {
            audioCtx: null,
            encouragements: ['å¤ªæ£’äº†ï¼ç»§ç»­åŠ æ²¹ï¼ğŸŒŸ', 'ä½ çœŸèªæ˜ï¼ğŸ‘', 'å®Œå…¨æ­£ç¡®ï¼çœŸå‰å®³ï¼ğŸ¯', 'ç­”å¯¹äº†ï¼ä½ æ˜¯æœ€æ£’çš„ï¼â­', 'å¤ªä¼˜ç§€äº†ï¼ç»§ç»­ä¿æŒï¼ğŸ†', 'çœŸæ˜¯ä¸ªå°å¤©æ‰ï¼ğŸ’¡', 'å›ç­”å¾—éå¸¸å¥½ï¼ğŸ‘', 'ä½ æŒæ¡å¾—å¾ˆå¥½ï¼ğŸ“š'],
            hints: ['å†æƒ³æƒ³å“¦ï¼ä½ å¯ä»¥çš„ï¼ğŸ’ª', 'åˆ«ç°å¿ƒï¼Œå†è¯•ä¸€æ¬¡ï¼ğŸŒˆ', 'åŠ æ²¹ï¼ä»”ç»†çœ‹çœ‹é¢˜ç›®ï¼ğŸ‘€', 'æ²¡å…³ç³»ï¼Œç»§ç»­åŠªåŠ›ï¼ğŸ’«', 'å†çœ‹çœ‹çŸ¥è¯†ç‚¹å§ï¼ğŸ“–', 'ä¸è¦æ”¾å¼ƒï¼Œä½ èƒ½è¡Œï¼ğŸš€', 'æ€è€ƒä¸€ä¸‹ï¼Œä½ ä¸€å®šèƒ½æƒ³åˆ°ï¼ğŸ¤”', 'åŠ æ²¹ï¼ç›¸ä¿¡è‡ªå·±ï¼âœ¨'],
            
            init() { if (!this.audioCtx) this.audioCtx = new (window.AudioContext || window.webkitAudioContext)(); },
            
            playCorrectSound() {
                this.init(); if (this.audioCtx.state === 'suspended') this.audioCtx.resume();
                const notes = [523.25, 659.25, 783.99];
                notes.forEach((freq, i) => {
                    const osc = this.audioCtx.createOscillator(); const gain = this.audioCtx.createGain();
                    osc.connect(gain); gain.connect(this.audioCtx.destination);
                    const now = this.audioCtx.currentTime; const start = now + i * 0.1;
                    osc.frequency.value = freq; osc.type = 'sine';
                    gain.gain.setValueAtTime(0.15, start); gain.gain.exponentialRampToValueAtTime(0.01, start + 0.3);
                    osc.start(start); osc.stop(start + 0.3);
                });
            },
            
            playWrongSound() {
                this.init(); if (this.audioCtx.state === 'suspended') this.audioCtx.resume();
                const osc = this.audioCtx.createOscillator(); const gain = this.audioCtx.createGain();
                osc.connect(gain); gain.connect(this.audioCtx.destination);
                const now = this.audioCtx.currentTime;
                osc.frequency.setValueAtTime(300, now); osc.frequency.linearRampToValueAtTime(250, now + 0.2);
                osc.type = 'triangle';
                gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(now); osc.stop(now + 0.2);
            },
            
            showConfetti() {
                const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE'];
                for (let i = 0; i < 30; i++) {
                    setTimeout(() => {
                        const c = document.createElement('div'); c.className = 'confetti';
                        c.style.cssText = `width: ${Math.random() * 10 + 5}px; height: ${Math.random() * 10 + 5}px; background: ${colors[Math.floor(Math.random() * colors.length)]}; left: ${Math.random() * 100}%; top: -20px; border-radius: ${Math.random() > 0.5 ? '50%' : '0'}; animation: confetti-fall ${Math.random() * 2 + 2}s linear forwards; transform: rotate(${Math.random() * 360}deg);`;
                        document.body.appendChild(c);
                        setTimeout(() => c.remove(), 4000);
                    }, i * 30);
                }
            },
            
            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `feedback-toast feedback-${type}`;
                toast.innerHTML = `<div class="toast-icon">${type === 'success' ? 'âœ“' : 'âœ—'}</div><div class="toast-message">${message}</div>`;
                document.body.appendChild(toast);
                setTimeout(() => toast.classList.add('show'), 10);
                setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.remove(), 300); }, 2500);
            },
            
            onCorrect(element) {
                this.playCorrectSound(); this.showConfetti();
                const msg = this.encouragements[Math.floor(Math.random() * this.encouragements.length)];
                this.showToast(msg, 'success');
                if (element) { element.classList.add('correct-feedback'); setTimeout(() => element.classList.remove('correct-feedback'), 600); }
            },
            
            onWrong(element, hint = '') {
                this.playWrongSound();
                const msg = this.hints[Math.floor(Math.random() * this.hints.length)] + (hint ? `<br><small style="font-size:0.85em;">ğŸ’¡ ${hint}</small>` : '');
                this.showToast(msg, 'error');
                if (element) { element.classList.add('wrong-feedback'); setTimeout(() => element.classList.remove('wrong-feedback'), 500); }
            }
        };
        InstantFeedback.init();

        // --- SVG åŠ¨ç”»é€»è¾‘ ---
        
        function animRespiration() {
            const particle = document.getElementById('air-particle');
            // ç®€å•çš„è·¯å¾„åŠ¨ç”»ï¼šé¼»->æ°”ç®¡->æ”¯æ°”ç®¡->è‚º
            // Reset
            while(particle.firstChild) particle.removeChild(particle.firstChild);
            
            const anim = document.createElementNS("http://www.w3.org/2000/svg", "animate");
            anim.setAttribute("attributeName", "cy");
            anim.setAttribute("values", "40; 70; 100; 70; 40"); // è¿› -> è‚º -> å‡º
            anim.setAttribute("dur", "3s");
            anim.setAttribute("repeatCount", "1");
            particle.appendChild(anim);
            anim.beginElement();
        }

        function animSim(type) {
            const diaphragm = document.getElementById('diaphragm');
            const balloon = document.getElementById('lung-balloon');
            const hand = document.getElementById('hand');

            if (type === 'inhale') {
                // æ‹‰ä¸‹ï¼šè†ˆè‚Œä¸‹ç§»å˜å¹³ï¼Œæ°”çƒå˜å¤§
                diaphragm.setAttribute("d", "M60,140 Q100,155 140,140"); // å‘ä¸‹å¼¯æ›²
                balloon.setAttribute("d", "M100,60 Q60,110 100,135 Q140,110 100,60"); // å˜å¤§
                hand.setAttribute("transform", "translate(0, 10)");
            } else {
                // é¡¶ä¸Šï¼šè†ˆè‚Œä¸Šæ‹±ï¼Œæ°”çƒå˜å°
                diaphragm.setAttribute("d", "M60,140 Q100,110 140,140"); // å‘ä¸Šæ‹±èµ·
                balloon.setAttribute("d", "M100,60 Q80,90 100,100 Q120,90 100,60"); // ç˜ªæ‰
                hand.setAttribute("transform", "translate(0, -15)");
            }
        }

        function animBody(type) {
            const chest = document.getElementById('chest');
            const text = document.getElementById('status-text');
            const arrow = document.getElementById('chest-arrow');

            // ç®€å•æ¨¡æ‹Ÿèƒ¸è…”å¤§å°å˜åŒ–
            if (type === 'in') {
                // å¸æ°”ï¼šèƒ¸è…”æ‰©å¼ 
                chest.setAttribute("d", "M120,30 Q170,30 170,60 Q170,90 120,90");
                text.textContent = "å¸æ°” (æ‰©å¼ )";
                text.setAttribute("fill", "#1E88E5");
                arrow.setAttribute("d", "M140,60 L170,60"); // å‘å¤–ç®­å¤´
            } else {
                // å‘¼æ°”ï¼šèƒ¸è…”æ”¶ç¼©
                chest.setAttribute("d", "M120,30 Q140,30 140,60 Q140,90 120,90");
                text.textContent = "å‘¼æ°” (æ”¶ç¼©)";
                text.setAttribute("fill", "#43A047");
                arrow.setAttribute("d", "M170,60 L140,60"); // å‘å†…ç®­å¤´
            }
        }

        // --- 35é“é¢˜åº“ ---
        const quizData = [
            // 1. åŸºç¡€æ¦‚å¿µ (5é¢˜)
            { type: 'mcq', q: 'äººçš„â€œä¸€å‘¼ä¸€å¸â€ç®—____æ¬¡å‘¼å¸ã€‚', opts: ['1', '2', '0.5'], a: 0, exp: 'ä¸€å‘¼ä¸€å¸ç®—ä¸€æ¬¡ã€‚' },
            { type: 'sort', q: 'è¯·æŒ‰ç©ºæ°”è¿›å…¥ä½“å†…çš„é¡ºåºæ’åˆ—å™¨å®˜ï¼š', items: ['é¼»è…”', 'è‚º', 'æ°”ç®¡'], answerOrder: ['é¼»è…”', 'æ°”ç®¡', 'è‚º'], exp: 'é¼»è…”->æ°”ç®¡->æ”¯æ°”ç®¡->è‚ºã€‚' },
            { type: 'mcq', q: 'è¿›è¡Œæ°”ä½“äº¤æ¢çš„â€œä¸­è½¬ç«™â€æ˜¯ï¼Ÿ', opts: ['é¼»è…”', 'æ°”ç®¡', 'è‚º'], a: 2, exp: 'è‚ºæ˜¯æ°”ä½“äº¤æ¢åœºæ‰€ã€‚' },
            { type: 'fill', q: 'æ— è®ºç™½å¤©è¿˜æ˜¯å¤œæ™šï¼Œæˆ‘ä»¬éƒ½åœ¨____ï¼Œè¿™æ˜¯ç”Ÿå‘½çš„é‡è¦æ´»åŠ¨ã€‚', a: ['å‘¼å¸'], exp: 'å‘¼å¸æ—¶åˆ»è¿›è¡Œã€‚' },
            { type: 'mcq', q: 'ä¸‹åˆ—å“ªä¸ªå™¨å®˜ä¸å‚ä¸å‘¼å¸ï¼Ÿ', opts: ['èƒƒ', 'æ”¯æ°”ç®¡', 'é¼»è…”'], a: 0, exp: 'èƒƒæ˜¯æ¶ˆåŒ–å™¨å®˜ã€‚' },

            // 2. å‘¼å¸è¿åŠ¨æœºåˆ¶ (10é¢˜)
            { type: 'mcq', q: 'å¸æ°”æ—¶ï¼Œèƒ¸è…”ä¼šï¼Ÿ', opts: ['æ”¶ç¼©', 'æ‰©å¼ ', 'ä¸å˜'], a: 1, exp: 'å¸æ°”èƒ¸è…”æ‰©å¼ ã€‚' },
            { type: 'mcq', q: 'å¸æ°”æ—¶ï¼Œè…¹éƒ¨ä¼šï¼Ÿ', opts: ['æ”¶ç¼©', 'æ”¾æ¾', 'æ‰©å¼ '], a: 0, exp: 'å¸æ°”æ—¶è…¹éƒ¨æ”¶ç¼©ï¼ˆé…åˆèƒ¸è…”æ‰©å¼ ï¼‰ã€‚' },
            { type: 'mcq', q: 'å‘¼æ°”æ—¶ï¼Œèƒ¸è…”ä¼šï¼Ÿ', opts: ['æ”¶ç¼©', 'æ‰©å¼ ', 'ä¸å˜'], a: 0, exp: 'å‘¼æ°”èƒ¸è…”æ”¶ç¼©ã€‚' },
            { type: 'mcq', q: 'å‘¼æ°”æ—¶ï¼Œè…¹éƒ¨ä¼šï¼Ÿ', opts: ['æ”¶ç¼©', 'æ”¾æ¾', 'ä¸å˜'], a: 1, exp: 'å‘¼æ°”è…¹éƒ¨æ”¾æ¾ã€‚' },
            { type: 'sort', q: 'è¯·æ’åˆ—å¸æ°”çš„è¿‡ç¨‹ï¼š', items: ['ç©ºæ°”è¿›å…¥', 'èƒ¸è…”æ‰©å¼ ', 'è†ˆè‚Œä¸‹å‹'], answerOrder: ['è†ˆè‚Œä¸‹å‹', 'èƒ¸è…”æ‰©å¼ ', 'ç©ºæ°”è¿›å…¥'], exp: 'è‚Œè‚‰è¿åŠ¨å¯¼è‡´ä½“ç§¯å˜åŒ–ï¼Œæ°”å‹æ”¹å˜ï¼Œç©ºæ°”è¿›å…¥ã€‚' },
            { type: 'mcq', q: 'æˆ‘ä»¬å‘¼å¸æ—¶ï¼Œæ°”ä½“è¿›å‡ºçš„åŠ¨åŠ›ä¸»è¦æ¥è‡ªï¼Ÿ', opts: ['è‚ºéƒ¨è‡ªå·±åŠ¨', 'å‘¼å¸è‚Œè‚‰(è†ˆè‚Œç­‰)çš„è¿åŠ¨', 'å˜´å·´å¼ åˆ'], a: 1, exp: 'è†ˆè‚Œè¿åŠ¨å¸¦åŠ¨è‚ºã€‚' },
            { type: 'fill', q: 'å¸æ°”æ˜¯å«æœ‰____çš„ç©ºæ°”è¿›å…¥è‚ºçš„è¿‡ç¨‹ã€‚', a: ['æ°§æ°”'], exp: 'å¸å…¥æ°§æ°”ã€‚' },
            { type: 'fill', q: 'å‘¼æ°”æ˜¯å«æœ‰____ç­‰åºŸæ°”æ’å‡ºä½“å¤–çš„è¿‡ç¨‹ã€‚', a: ['äºŒæ°§åŒ–ç¢³'], exp: 'å‘¼å‡ºäºŒæ°§åŒ–ç¢³ã€‚' },
            { type: 'mcq', q: 'åšæ·±å‘¼å¸æ—¶ï¼Œæˆ‘ä»¬çš„èƒ¸éƒ¨èµ·ä¼ä¼šï¼Ÿ', opts: ['å˜å°', 'å˜å¤§', 'ä¸å˜'], a: 1, exp: 'æ·±å‘¼å¸å¹…åº¦å¤§ã€‚' },
            { type: 'mcq', q: 'è¿åŠ¨åï¼Œå‘¼å¸æ¬¡æ•°ä¼šï¼Ÿ', opts: ['å¢åŠ ', 'å‡å°‘', 'ä¸å˜'], a: 0, exp: 'è¿åŠ¨éœ€æ°§é‡å¤§ï¼Œå‘¼å¸åŠ å¿«ã€‚' },

            // 3. è†ˆè‚Œä¸æ¨¡æ‹Ÿå®éªŒ (10é¢˜)
            { type: 'mcq', q: 'åœ¨å‘¼å¸æ¨¡æ‹Ÿå®éªŒä¸­ï¼Œå¡‘æ–™ç“¶æ¨¡æ‹Ÿçš„æ˜¯ï¼Ÿ', opts: ['è‚º', 'èƒ¸è…”', 'æ°”ç®¡'], a: 1, exp: 'ç“¶å­æ¨¡æ‹Ÿèƒ¸è…”ã€‚' },
            { type: 'mcq', q: 'åœ¨å‘¼å¸æ¨¡æ‹Ÿå®éªŒä¸­ï¼Œæ°”çƒæ¨¡æ‹Ÿçš„æ˜¯ï¼Ÿ', opts: ['è‚º', 'è†ˆè‚Œ', 'èƒƒ'], a: 0, exp: 'æ°”çƒæ¨¡æ‹Ÿè‚ºã€‚' },
            { type: 'mcq', q: 'åœ¨å‘¼å¸æ¨¡æ‹Ÿå®éªŒä¸­ï¼Œåº•éƒ¨çš„æ©¡èƒ¶è†œæ¨¡æ‹Ÿçš„æ˜¯ï¼Ÿ', opts: ['è…¹éƒ¨', 'è†ˆè‚Œ', 'çš®è‚¤'], a: 1, exp: 'æ©¡èƒ¶è†œæ¨¡æ‹Ÿè†ˆè‚Œã€‚' },
            { type: 'mcq', q: 'å‘ä¸‹æ‹‰åŠ¨æ©¡èƒ¶è†œï¼Œæ°”çƒä¼šï¼Ÿ', opts: ['å˜å¤§(å¸æ°”)', 'å˜å°(å‘¼æ°”)'], a: 0, exp: 'ä¸‹æ‹‰->ç©ºé—´å˜å¤§->å¸æ°”ã€‚' },
            { type: 'mcq', q: 'å‘ä¸Šé¡¶èµ·æ©¡èƒ¶è†œï¼Œæ°”çƒä¼šï¼Ÿ', opts: ['å˜å¤§(å¸æ°”)', 'å˜å°(å‘¼æ°”)'], a: 1, exp: 'ä¸Šé¡¶->ç©ºé—´å˜å°->å‘¼æ°”ã€‚' },
            { type: 'fill', q: 'è†ˆè‚Œæ˜¯ä½äºèƒ¸è…”å’Œ____ä¹‹é—´çš„è‚Œè‚‰ã€‚', a: ['è…¹è…”'], exp: 'åˆ†éš”èƒ¸è…¹ã€‚' },
            { type: 'mcq', q: 'è†ˆè‚Œä¸‹å‹æ—¶ï¼Œèº«ä½“å¤„äº____çŠ¶æ€ã€‚', opts: ['å¸æ°”', 'å‘¼æ°”'], a: 0, exp: 'ä¸‹å‹->å¸æ°”ã€‚' },
            { type: 'mcq', q: 'è†ˆè‚Œä¸Šææ—¶ï¼Œèº«ä½“å¤„äº____çŠ¶æ€ã€‚', opts: ['å¸æ°”', 'å‘¼æ°”'], a: 1, exp: 'ä¸Šæ->å‘¼æ°”ã€‚' },
            { type: 'sort', q: 'è¯·è¿æ¥æ¨¡æ‹Ÿè£…ç½®ä¸äººä½“å™¨å®˜ï¼š', items: ['å¸ç®¡-æ°”ç®¡', 'æ°”çƒ-è‚º', 'ç“¶å­-èƒ¸è…”'], answerOrder: ['å¸ç®¡-æ°”ç®¡', 'æ°”çƒ-è‚º', 'ç“¶å­-èƒ¸è…”'], exp: 'è£…ç½®å¯¹åº”å…³ç³»ã€‚' },
            { type: 'mcq', q: 'å¦‚æœæ¨¡æ‹Ÿè£…ç½®çš„ç“¶å­ç ´äº†ä¸ªæ´ï¼Œå®éªŒï¼Ÿ', opts: ['èƒ½æˆåŠŸ', 'ä¸èƒ½æˆåŠŸ'], a: 1, exp: 'èƒ¸è…”éœ€è¦å¯†å°æ‰èƒ½æ”¹å˜æ°”å‹ã€‚' },

            // 4. æ°”ä½“çŸ¥è¯† (5é¢˜)
            { type: 'mcq', q: '____æ˜¯ç»´æŒç”Ÿå‘½æ‰€å¿…éœ€çš„ç‰©è´¨ã€‚', opts: ['æ°®æ°”', 'æ°§æ°”', 'äºŒæ°§åŒ–ç¢³'], a: 1, exp: 'æ°§æ°”ç»´æŒç”Ÿå‘½ã€‚' },
            { type: 'mcq', q: '____æ˜¯æ¤ç‰©åˆ¶é€ å…»æ–™æ‰€å¿…éœ€çš„åŸæ–™ã€‚', opts: ['æ°§æ°”', 'äºŒæ°§åŒ–ç¢³', 'æ°´è’¸æ°”'], a: 1, exp: 'æ¤ç‰©å…‰åˆä½œç”¨éœ€è¦äºŒæ°§åŒ–ç¢³ã€‚' },
            { type: 'mcq', q: 'å‘¼å‡ºçš„æ°”ä½“ä¸­ï¼Œæ°§æ°”å«é‡æ¯”å¸å…¥æ—¶ï¼Ÿ', opts: ['å¤š', 'å°‘', 'ä¸€æ ·'], a: 1, exp: 'æ°§æ°”è¢«èº«ä½“æ¶ˆè€—äº†ã€‚' },
            { type: 'mcq', q: 'å‘¼å‡ºçš„æ°”ä½“ä¸­ï¼ŒäºŒæ°§åŒ–ç¢³å«é‡æ¯”å¸å…¥æ—¶ï¼Ÿ', opts: ['å¤š', 'å°‘', 'ä¸€æ ·'], a: 0, exp: 'èº«ä½“äº§ç”Ÿäº†äºŒæ°§åŒ–ç¢³ã€‚' },
            { type: 'fill', q: 'äººå‘¼å¸æ—¶ï¼Œå¸å…¥æ°§æ°”ï¼Œå‘¼å‡º____ã€‚', a: ['äºŒæ°§åŒ–ç¢³'], exp: 'åŸºæœ¬æ°”ä½“äº¤æ¢ã€‚' },

            // 5. ç»¼åˆåº”ç”¨ (5é¢˜)
            { type: 'mcq', q: 'ä¸‹åˆ—ä¹ æƒ¯æœ‰åˆ©äºå‘¼å¸å™¨å®˜å¥åº·çš„æ˜¯ï¼Ÿ', opts: ['å¸çƒŸ', 'ç»å¸¸å¼€çª—é€šé£', 'è’™å¤´ç¡è§‰'], a: 1, exp: 'é€šé£ä¿æŒç©ºæ°”æ–°é²œã€‚' },
            { type: 'mcq', q: 'ä¸ºä»€ä¹ˆç¡è§‰æ—¶ä¹Ÿè¦å‘¼å¸ï¼Ÿ', opts: ['ä¹ æƒ¯äº†', 'èº«ä½“å„å™¨å®˜è¿˜éœ€è¦æ°§æ°”å·¥ä½œ', 'å› ä¸ºåœ¨åšæ¢¦'], a: 1, exp: 'ç”Ÿå‘½æ´»åŠ¨ä¸åœæ­¢ï¼Œéœ€æ°§é‡å°±åœ¨ã€‚' },
            { type: 'sort', q: 'ç©ºæ°”è¿›å…¥è‚ºçš„æ­£ç¡®è·¯å¾„ï¼š', items: ['æ°”ç®¡', 'æ”¯æ°”ç®¡', 'è‚º'], answerOrder: ['æ°”ç®¡', 'æ”¯æ°”ç®¡', 'è‚º'], exp: 'è§£å‰–ç»“æ„é¡ºåºã€‚' },
            { type: 'mcq', q: 'å½“æˆ‘ä»¬æ½œæ°´æ—¶ï¼Œéœ€è¦æºå¸¦ï¼Ÿ', opts: ['æ°§æ°”ç“¶', 'ç­ç«å™¨', 'é£æ‰‡'], a: 0, exp: 'æ°´ä¸‹ç¼ºæ°§ã€‚' },
            { type: 'mcq', q: 'æ¤ç‰©å’Œäººç±»åœ¨æ°”ä½“äº¤æ¢ä¸Šæ˜¯ï¼Ÿ', opts: ['äº’è¡¥çš„', 'å†²çªçš„'], a: 0, exp: 'äººå‘¼å‡ºäºŒæ°§åŒ–ç¢³ç»™æ¤ç‰©ï¼Œæ¤ç‰©äº§æ°§æ°”ç»™äººã€‚' }
        ];

        // --- é€»è¾‘æ§åˆ¶ ---
        let currentQIndex = 0;
        let userScoreRaw = 0;
        let userMistakes = [];
        let selectedOption = null;
        let sortOrder = []; // For sort questions

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;
            if (type === 'correct') {
                osc.frequency.setValueAtTime(600, now); osc.frequency.exponentialRampToValueAtTime(1200, now + 0.15);
                gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.15);
                osc.start(now); osc.stop(now + 0.15);
            } else if (type === 'wrong') {
                osc.type = 'triangle'; osc.frequency.setValueAtTime(150, now); osc.frequency.linearRampToValueAtTime(100, now + 0.2);
                gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(now); osc.stop(now + 0.2);
            } else if (type === 'click') {
                osc.frequency.setValueAtTime(400, now); gain.gain.setValueAtTime(0.05, now); gain.gain.linearRampToValueAtTime(0, now + 0.05);
                osc.start(now); osc.stop(now + 0.05);
            }
        }

        function startQuiz() {
            document.getElementById('section-review').classList.remove('active');
            document.getElementById('section-quiz').classList.add('active');
            renderQuestion();
        }

        function renderQuestion() {
            const qData = quizData[currentQIndex];
            const area = document.getElementById('question-area');
            const nextBtn = document.getElementById('nextBtn');
            
            document.getElementById('q-index').innerText = currentQIndex + 1;
            document.getElementById('progressBar').style.width = ((currentQIndex) / quizData.length * 100) + "%";
            
            area.innerHTML = '';
            nextBtn.disabled = true; nextBtn.style.opacity = 0.5;
            selectedOption = null;
            sortOrder = [];

            const card = document.createElement('div');
            card.className = 'question-card';
            
            let tagText = qData.type === 'mcq' ? 'é€‰æ‹©é¢˜' : (qData.type === 'fill' ? 'å¡«ç©ºé¢˜' : 'æ’åºé¢˜');
            card.innerHTML = `<div class="q-content"><span class="q-tag">${tagText}</span>${qData.q}</div>`;

            if (qData.type === 'mcq') {
                qData.opts.forEach((opt, idx) => {
                    const btn = document.createElement('div');
                    btn.className = 'option-item'; btn.innerText = opt;
                    btn.onclick = () => selectMCQ(btn, idx);
                    card.appendChild(btn);
                });
            } else if (qData.type === 'fill') {
                const input = document.createElement('input');
                input.className = 'fill-input'; input.type = 'text'; input.placeholder = 'è¾“å…¥ç­”æ¡ˆ';
                input.oninput = (e) => {
                    selectedOption = e.target.value.trim();
                    nextBtn.disabled = !selectedOption;
                    nextBtn.style.opacity = selectedOption ? 1 : 0.5;
                };
                // æ·»åŠ å¤±ç„¦å³æ—¶åé¦ˆ
                input.onblur = () => {
                    if (selectedOption) {
                        const isCorrect = qData.a.some(ans => selectedOption.includes(ans));
                        setTimeout(() => {
                            if (isCorrect) {
                                InstantFeedback.onCorrect(input);
                            } else {
                                InstantFeedback.onWrong(input, qData.exp);
                            }
                        }, 200);
                    }
                };
                card.appendChild(input);
            } else if (qData.type === 'sort') {
                renderSort(card, qData);
            }
            area.appendChild(card);
        }

        function selectMCQ(el, idx) {
            playSound('click');
            document.querySelectorAll('.option-item').forEach(i => i.classList.remove('selected', 'correct-feedback', 'wrong-feedback'));
            el.classList.add('selected');
            selectedOption = idx;
            
            // ç«‹å³æ£€æŸ¥ç­”æ¡ˆå¹¶ç»™å‡ºåé¦ˆ
            const qData = quizData[currentQIndex];
            const isCorrect = (idx === qData.a);
            
            setTimeout(() => {
                if (isCorrect) {
                    InstantFeedback.onCorrect(el);
                } else {
                    InstantFeedback.onWrong(el, qData.exp);
                }
            }, 200);
            
            document.getElementById('nextBtn').disabled = false;
            document.getElementById('nextBtn').style.opacity = 1;
        }

        function renderSort(card, qData) {
            const container = document.createElement('div');
            const sourceDiv = document.createElement('div'); sourceDiv.className = 'sort-container';
            const targetDiv = document.createElement('div'); targetDiv.className = 'sort-box';
            targetDiv.innerHTML = '<div class="sort-placeholder">ç‚¹å‡»é€‰é¡¹æŒ‰é¡ºåºæ’åˆ—</div>';

            // æ‰“ä¹±é€‰é¡¹
            let items = [...qData.items].sort(()=>Math.random()-0.5);
            
            items.forEach(item => {
                const btn = document.createElement('div');
                btn.className = 'sort-item';
                btn.innerText = item;
                btn.onclick = () => {
                    playSound('click');
                    // ç§»åŠ¨åˆ°ç›®æ ‡åŒºåŸŸ
                    if(targetDiv.contains(btn)) {
                        sourceDiv.appendChild(btn); // ç§»å›
                        sortOrder = sortOrder.filter(i => i !== item);
                    } else {
                        if(targetDiv.querySelector('.sort-placeholder')) targetDiv.innerHTML = '';
                        targetDiv.appendChild(btn); // ç§»å…¥
                        sortOrder.push(item);
                    }
                    // æ£€æŸ¥æ˜¯å¦å®Œæˆ
                    if(sortOrder.length === qData.items.length) {
                         document.getElementById('nextBtn').disabled = false;
                         document.getElementById('nextBtn').style.opacity = 1;
                    } else {
                         document.getElementById('nextBtn').disabled = true;
                         document.getElementById('nextBtn').style.opacity = 0.5;
                    }
                };
                sourceDiv.appendChild(btn);
            });

            container.appendChild(sourceDiv);
            container.appendChild(targetDiv);
            card.appendChild(container);
        }

        function nextQuestion() {
            const qData = quizData[currentQIndex];
            let isCorrect = false;
            let myAns = "";

            if (qData.type === 'mcq') {
                if (selectedOption === qData.a) isCorrect = true;
                myAns = qData.opts[selectedOption];
            } else if (qData.type === 'fill') {
                if (qData.a.some(ans => selectedOption.includes(ans))) isCorrect = true;
                myAns = selectedOption;
            } else if (qData.type === 'sort') {
                if (JSON.stringify(sortOrder) === JSON.stringify(qData.answerOrder)) isCorrect = true;
                myAns = sortOrder.join(' -> ');
            }

            if (isCorrect) {
                userScoreRaw++;
                playSound('correct');
            } else {
                playSound('wrong');
                userMistakes.push({ q: qData.q, my: myAns, exp: qData.exp });
            }

            currentQIndex++;
            if (currentQIndex < quizData.length) renderQuestion();
            else showResults();
        }

        function showResults() {
            document.getElementById('section-quiz').classList.remove('active');
            document.getElementById('section-result').classList.add('active');
            
            let finalScore = Math.round((userScoreRaw / quizData.length) * 100);
            let temp = 0;
            const scoreEl = document.getElementById('final-score');
            const timer = setInterval(() => {
                if(temp >= finalScore) { clearInterval(timer); scoreEl.innerText = finalScore; }
                else { temp++; scoreEl.innerText = temp; }
            }, 20);

            const reward = document.getElementById('reward-text');
            if(finalScore === 100) reward.innerText = "ğŸ‰ å®Œç¾ï¼ä½ æ˜¯å‘¼å¸å°ä¸“å®¶ï¼";
            else if(finalScore >= 80) reward.innerText = "ğŸŒŸ ä¼˜ç§€ï¼èº«ä½“çŸ¥è¯†æŒæ¡å¾—ä¸é”™ï¼";
            else reward.innerText = "ğŸ’ª åŠ æ²¹ï¼å†å¤ä¹ ä¸€ä¸‹å‘¼å¸çš„ç§˜å¯†ï¼";

            if (userMistakes.length > 0) {
                const list = document.getElementById('wrong-list');
                list.style.display = 'block';
                let html = '';
                userMistakes.forEach((m, i) => {
                    html += `<div class="wrong-item"><strong>${i+1}. ${m.q}</strong><br><span style="font-size:0.9em; color:#D32F2F">ä½ çš„å›ç­”ï¼š${m.my}</span><br><span style="font-size:0.9em; color:#388E3C">ğŸ’¡ è§£æï¼š${m.exp}</span></div>`;
                });
                list.innerHTML += html;
            }
        }
    </script>
</body>
</html>