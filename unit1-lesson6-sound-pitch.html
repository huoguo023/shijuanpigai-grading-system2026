<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¬¬å…­è¯¾ï¼šå£°éŸ³çš„é«˜ä¸ä½ - ç§‘å­¦å¤§é—¯å…³</title>
    <style>
        :root {
            --bg-color: #E0F7FA; /* æµ…é’èƒŒæ™¯ */
            --card-bg: #FFFFFF;
            --primary: #00BCD4; /* ç§‘æŠ€è“ */
            --high-pitch: #FF5252; /* é«˜éŸ³çº¢ */
            --low-pitch: #3F51B5; /* ä½éŸ³è“ */
            --text: #37474F;
            --font-main: "Microsoft YaHei", -apple-system, sans-serif;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text);
            margin: 0;
            padding: 10px;
            min-height: 100vh;
            background-image: radial-gradient(#B2EBF2 15%, transparent 16%);
            background-size: 25px 25px;
        }

        .container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            padding: 20px;
            text-align: center;
            border: 4px solid #80DEEA;
            overflow: hidden;
        }

        h1 { color: #0097A7; margin-top: 0; font-size: 1.6em; margin-bottom: 5px; }
        .subtitle { color: #FF9800; font-size: 1em; margin-bottom: 15px; font-weight: bold; }

        /* åŒºåŸŸåˆ‡æ¢ */
        .section { display: none; animation: slideUp 0.4s ease-out; }
        .active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* çŸ¥è¯†ç‚¹å¡ç‰‡ */
        .knowledge-box {
            background: #E0F2F1;
            border-radius: 12px;
            padding: 15px;
            text-align: left;
            border-left: 5px solid #00BCD4;
            margin-bottom: 20px;
        }
        .knowledge-box h3 { margin: 0 0 10px 0; color: #00838F; border-bottom: 1px dashed #80DEEA; padding-bottom: 5px; }
        .k-point { margin-bottom: 8px; font-size: 1em; line-height: 1.6; }
        .highlight { color: #D84315; font-weight: bold; background: #FFCCBC; padding: 0 4px; border-radius: 3px; }
        .high-mark { color: var(--high-pitch); font-weight: bold; }
        .low-mark { color: var(--low-pitch); font-weight: bold; }

        /* SVG æ¼”ç¤ºåŒº */
        .svg-stage {
            background: #FFF;
            border: 2px dashed #4DD0E1;
            border-radius: 10px;
            padding: 10px;
            margin: 15px 0;
            text-align: center;
            position: relative;
        }
        .svg-caption { font-size: 0.9em; color: #78909C; margin-top: 5px; font-style: italic; }

        .ctrl-btn {
            background: #00BCD4; color: white; border: none; padding: 8px 20px; 
            border-radius: 20px; margin: 5px; cursor: pointer; font-size: 0.9em;
            box-shadow: 0 3px 0 #0097A7; transition: 0.1s;
        }
        .ctrl-btn:active { transform: translateY(2px); box-shadow: 0 1px 0 #0097A7; }

        /* æŒ‰é’® */
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 0;
            width: 100%;
            font-size: 1.1em;
            border-radius: 50px;
            cursor: pointer;
            margin: 15px 0;
            font-weight: bold;
            box-shadow: 0 4px 0 #0097A7;
            transition: 0.1s;
        }
        .btn:active { transform: translateY(3px); box-shadow: 0 1px 0 #0097A7; }
        .btn-next { background: #FFCA28; box-shadow: 0 4px 0 #F57F17; color: #3E2723; }

        /* é¢˜ç›®åŒº */
        .progress-container { height: 10px; background: #ECEFF1; border-radius: 5px; margin-bottom: 5px; overflow: hidden; }
        .progress-bar { height: 100%; background: #00BCD4; width: 0%; transition: width 0.3s; }
        
        .question-card { background: #FAFAFA; border-radius: 10px; padding: 15px; text-align: left; border: 2px solid #E0E0E0; margin-top: 10px; }
        .q-tag { background: #B2EBF2; color: #006064; padding: 3px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; margin-right: 5px; }
        .q-content { font-size: 1.2em; font-weight: bold; margin: 10px 0 20px 0; line-height: 1.4; }

        /* é€‰é¡¹ */
        .option-item {
            background: white; border: 2px solid #B2DFDB; padding: 12px; border-radius: 8px;
            margin-bottom: 10px; cursor: pointer; transition: 0.2s;
        }
        .option-item.selected { background: #B2EBF2; border-color: #00BCD4; font-weight: bold; color: #006064; }

        .fill-input { border: none; border-bottom: 3px solid #00BCD4; background: transparent; width: 120px; text-align: center; font-size: 1.2em; color: #00838F; border-radius: 0; }

        /* è¿çº¿é¢˜ */
        .match-row { display: flex; justify-content: space-between; gap: 10px; margin-bottom: 10px; }
        .match-col { width: 48%; display: flex; flex-direction: column; gap: 10px; }
        .match-btn {
            padding: 10px; background: #FFF; border: 2px solid #B0BEC5; border-radius: 8px;
            text-align: center; cursor: pointer; font-size: 0.9em;
        }
        .match-btn.selected { background: #FFF59D; border-color: #FBC02D; transform: scale(1.05); }
        .match-btn.matched { background: #C8E6C9; border-color: #43A047; opacity: 0.6; pointer-events: none; }

        /* é”™é¢˜è§£æ */
        .wrong-item { background: #FFEBEE; border-left: 4px solid #EF5350; padding: 10px; margin-bottom: 10px; text-align: left; border-radius: 4px; }
        .score-display { font-size: 4em; color: #FF9800; font-weight: bold; margin: 10px 0; }

        /* å³æ—¶åé¦ˆæ ·å¼ */
        .feedback-toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px);
            background: white; padding: 15px 25px; border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 12px;
            z-index: 10000; opacity: 0; transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .feedback-toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        .feedback-success { border-left: 5px solid #4CAF50; }
        .feedback-error { border-left: 5px solid #F44336; }
        .toast-icon {
            width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; font-size: 20px; font-weight: bold; color: white;
        }
        .feedback-success .toast-icon { background: #4CAF50; }
        .feedback-error .toast-icon { background: #F44336; }
        .toast-message { font-size: 15px; font-weight: 500; color: #333; }
        
        .confetti {
            position: fixed; pointer-events: none; z-index: 9999;
        }
        @keyframes confetti-fall {
            to { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        .correct-feedback {
            animation: pulse-correct 0.6s ease;
        }
        @keyframes pulse-correct {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); background: #C8E6C9; }
        }
        
        .wrong-feedback {
            animation: shake-wrong 0.5s ease;
        }
        @keyframes shake-wrong {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

    </style>
</head>
<body>

    <!-- 1. å¤ä¹ åŒº -->
    <div id="section-review" class="container section active">
        <h1>ğŸ¼ çŸ¥è¯†å¤ä¹ </h1>
        <p class="subtitle">ç¬¬å…­è¯¾ï¼šå£°éŸ³çš„é«˜ä¸ä½</p>

        <!-- çŸ¥è¯†ç‚¹ 1 & 2: éŸ³é«˜ä¸æŒ¯åŠ¨å¿«æ…¢ -->
        <div class="knowledge-box">
            <h3>1. éŸ³é«˜ä¸æŒ¯åŠ¨å¿«æ…¢</h3>
            <div class="k-point">ğŸµ <strong>éŸ³é«˜</strong>ï¼šæè¿°å£°éŸ³çš„é«˜ä½ã€‚</div>
            <div class="k-point">âš¡ <strong>è§„å¾‹</strong>ï¼š
                <br>æŒ¯åŠ¨è¶Š<span class="high-mark">å¿«</span> â†’ å£°éŸ³è¶Š<span class="high-mark">é«˜</span>
                <br>æŒ¯åŠ¨è¶Š<span class="low-mark">æ…¢</span> â†’ å£°éŸ³è¶Š<span class="low-mark">ä½</span>
            </div>
            <div class="svg-stage">
                <svg width="100%" height="100" viewBox="0 0 300 100">
                    <!-- ä½éŸ³æ³¢å½¢ -->
                    <text x="20" y="30" font-size="12" fill="#3F51B5">ä½éŸ³ (æ…¢)</text>
                    <path d="M20,60 Q45,20 70,60 T120,60" fill="none" stroke="#3F51B5" stroke-width="3"/>
                    
                    <!-- é«˜éŸ³æ³¢å½¢ -->
                    <text x="180" y="30" font-size="12" fill="#FF5252">é«˜éŸ³ (å¿«)</text>
                    <path d="M180,60 Q190,40 200,60 T220,60 T240,60 T260,60 T280,60" fill="none" stroke="#FF5252" stroke-width="3"/>
                    
                    <!-- åŠ¨ç”»æŒ‡ç¤º -->
                    <circle cx="70" cy="60" r="5" fill="#3F51B5"><animate attributeName="cy" values="60;40;80;60" dur="1s" repeatCount="indefinite"/></circle>
                    <circle cx="230" cy="60" r="5" fill="#FF5252"><animate attributeName="cy" values="60;40;80;60" dur="0.2s" repeatCount="indefinite"/></circle>
                </svg>
            </div>
        </div>

        <!-- çŸ¥è¯†ç‚¹ 3 & 4: é’¢å°ºå®éªŒ -->
        <div class="knowledge-box">
            <h3>2. é’¢å°ºå®éªŒ (é•¿åº¦ä¸é«˜ä½)</h3>
            <div class="k-point">ğŸ“ <strong>æ“ä½œ</strong>ï¼šæ”¹å˜é’¢å°ºä¼¸å‡ºæ¡Œé¢çš„<span class="highlight">é•¿åº¦</span>ï¼Œç”¨åŠ›ç›¸åŒã€‚</div>
            <div class="k-point">ğŸ“Š <strong>ç»“è®º</strong>ï¼š
                <br>ä¼¸å‡ºè¶Š<span class="low-mark">é•¿</span> â†’ æŒ¯åŠ¨<span class="low-mark">æ…¢</span> â†’ å£°éŸ³<span class="low-mark">ä½</span>
                <br>ä¼¸å‡ºè¶Š<span class="high-mark">çŸ­</span> â†’ æŒ¯åŠ¨<span class="high-mark">å¿«</span> â†’ å£°éŸ³<span class="high-mark">é«˜</span>
            </div>
            <div class="k-point">ğŸ”„ <strong>å‡†ç¡®æ€§</strong>ï¼šæ¯æ¬¡å®éªŒé‡å¤<span class="highlight">3æ¬¡</span>ã€‚</div>

            <div class="svg-stage">
                <button class="ctrl-btn" onclick="animRuler('long')">ä¼¸å‡ºé•¿ (ä½éŸ³)</button>
                <button class="ctrl-btn" onclick="animRuler('short')">ä¼¸å‡ºçŸ­ (é«˜éŸ³)</button>
                <svg width="100%" height="140" viewBox="0 0 300 140" id="svg-ruler">
                    <!-- æ¡Œå­ -->
                    <rect x="0" y="80" width="100" height="60" fill="#8D6E63"/>
                    <text x="20" y="110" fill="white" font-size="12">æ¡Œé¢</text>
                    <!-- æ‰‹ -->
                    <ellipse cx="90" cy="75" rx="15" ry="10" fill="#FFCCBC" stroke="#E64A19"/>
                    <!-- é’¢å°º -->
                    <path id="ruler-blade" d="M100,80 L250,80" stroke="#607D8B" stroke-width="8" stroke-linecap="round"/>
                    <!-- æ–‡å­—æŒ‡ç¤º -->
                    <text id="vib-text" x="150" y="50" text-anchor="middle" font-size="12" fill="#555">ç‚¹å‡»æŒ‰é’®å¼€å§‹å®éªŒ</text>
                </svg>
            </div>

            <!-- æŸ±å½¢å›¾æ¼”ç¤º -->
            <div class="svg-stage">
                <p style="font-size:0.9em; margin:0;">éŸ³é«˜å˜åŒ–æŸ±å½¢å›¾</p>
                <svg width="100%" height="120" viewBox="0 0 300 120">
                    <!-- åæ ‡è½´ -->
                    <line x1="40" y1="100" x2="280" y2="100" stroke="#333" stroke-width="2"/>
                    <line x1="40" y1="100" x2="40" y2="20" stroke="#333" stroke-width="2"/>
                    <text x="10" y="60" font-size="10" transform="rotate(-90, 10, 60)">éŸ³é«˜</text>
                    <text x="150" y="115" font-size="10">é’¢å°ºä¼¸å‡ºæ¡Œé¢çš„é•¿åº¦</text>

                    <!-- æŸ±å­ -->
                    <g>
                        <rect x="60" y="30" width="30" height="70" fill="#FF5252"><animate attributeName="height" from="0" to="70" dur="1s" fill="freeze"/><animate attributeName="y" from="100" to="30" dur="1s" fill="freeze"/></rect>
                        <text x="65" y="112" font-size="10">8cm</text>
                        <text x="65" y="25" font-size="10" fill="#FF5252">é«˜</text>
                    </g>
                    <g>
                        <rect x="120" y="50" width="30" height="50" fill="#FF9800"><animate attributeName="height" from="0" to="50" dur="1s" fill="freeze"/><animate attributeName="y" from="100" to="50" dur="1s" fill="freeze"/></rect>
                        <text x="125" y="112" font-size="10">12cm</text>
                    </g>
                    <g>
                        <rect x="180" y="70" width="30" height="30" fill="#2196F3"><animate attributeName="height" from="0" to="30" dur="1s" fill="freeze"/><animate attributeName="y" from="100" to="70" dur="1s" fill="freeze"/></rect>
                        <text x="185" y="112" font-size="10">16cm</text>
                    </g>
                    <g>
                        <rect x="240" y="85" width="30" height="15" fill="#3F51B5"><animate attributeName="height" from="0" to="15" dur="1s" fill="freeze"/><animate attributeName="y" from="100" to="85" dur="1s" fill="freeze"/></rect>
                        <text x="245" y="112" font-size="10">20cm</text>
                        <text x="245" y="80" font-size="10" fill="#3F51B5">ä½</text>
                    </g>
                </svg>
            </div>
        </div>

        <!-- çŸ¥è¯†ç‚¹ 5 & 6: é•¿çŸ­ç²—ç»† -->
        <div class="knowledge-box">
            <h3>3. ç‰©ä½“çš„é•¿çŸ­ä¸ç²—ç»†</h3>
            <div class="k-point">ğŸ”¨ <strong>é“é’‰(é•¿çŸ­)</strong>ï¼š
                <br>é•¿ â†’ æŒ¯åŠ¨æ…¢ â†’ <span class="low-mark">ä½éŸ³</span>
                <br>çŸ­ â†’ æŒ¯åŠ¨å¿« â†’ <span class="high-mark">é«˜éŸ³</span>
            </div>
            <div class="k-point">â­• <strong>é“ç®¡(ç²—ç»†)</strong>ï¼š
                <br>ç²— â†’ æŒ¯åŠ¨æ…¢ â†’ <span class="low-mark">ä½éŸ³</span>
                <br>ç»† â†’ æŒ¯åŠ¨å¿« â†’ <span class="high-mark">é«˜éŸ³</span>
            </div>
            
            <div class="svg-stage">
                <svg width="100%" height="100" viewBox="0 0 300 100">
                    <!-- é•¿çŸ­å¯¹æ¯” -->
                    <g transform="translate(20, 10)">
                        <rect x="0" y="0" width="10" height="80" fill="#757575"/>
                        <text x="15" y="45" font-size="12" fill="#3F51B5">é•¿(ä½)</text>
                        <path d="M5,40 L5,40" stroke="#3F51B5" stroke-width="2">
                            <animate attributeName="d" values="M5,0 L5,80; M0,0 L0,80; M10,0 L10,80; M5,0 L5,80" dur="0.5s" repeatCount="indefinite"/>
                        </path>
                    </g>
                    <g transform="translate(80, 40)">
                        <rect x="0" y="0" width="10" height="50" fill="#757575"/>
                        <text x="15" y="30" font-size="12" fill="#FF5252">çŸ­(é«˜)</text>
                        <path d="M5,25 L5,25" stroke="#FF5252" stroke-width="2">
                             <animate attributeName="d" values="M5,0 L5,50; M0,0 L0,50; M10,0 L10,50; M5,0 L5,50" dur="0.1s" repeatCount="indefinite"/>
                        </path>
                    </g>

                    <!-- ç²—ç»†å¯¹æ¯” -->
                    <g transform="translate(160, 20)">
                        <rect x="0" y="0" width="30" height="60" fill="#BDBDBD" stroke="#757575"/>
                        <text x="35" y="35" font-size="12" fill="#3F51B5">ç²—(ä½)</text>
                         <animate attributeName="opacity" values="1;0.7;1" dur="0.5s" repeatCount="indefinite"/>
                    </g>
                    <g transform="translate(240, 20)">
                        <rect x="0" y="0" width="10" height="60" fill="#BDBDBD" stroke="#757575"/>
                        <text x="15" y="35" font-size="12" fill="#FF5252">ç»†(é«˜)</text>
                        <animate attributeName="opacity" values="1;0.5;1" dur="0.1s" repeatCount="indefinite"/>
                    </g>
                </svg>
            </div>
        </div>

        <!-- çŸ¥è¯†ç‚¹ 7: è¯•ç®¡ç©ºæ°”æŸ±å®éªŒ -->
        <div class="knowledge-box">
            <h3>4. è¯•ç®¡ç©ºæ°”æŸ±å®éªŒ ğŸ§ª</h3>
            <div class="k-point">ğŸŒ¬ï¸ <strong>å®éªŒåŸç†</strong>ï¼šå¯¹è¯•ç®¡å£å¹æ°”ï¼Œè®©ç®¡å†…<span class="highlight">ç©ºæ°”æŸ±æŒ¯åŠ¨</span>å‘å£°ã€‚</div>
            <div class="k-point">ğŸ“ <strong>ç©ºæ°”æŸ±é•¿åº¦</strong>ï¼š
                <br>ç©ºæ°”æŸ±<span class="low-mark">é•¿</span>ï¼ˆæ°´å°‘ï¼‰â†’ æŒ¯åŠ¨<span class="low-mark">æ…¢</span> â†’ éŸ³è°ƒ<span class="low-mark">ä½</span>
                <br>ç©ºæ°”æŸ±<span class="high-mark">çŸ­</span>ï¼ˆæ°´å¤šï¼‰â†’ æŒ¯åŠ¨<span class="high-mark">å¿«</span> â†’ éŸ³è°ƒ<span class="high-mark">é«˜</span>
            </div>
            <div class="k-point">ğŸ¼ <strong>åº”ç”¨</strong>ï¼šç®¡ä¹å™¨ï¼ˆé•¿ç¬›ã€è§ã€å•ç°§ç®¡ï¼‰å°±æ˜¯åˆ©ç”¨è¿™ä¸ªåŸç†å‘å‡ºä¸åŒéŸ³é«˜ã€‚</div>
            
            <div class="svg-stage">
                <button class="ctrl-btn" onclick="animTubes('play')">â–¶ æ¼”å¥è¯•ç®¡ç´</button>
                <button class="ctrl-btn" onclick="animTubes('stop')">â¸ åœæ­¢</button>
                <svg width="100%" height="180" viewBox="0 0 360 180" id="svg-tubes">
                    <defs>
                        <!-- ç»ç’ƒæ¸å˜ -->
                        <linearGradient id="glassGrad" x1="0%" y1="0%" x2="100%">
                            <stop offset="0%" style="stop-color:#E3F2FD;stop-opacity:0.6"/>
                            <stop offset="50%" style="stop-color:#BBDEFB;stop-opacity:0.3"/>
                            <stop offset="100%" style="stop-color:#E3F2FD;stop-opacity:0.6"/>
                        </linearGradient>
                        <!-- æ°´æ¸å˜ -->
                        <linearGradient id="waterGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#4FC3F7;stop-opacity:0.8"/>
                            <stop offset="100%" style="stop-color:#0288D1;stop-opacity:0.9"/>
                        </linearGradient>
                        <!-- æ°”æµæ¸å˜ -->
                        <radialGradient id="airGrad">
                            <stop offset="0%" style="stop-color:#B3E5FC;stop-opacity:0.8"/>
                            <stop offset="100%" style="stop-color:#B3E5FC;stop-opacity:0"/>
                        </radialGradient>
                    </defs>

                    <!-- è¯•ç®¡1: æ°´æœ€å°‘ï¼Œç©ºæ°”æŸ±æœ€é•¿ï¼ŒéŸ³æœ€ä½ -->
                    <g id="tube1">
                        <rect x="20" y="40" width="30" height="120" rx="3" fill="url(#glassGrad)" stroke="#1976D2" stroke-width="2"/>
                        <rect x="22" y="140" width="26" height="18" fill="url(#waterGrad)"/>
                        <line x1="35" y1="45" x2="35" y2="138" stroke="#FF9800" stroke-width="1" stroke-dasharray="2,2"/>
                        <text x="35" y="90" text-anchor="middle" font-size="10" fill="#3F51B5" font-weight="bold">é•¿</text>
                        <text x="35" y="172" text-anchor="middle" font-size="11" fill="#3F51B5" font-weight="bold">Do (ä½)</text>
                        <!-- æ°”æµ -->
                        <ellipse id="air1" cx="35" cy="35" rx="0" ry="0" fill="url(#airGrad)" opacity="0"/>
                        <!-- éŸ³ç¬¦ -->
                        <text id="note1" x="35" y="20" text-anchor="middle" font-size="16" opacity="0">â™ª</text>
                    </g>

                    <!-- è¯•ç®¡2: æ°´è¾ƒå°‘ï¼Œç©ºæ°”æŸ±è¾ƒé•¿ -->
                    <g id="tube2">
                        <rect x="90" y="40" width="30" height="120" rx="3" fill="url(#glassGrad)" stroke="#1976D2" stroke-width="2"/>
                        <rect x="92" y="120" width="26" height="38" fill="url(#waterGrad)"/>
                        <line x1="105" y1="45" x2="105" y2="118" stroke="#FF9800" stroke-width="1" stroke-dasharray="2,2"/>
                        <text x="105" y="80" text-anchor="middle" font-size="10" fill="#7B1FA2">è¾ƒé•¿</text>
                        <text x="105" y="172" text-anchor="middle" font-size="11" fill="#7B1FA2" font-weight="bold">Re</text>
                        <ellipse id="air2" cx="105" cy="35" rx="0" ry="0" fill="url(#airGrad)" opacity="0"/>
                        <text id="note2" x="105" y="20" text-anchor="middle" font-size="16" opacity="0">â™ª</text>
                    </g>

                    <!-- è¯•ç®¡3: æ°´è¾ƒå¤šï¼Œç©ºæ°”æŸ±è¾ƒçŸ­ -->
                    <g id="tube3">
                        <rect x="160" y="40" width="30" height="120" rx="3" fill="url(#glassGrad)" stroke="#1976D2" stroke-width="2"/>
                        <rect x="162" y="100" width="26" height="58" fill="url(#waterGrad)"/>
                        <line x1="175" y1="45" x2="175" y2="98" stroke="#FF9800" stroke-width="1" stroke-dasharray="2,2"/>
                        <text x="175" y="70" text-anchor="middle" font-size="10" fill="#E91E63">è¾ƒçŸ­</text>
                        <text x="175" y="172" text-anchor="middle" font-size="11" fill="#E91E63" font-weight="bold">Mi</text>
                        <ellipse id="air3" cx="175" cy="35" rx="0" ry="0" fill="url(#airGrad)" opacity="0"/>
                        <text id="note3" x="175" y="20" text-anchor="middle" font-size="16" opacity="0">â™ª</text>
                    </g>

                    <!-- è¯•ç®¡4: æ°´æœ€å¤šï¼Œç©ºæ°”æŸ±æœ€çŸ­ï¼ŒéŸ³æœ€é«˜ -->
                    <g id="tube4">
                        <rect x="230" y="40" width="30" height="120" rx="3" fill="url(#glassGrad)" stroke="#1976D2" stroke-width="2"/>
                        <rect x="232" y="80" width="26" height="78" fill="url(#waterGrad)"/>
                        <line x1="245" y1="45" x2="245" y2="78" stroke="#FF9800" stroke-width="1" stroke-dasharray="2,2"/>
                        <text x="245" y="60" text-anchor="middle" font-size="10" fill="#FF5252" font-weight="bold">çŸ­</text>
                        <text x="245" y="172" text-anchor="middle" font-size="11" fill="#FF5252" font-weight="bold">Sol (é«˜)</text>
                        <ellipse id="air4" cx="245" cy="35" rx="0" ry="0" fill="url(#airGrad)" opacity="0"/>
                        <text id="note4" x="245" y="20" text-anchor="middle" font-size="16" opacity="0">â™ª</text>
                    </g>

                    <!-- æ ‡æ³¨ -->
                    <text x="290" y="50" font-size="11" fill="#555">ğŸ’¨ å¹æ°”</text>
                    <text x="290" y="70" font-size="10" fill="#666">ç©ºæ°”æŸ±â†•</text>
                    <text x="290" y="90" font-size="9" fill="#3F51B5">é•¿â†’ä½éŸ³</text>
                    <text x="290" y="105" font-size="9" fill="#FF5252">çŸ­â†’é«˜éŸ³</text>
                </svg>
                <div class="svg-caption">ğŸ’¡ ç©ºæ°”æŸ±è¶ŠçŸ­ï¼ŒæŒ¯åŠ¨è¶Šå¿«ï¼ŒéŸ³è°ƒè¶Šé«˜ï¼ˆå°±åƒå€’æ°´æ—¶å£°éŸ³å˜åŒ–ï¼‰</div>
            </div>
        </div>

        <!-- çŸ¥è¯†ç‚¹ 8: æ•²å‡»è¯•ç®¡å®éªŒ -->
        <div class="knowledge-box">
            <h3>5. æ•²å‡»è¯•ç®¡å®éªŒ ğŸ¥¢</h3>
            <div class="k-point">ğŸ”¨ <strong>æŒ¯åŠ¨å¯¹è±¡</strong>ï¼šç”¨æœ¨æ£æ•²å‡»è¯•ç®¡å£æ—¶ï¼ŒæŒ¯åŠ¨å‘å£°çš„æ˜¯<span class="highlight">è¯•ç®¡å’Œæ°´çš„æ•´ä½“</span>ã€‚</div>
            <div class="k-point">âš–ï¸ <strong>è´¨é‡è§„å¾‹</strong>ï¼š
                <br>æ°´<span class="low-mark">å¤š</span> â†’ è´¨é‡<span class="low-mark">å¤§</span> â†’ æŒ¯åŠ¨<span class="low-mark">æ…¢</span> â†’ éŸ³è°ƒ<span class="low-mark">ä½</span>
                <br>æ°´<span class="high-mark">å°‘</span> â†’ è´¨é‡<span class="high-mark">å°</span> â†’ æŒ¯åŠ¨<span class="high-mark">å¿«</span> â†’ éŸ³è°ƒ<span class="high-mark">é«˜</span>
            </div>
            
            <div class="svg-stage">
                <button class="ctrl-btn" onclick="animTap('play')">ğŸ¥¢ æ•²å‡»æ¼”å¥</button>
                <button class="ctrl-btn" onclick="animTap('stop')">â¸ åœæ­¢</button>
                <svg width="100%" height="200" viewBox="0 0 360 200" id="svg-tap">
                    <defs>
                        <!-- ç»ç’ƒæ¸å˜ -->
                        <linearGradient id="glassGrad2" x1="0%" y1="0%" x2="100%">
                            <stop offset="0%" style="stop-color:#E3F2FD;stop-opacity:0.6"/>
                            <stop offset="50%" style="stop-color:#BBDEFB;stop-opacity:0.3"/>
                            <stop offset="100%" style="stop-color:#E3F2FD;stop-opacity:0.6"/>
                        </linearGradient>
                        <!-- æ°´æ¸å˜ -->
                        <linearGradient id="waterGrad2" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#4FC3F7;stop-opacity:0.8"/>
                            <stop offset="100%" style="stop-color:#0288D1;stop-opacity:0.9"/>
                        </linearGradient>
                        <!-- æŒ¯åŠ¨æ³¢çº¹ -->
                        <radialGradient id="waveGrad">
                            <stop offset="0%" style="stop-color:#FFD54F;stop-opacity:0.8"/>
                            <stop offset="100%" style="stop-color:#FFD54F;stop-opacity:0"/>
                        </radialGradient>
                        <!-- æœ¨æ£æ¸å˜ -->
                        <linearGradient id="stickGrad" x1="0%" y1="0%" x2="100%">
                            <stop offset="0%" style="stop-color:#8D6E63"/>
                            <stop offset="50%" style="stop-color:#A1887F"/>
                            <stop offset="100%" style="stop-color:#8D6E63"/>
                        </linearGradient>
                    </defs>

                    <!-- è¯•ç®¡1: æ°´å°‘ï¼Œè´¨é‡å°ï¼Œé«˜éŸ³ -->
                    <g id="tap-tube1">
                        <rect x="20" y="50" width="35" height="130" rx="3" fill="url(#glassGrad2)" stroke="#1976D2" stroke-width="2"/>
                        <rect x="22" y="150" width="31" height="28" fill="url(#waterGrad2)"/>
                        <text x="37" y="120" text-anchor="middle" font-size="10" fill="#FF5252" font-weight="bold">æ°´å°‘</text>
                        <text x="37" y="195" text-anchor="middle" font-size="11" fill="#FF5252" font-weight="bold">é«˜éŸ³ â™ª</text>
                        <!-- æœ¨æ£ -->
                        <line id="stick1" x1="60" y1="100" x2="45" y2="100" stroke="url(#stickGrad)" stroke-width="4" stroke-linecap="round"/>
                        <!-- æŒ¯åŠ¨æ³¢çº¹ -->
                        <circle id="wave1" cx="37" cy="120" r="0" fill="url(#waveGrad)" opacity="0"/>
                        <!-- éŸ³ç¬¦ -->
                        <text id="tapnote1" x="37" y="35" text-anchor="middle" font-size="18" fill="#FF5252" opacity="0">â™ª</text>
                    </g>

                    <!-- è¯•ç®¡2: æ°´è¾ƒå°‘ -->
                    <g id="tap-tube2">
                        <rect x="95" y="50" width="35" height="130" rx="3" fill="url(#glassGrad2)" stroke="#1976D2" stroke-width="2"/>
                        <rect x="97" y="130" width="31" height="48" fill="url(#waterGrad2)"/>
                        <text x="112" y="105" text-anchor="middle" font-size="10" fill="#E91E63">è¾ƒå°‘</text>
                        <text x="112" y="195" text-anchor="middle" font-size="11" fill="#E91E63" font-weight="bold">è¾ƒé«˜ â™ª</text>
                        <line id="stick2" x1="135" y1="100" x2="120" y2="100" stroke="url(#stickGrad)" stroke-width="4" stroke-linecap="round"/>
                        <circle id="wave2" cx="112" cy="120" r="0" fill="url(#waveGrad)" opacity="0"/>
                        <text id="tapnote2" x="112" y="35" text-anchor="middle" font-size="18" fill="#E91E63" opacity="0">â™ª</text>
                    </g>

                    <!-- è¯•ç®¡3: æ°´è¾ƒå¤š -->
                    <g id="tap-tube3">
                        <rect x="170" y="50" width="35" height="130" rx="3" fill="url(#glassGrad2)" stroke="#1976D2" stroke-width="2"/>
                        <rect x="172" y="110" width="31" height="68" fill="url(#waterGrad2)"/>
                        <text x="187" y="85" text-anchor="middle" font-size="10" fill="#7B1FA2">è¾ƒå¤š</text>
                        <text x="187" y="195" text-anchor="middle" font-size="11" fill="#7B1FA2" font-weight="bold">è¾ƒä½ â™ª</text>
                        <line id="stick3" x1="210" y1="100" x2="195" y2="100" stroke="url(#stickGrad)" stroke-width="4" stroke-linecap="round"/>
                        <circle id="wave3" cx="187" cy="120" r="0" fill="url(#waveGrad)" opacity="0"/>
                        <text id="tapnote3" x="187" y="35" text-anchor="middle" font-size="18" fill="#7B1FA2" opacity="0">â™ª</text>
                    </g>

                    <!-- è¯•ç®¡4: æ°´å¤šï¼Œè´¨é‡å¤§ï¼Œä½éŸ³ -->
                    <g id="tap-tube4">
                        <rect x="245" y="50" width="35" height="130" rx="3" fill="url(#glassGrad2)" stroke="#1976D2" stroke-width="2"/>
                        <rect x="247" y="90" width="31" height="88" fill="url(#waterGrad2)"/>
                        <text x="262" y="70" text-anchor="middle" font-size="10" fill="#3F51B5" font-weight="bold">æ°´å¤š</text>
                        <text x="262" y="195" text-anchor="middle" font-size="11" fill="#3F51B5" font-weight="bold">ä½éŸ³ â™ª</text>
                        <line id="stick4" x1="285" y1="100" x2="270" y2="100" stroke="url(#stickGrad)" stroke-width="4" stroke-linecap="round"/>
                        <circle id="wave4" cx="262" cy="120" r="0" fill="url(#waveGrad)" opacity="0"/>
                        <text id="tapnote4" x="262" y="35" text-anchor="middle" font-size="18" fill="#3F51B5" opacity="0">â™ª</text>
                    </g>

                    <!-- æ ‡æ³¨ -->
                    <text x="310" y="60" font-size="10" fill="#555">ğŸ¥¢ æ•²å‡»</text>
                    <text x="310" y="80" font-size="9" fill="#666">è¯•ç®¡+æ°´</text>
                    <text x="310" y="100" font-size="9" fill="#FF5252">æ°´å°‘â†’é«˜</text>
                    <text x="310" y="115" font-size="9" fill="#3F51B5">æ°´å¤šâ†’ä½</text>
                </svg>
                <div class="svg-caption">ğŸ’¡ æ•²å‡»æ—¶æŒ¯åŠ¨çš„æ˜¯è¯•ç®¡å’Œæ°´çš„æ•´ä½“ï¼Œæ°´è¶Šå¤šè´¨é‡è¶Šå¤§ï¼ŒæŒ¯åŠ¨è¶Šæ…¢ï¼ŒéŸ³è°ƒè¶Šä½</div>
            </div>
        </div>

        <!-- å¯¹æ¯”æ€»ç»“è¡¨ -->
        <div class="knowledge-box" style="background: linear-gradient(135deg, #FFF9C4 0%, #F0F4C3 100%); border-left: 5px solid #F57F17;">
            <h3>ğŸ“Š ä¸¤ç§å®éªŒæ–¹å¼å¯¹æ¯”æ€»ç»“</h3>
            <div class="svg-stage" style="background: white; padding: 15px;">
                <svg width="100%" height="200" viewBox="0 0 400 200">
                    <defs>
                        <linearGradient id="headerGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#42A5F5"/>
                            <stop offset="100%" style="stop-color:#1E88E5"/>
                        </linearGradient>
                    </defs>
                    
                    <!-- è¡¨æ ¼æ ‡é¢˜ -->
                    <rect x="10" y="10" width="380" height="30" fill="url(#headerGrad)" rx="5"/>
                    <text x="200" y="32" text-anchor="middle" font-size="16" fill="white" font-weight="bold">å®éªŒæ–¹å¼å¯¹æ¯”è¡¨</text>
                    
                    <!-- è¡¨å¤´ -->
                    <rect x="10" y="45" width="80" height="30" fill="#E3F2FD" stroke="#1976D2" stroke-width="1"/>
                    <text x="50" y="65" text-anchor="middle" font-size="13" font-weight="bold">æ“ä½œæ–¹å¼</text>
                    
                    <rect x="90" y="45" width="80" height="30" fill="#E3F2FD" stroke="#1976D2" stroke-width="1"/>
                    <text x="130" y="65" text-anchor="middle" font-size="13" font-weight="bold">æŒ¯åŠ¨å¯¹è±¡</text>
                    
                    <rect x="170" y="45" width="110" height="30" fill="#FFEBEE" stroke="#E53935" stroke-width="1"/>
                    <text x="225" y="58" text-anchor="middle" font-size="12" font-weight="bold">æ°´é‡å¤š</text>
                    <text x="225" y="70" text-anchor="middle" font-size="10" fill="#666">(æ°´ä½é«˜)</text>
                    
                    <rect x="280" y="45" width="110" height="30" fill="#E8F5E9" stroke="#43A047" stroke-width="1"/>
                    <text x="335" y="58" text-anchor="middle" font-size="12" font-weight="bold">æ°´é‡å°‘</text>
                    <text x="335" y="70" text-anchor="middle" font-size="10" fill="#666">(æ°´ä½ä½)</text>
                    
                    <!-- ç¬¬1è¡Œï¼šå¹æ°” -->
                    <rect x="10" y="75" width="80" height="55" fill="#FFF" stroke="#1976D2" stroke-width="1"/>
                    <text x="50" y="95" text-anchor="middle" font-size="16">ğŸŒ¬ï¸</text>
                    <text x="50" y="112" text-anchor="middle" font-size="12" font-weight="bold">ç”¨å˜´å¹æ°”</text>
                    
                    <rect x="90" y="75" width="80" height="55" fill="#FFF" stroke="#1976D2" stroke-width="1"/>
                    <text x="130" y="100" text-anchor="middle" font-size="12" font-weight="bold">ç©ºæ°”æŸ±</text>
                    <text x="130" y="115" text-anchor="middle" font-size="10" fill="#666">(ç®¡å†…ç©ºæ°”)</text>
                    
                    <rect x="170" y="75" width="110" height="55" fill="#FFF" stroke="#E53935" stroke-width="1"/>
                    <text x="225" y="95" text-anchor="middle" font-size="20" fill="#FF5252">â™ª</text>
                    <text x="225" y="112" text-anchor="middle" font-size="14" fill="#FF5252" font-weight="bold">é«˜éŸ³</text>
                    <text x="225" y="124" text-anchor="middle" font-size="9" fill="#666">(ç©ºæ°”æŸ±çŸ­â†’å¿«)</text>
                    
                    <rect x="280" y="75" width="110" height="55" fill="#FFF" stroke="#43A047" stroke-width="1"/>
                    <text x="335" y="95" text-anchor="middle" font-size="20" fill="#3F51B5">â™ª</text>
                    <text x="335" y="112" text-anchor="middle" font-size="14" fill="#3F51B5" font-weight="bold">ä½éŸ³</text>
                    <text x="335" y="124" text-anchor="middle" font-size="9" fill="#666">(ç©ºæ°”æŸ±é•¿â†’æ…¢)</text>
                    
                    <!-- ç¬¬2è¡Œï¼šæ•²å‡» -->
                    <rect x="10" y="130" width="80" height="55" fill="#FFF" stroke="#1976D2" stroke-width="1"/>
                    <text x="50" y="150" text-anchor="middle" font-size="16">ğŸ¥¢</text>
                    <text x="50" y="167" text-anchor="middle" font-size="12" font-weight="bold">æœ¨æ£æ•²å‡»</text>
                    
                    <rect x="90" y="130" width="80" height="55" fill="#FFF" stroke="#1976D2" stroke-width="1"/>
                    <text x="130" y="155" text-anchor="middle" font-size="12" font-weight="bold">è¯•ç®¡ä¸æ°´</text>
                    <text x="130" y="170" text-anchor="middle" font-size="10" fill="#666">(æ•´ä½“æŒ¯åŠ¨)</text>
                    
                    <rect x="170" y="130" width="110" height="55" fill="#FFF" stroke="#E53935" stroke-width="1"/>
                    <text x="225" y="150" text-anchor="middle" font-size="20" fill="#3F51B5">â™ª</text>
                    <text x="225" y="167" text-anchor="middle" font-size="14" fill="#3F51B5" font-weight="bold">ä½éŸ³</text>
                    <text x="225" y="179" text-anchor="middle" font-size="9" fill="#666">(è´¨é‡å¤§â†’æ…¢)</text>
                    
                    <rect x="280" y="130" width="110" height="55" fill="#FFF" stroke="#43A047" stroke-width="1"/>
                    <text x="335" y="150" text-anchor="middle" font-size="20" fill="#FF5252">â™ª</text>
                    <text x="335" y="167" text-anchor="middle" font-size="14" fill="#FF5252" font-weight="bold">é«˜éŸ³</text>
                    <text x="335" y="179" text-anchor="middle" font-size="9" fill="#666">(è´¨é‡å°â†’å¿«)</text>
                </svg>
            </div>
            <div class="k-point" style="margin-top: 10px; padding: 10px; background: #FFFDE7; border-radius: 8px; border: 2px dashed #F57F17;">
                <strong>ğŸ¯ å…³é”®åŒºåˆ«</strong>ï¼š
                <br>â€¢ <span class="highlight">å¹æ°”</span>ï¼šæŒ¯åŠ¨çš„æ˜¯<strong>ç©ºæ°”æŸ±</strong>ï¼Œæ°´å¤šâ†’ç©ºæ°”æŸ±çŸ­â†’é«˜éŸ³
                <br>â€¢ <span class="highlight">æ•²å‡»</span>ï¼šæŒ¯åŠ¨çš„æ˜¯<strong>è¯•ç®¡+æ°´æ•´ä½“</strong>ï¼Œæ°´å¤šâ†’è´¨é‡å¤§â†’ä½éŸ³
                <br>â€¢ åŒæ ·çš„æ°´é‡ï¼Œ<strong>æ“ä½œæ–¹å¼ä¸åŒï¼ŒéŸ³é«˜ç›¸å</strong>ï¼
            </div>
        </div>

        <button class="btn" onclick="startQuiz()">è¿›å…¥35é¢˜é—¯å…³å¡”ï¼ğŸš€</button>
    </div>

    <!-- 2. é—¯å…³åŒº -->
    <div id="section-quiz" class="container section">
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div style="text-align:right; font-size:0.9em; color:#0097A7;">é¢˜ç›®ï¼š<span id="q-index">1</span> / 35</div>

        <div id="question-area"></div>
        
        <button class="btn btn-next" id="nextBtn" onclick="nextQuestion()">ä¸‹ä¸€é¢˜ â–¶</button>
    </div>

    <!-- 3. ç»“ç®—åŒº -->
    <div id="section-result" class="container section">
        <h1>ğŸ† é—¯å…³æˆç»©</h1>
        <div class="score-display"><span id="final-score">0</span>åˆ†</div>
        <p id="reward-text"></p>
        
        <div id="wrong-list" style="display:none;">
            <h3 style="color:#D32F2F;">âŒ é”™é¢˜è§£æ</h3>
            <!-- é”™é¢˜å†…å®¹ -->
        </div>
        <button class="btn" onclick="location.reload()">ğŸ”„ é‡æ–°æŒ‘æˆ˜</button>
    </div>

    <script>
        // --- SVG åŠ¨ç”»é€»è¾‘ ---
        
        function animRuler(type) {
            const blade = document.getElementById('ruler-blade');
            const text = document.getElementById('vib-text');
            
            // æ¸…é™¤æ—§åŠ¨ç”»
            while(blade.firstChild) blade.removeChild(blade.firstChild);
            
            const anim = document.createElementNS("http://www.w3.org/2000/svg", "animate");
            anim.setAttribute("attributeName", "d");
            anim.setAttribute("repeatCount", "indefinite");
            
            if (type === 'long') {
                // é•¿ï¼šä¼¸å‡ºåˆ°250ï¼ŒæŒ¯åŠ¨æ…¢(0.5s)ï¼Œå¹…åº¦å¤§
                anim.setAttribute("values", "M100,80 Q175,40 250,40; M100,80 Q175,120 250,120; M100,80 L250,80");
                anim.setAttribute("dur", "0.5s");
                text.innerHTML = "ä¼¸å‡ºé•¿ â†’ æŒ¯åŠ¨æ…¢ â†’ å£°éŸ³ä½";
                text.setAttribute("fill", "#3F51B5");
            } else {
                // çŸ­ï¼šä¼¸å‡ºåˆ°160ï¼ŒæŒ¯åŠ¨å¿«(0.1s)ï¼Œå¹…åº¦å°
                anim.setAttribute("values", "M100,80 Q130,60 160,60; M100,80 Q130,100 160,100; M100,80 L160,80");
                anim.setAttribute("dur", "0.1s");
                text.innerHTML = "ä¼¸å‡ºçŸ­ â†’ æŒ¯åŠ¨å¿« â†’ å£°éŸ³é«˜";
                text.setAttribute("fill", "#FF5252");
            }
            
            blade.appendChild(anim);
            anim.beginElement();
        }

        // è¯•ç®¡åŠ¨ç”»æ§åˆ¶
        let tubeAnimInterval = null;
        function animTubes(action) {
            if (action === 'stop') {
                if (tubeAnimInterval) clearInterval(tubeAnimInterval);
                // é‡ç½®æ‰€æœ‰å…ƒç´ 
                for(let i=1; i<=4; i++) {
                    document.getElementById('air'+i).setAttribute('opacity', '0');
                    document.getElementById('note'+i).setAttribute('opacity', '0');
                }
                return;
            }
            
            // æ’­æ”¾åºåˆ—ï¼šä¾æ¬¡å¹å“4ä¸ªè¯•ç®¡
            const sequence = [
                {tube: 1, dur: 1000, freq: 262}, // Do - ä½éŸ³
                {tube: 2, dur: 800, freq: 294},  // Re
                {tube: 3, dur: 600, freq: 330},  // Mi
                {tube: 4, dur: 400, freq: 392}   // Sol - é«˜éŸ³
            ];
            
            let idx = 0;
            function playNext() {
                if (idx >= sequence.length) {
                    idx = 0; // å¾ªç¯æ’­æ”¾
                }
                
                const s = sequence[idx];
                const air = document.getElementById('air'+s.tube);
                const note = document.getElementById('note'+s.tube);
                
                // æ°”æµæ‰©æ•£åŠ¨ç”»
                air.setAttribute('rx', '0');
                air.setAttribute('ry', '0');
                air.setAttribute('opacity', '1');
                const airAnim1 = document.createElementNS("http://www.w3.org/2000/svg", "animate");
                airAnim1.setAttribute("attributeName", "rx");
                airAnim1.setAttribute("from", "0");
                airAnim1.setAttribute("to", "15");
                airAnim1.setAttribute("dur", "0.3s");
                airAnim1.setAttribute("fill", "freeze");
                air.appendChild(airAnim1);
                
                const airAnim2 = document.createElementNS("http://www.w3.org/2000/svg", "animate");
                airAnim2.setAttribute("attributeName", "ry");
                airAnim2.setAttribute("from", "0");
                airAnim2.setAttribute("to", "10");
                airAnim2.setAttribute("dur", "0.3s");
                airAnim2.setAttribute("fill", "freeze");
                air.appendChild(airAnim2);
                
                const airAnim3 = document.createElementNS("http://www.w3.org/2000/svg", "animate");
                airAnim3.setAttribute("attributeName", "opacity");
                airAnim3.setAttribute("from", "1");
                airAnim3.setAttribute("to", "0");
                airAnim3.setAttribute("dur", "0.5s");
                airAnim3.setAttribute("fill", "freeze");
                air.appendChild(airAnim3);
                
                airAnim1.beginElement();
                airAnim2.beginElement();
                airAnim3.beginElement();
                
                // éŸ³ç¬¦ä¸Šå‡åŠ¨ç”»
                note.setAttribute('y', '20');
                note.setAttribute('opacity', '1');
                const noteAnim1 = document.createElementNS("http://www.w3.org/2000/svg", "animate");
                noteAnim1.setAttribute("attributeName", "y");
                noteAnim1.setAttribute("from", "20");
                noteAnim1.setAttribute("to", "5");
                noteAnim1.setAttribute("dur", "0.6s");
                noteAnim1.setAttribute("fill", "freeze");
                note.appendChild(noteAnim1);
                
                const noteAnim2 = document.createElementNS("http://www.w3.org/2000/svg", "animate");
                noteAnim2.setAttribute("attributeName", "opacity");
                noteAnim2.setAttribute("from", "1");
                noteAnim2.setAttribute("to", "0");
                noteAnim2.setAttribute("dur", "0.6s");
                noteAnim2.setAttribute("fill", "freeze");
                note.appendChild(noteAnim2);
                
                noteAnim1.beginElement();
                noteAnim2.beginElement();
                
                // æ’­æ”¾éŸ³æ•ˆ
                if (audioCtx.state === 'suspended') audioCtx.resume();
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.frequency.value = s.freq;
                osc.type = 'sine';
                const now = audioCtx.currentTime;
                gain.gain.setValueAtTime(0.15, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
                osc.start(now);
                osc.stop(now + 0.5);
                
                idx++;
            }
            
            // åœæ­¢ä¹‹å‰çš„åŠ¨ç”»
            if (tubeAnimInterval) clearInterval(tubeAnimInterval);
            
            // ç«‹å³æ’­æ”¾ç¬¬ä¸€ä¸ª
            playNext();
            
            // è®¾ç½®å¾ªç¯
            tubeAnimInterval = setInterval(playNext, 1000);
        }

        // æ•²å‡»è¯•ç®¡åŠ¨ç”»æ§åˆ¶
        let tapAnimInterval = null;
        function animTap(action) {
            if (action === 'stop') {
                if (tapAnimInterval) clearInterval(tapAnimInterval);
                // é‡ç½®æ‰€æœ‰å…ƒç´ 
                for(let i=1; i<=4; i++) {
                    const stick = document.getElementById('stick'+i);
                    const wave = document.getElementById('wave'+i);
                    const note = document.getElementById('tapnote'+i);
                    stick.setAttribute('x1', (i-1)*75 + 60);
                    wave.setAttribute('opacity', '0');
                    wave.setAttribute('r', '0');
                    note.setAttribute('opacity', '0');
                }
                return;
            }
            
            // æ’­æ”¾åºåˆ—ï¼šä¾æ¬¡æ•²å‡»4ä¸ªè¯•ç®¡ï¼ˆæ°´å°‘â†’æ°´å¤šï¼Œé«˜éŸ³â†’ä½éŸ³ï¼‰
            const sequence = [
                {tube: 1, freq: 880, color: '#FF5252'},  // æ°´å°‘ - é«˜éŸ³
                {tube: 2, freq: 660, color: '#E91E63'},  // è¾ƒå°‘ - è¾ƒé«˜
                {tube: 3, freq: 494, color: '#7B1FA2'},  // è¾ƒå¤š - è¾ƒä½
                {tube: 4, freq: 330, color: '#3F51B5'}   // æ°´å¤š - ä½éŸ³
            ];
            
            let idx = 0;
            function tapNext() {
                if (idx >= sequence.length) {
                    idx = 0; // å¾ªç¯æ’­æ”¾
                }
                
                const s = sequence[idx];
                const stick = document.getElementById('stick'+s.tube);
                const wave = document.getElementById('wave'+s.tube);
                const note = document.getElementById('tapnote'+s.tube);
                
                // æœ¨æ£æ•²å‡»åŠ¨ç”»ï¼ˆå‘å·¦ç§»åŠ¨ï¼‰
                const baseX = (s.tube-1)*75 + 60;
                const stickAnim = document.createElementNS("http://www.w3.org/2000/svg", "animate");
                stickAnim.setAttribute("attributeName", "x1");
                stickAnim.setAttribute("values", baseX + ";" + (baseX-10) + ";" + baseX);
                stickAnim.setAttribute("dur", "0.3s");
                stickAnim.setAttribute("fill", "freeze");
                stick.appendChild(stickAnim);
                stickAnim.beginElement();
                
                // æŒ¯åŠ¨æ³¢çº¹æ‰©æ•£
                wave.setAttribute('r', '0');
                wave.setAttribute('opacity', '1');
                const waveAnim1 = document.createElementNS("http://www.w3.org/2000/svg", "animate");
                waveAnim1.setAttribute("attributeName", "r");
                waveAnim1.setAttribute("from", "0");
                waveAnim1.setAttribute("to", "25");
                waveAnim1.setAttribute("dur", "0.5s");
                waveAnim1.setAttribute("fill", "freeze");
                wave.appendChild(waveAnim1);
                
                const waveAnim2 = document.createElementNS("http://www.w3.org/2000/svg", "animate");
                waveAnim2.setAttribute("attributeName", "opacity");
                waveAnim2.setAttribute("from", "1");
                waveAnim2.setAttribute("to", "0");
                waveAnim2.setAttribute("dur", "0.5s");
                waveAnim2.setAttribute("fill", "freeze");
                wave.appendChild(waveAnim2);
                
                waveAnim1.beginElement();
                waveAnim2.beginElement();
                
                // éŸ³ç¬¦ä¸Šå‡åŠ¨ç”»
                note.setAttribute('y', '35');
                note.setAttribute('opacity', '1');
                const noteAnim1 = document.createElementNS("http://www.w3.org/2000/svg", "animate");
                noteAnim1.setAttribute("attributeName", "y");
                noteAnim1.setAttribute("from", "35");
                noteAnim1.setAttribute("to", "15");
                noteAnim1.setAttribute("dur", "0.7s");
                noteAnim1.setAttribute("fill", "freeze");
                note.appendChild(noteAnim1);
                
                const noteAnim2 = document.createElementNS("http://www.w3.org/2000/svg", "animate");
                noteAnim2.setAttribute("attributeName", "opacity");
                noteAnim2.setAttribute("from", "1");
                noteAnim2.setAttribute("to", "0");
                noteAnim2.setAttribute("dur", "0.7s");
                noteAnim2.setAttribute("fill", "freeze");
                note.appendChild(noteAnim2);
                
                noteAnim1.beginElement();
                noteAnim2.beginElement();
                
                // æ’­æ”¾æ•²å‡»éŸ³æ•ˆï¼ˆæ›´çŸ­ä¿ƒï¼‰
                if (audioCtx.state === 'suspended') audioCtx.resume();
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.frequency.value = s.freq;
                osc.type = 'triangle'; // ä¸‰è§’æ³¢æ¨¡æ‹Ÿæ•²å‡»å£°
                const now = audioCtx.currentTime;
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
                
                idx++;
            }
            
            // åœæ­¢ä¹‹å‰çš„åŠ¨ç”»
            if (tapAnimInterval) clearInterval(tapAnimInterval);
            
            // ç«‹å³æ’­æ”¾ç¬¬ä¸€ä¸ª
            tapNext();
            
            // è®¾ç½®å¾ªç¯
            tapAnimInterval = setInterval(tapNext, 900);
        }

        // --- å³æ—¶åé¦ˆç³»ç»Ÿ ---
        const InstantFeedback = {
            audioCtx: null,
            encouragements: ['å¤ªæ£’äº†ï¼ç»§ç»­åŠ æ²¹ï¼ğŸŒŸ', 'ä½ çœŸèªæ˜ï¼ğŸ‘', 'å®Œå…¨æ­£ç¡®ï¼çœŸå‰å®³ï¼ğŸ¯', 'ç­”å¯¹äº†ï¼ä½ æ˜¯æœ€æ£’çš„ï¼â­', 'å¤ªä¼˜ç§€äº†ï¼ç»§ç»­ä¿æŒï¼ğŸ†', 'çœŸæ˜¯ä¸ªå°å¤©æ‰ï¼ğŸ’¡', 'å›ç­”å¾—éå¸¸å¥½ï¼ğŸ‘', 'ä½ æŒæ¡å¾—å¾ˆå¥½ï¼ğŸ“š'],
            hints: ['å†æƒ³æƒ³å“¦ï¼ä½ å¯ä»¥çš„ï¼ğŸ’ª', 'åˆ«ç°å¿ƒï¼Œå†è¯•ä¸€æ¬¡ï¼ğŸŒˆ', 'åŠ æ²¹ï¼ä»”ç»†çœ‹çœ‹é¢˜ç›®ï¼ğŸ‘€', 'æ²¡å…³ç³»ï¼Œç»§ç»­åŠªåŠ›ï¼ğŸ’«', 'å†çœ‹çœ‹çŸ¥è¯†ç‚¹å§ï¼ğŸ“–', 'ä¸è¦æ”¾å¼ƒï¼Œä½ èƒ½è¡Œï¼ğŸš€', 'æ€è€ƒä¸€ä¸‹ï¼Œä½ ä¸€å®šèƒ½æƒ³åˆ°ï¼ğŸ¤”', 'åŠ æ²¹ï¼ç›¸ä¿¡è‡ªå·±ï¼âœ¨'],
            
            init() { if (!this.audioCtx) this.audioCtx = new (window.AudioContext || window.webkitAudioContext)(); },
            
            playCorrectSound() {
                this.init(); if (this.audioCtx.state === 'suspended') this.audioCtx.resume();
                const notes = [523.25, 659.25, 783.99];
                notes.forEach((freq, i) => {
                    const osc = this.audioCtx.createOscillator(); const gain = this.audioCtx.createGain();
                    osc.connect(gain); gain.connect(this.audioCtx.destination);
                    const now = this.audioCtx.currentTime; const start = now + i * 0.1;
                    osc.frequency.value = freq; osc.type = 'sine';
                    gain.gain.setValueAtTime(0.15, start); gain.gain.exponentialRampToValueAtTime(0.01, start + 0.3);
                    osc.start(start); osc.stop(start + 0.3);
                });
            },
            
            playWrongSound() {
                this.init(); if (this.audioCtx.state === 'suspended') this.audioCtx.resume();
                const osc = this.audioCtx.createOscillator(); const gain = this.audioCtx.createGain();
                osc.connect(gain); gain.connect(this.audioCtx.destination);
                const now = this.audioCtx.currentTime;
                osc.frequency.setValueAtTime(300, now); osc.frequency.linearRampToValueAtTime(250, now + 0.2);
                osc.type = 'triangle';
                gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(now); osc.stop(now + 0.2);
            },
            
            showConfetti() {
                const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE'];
                for (let i = 0; i < 30; i++) {
                    setTimeout(() => {
                        const c = document.createElement('div'); c.className = 'confetti';
                        c.style.cssText = `width: ${Math.random() * 10 + 5}px; height: ${Math.random() * 10 + 5}px; background: ${colors[Math.floor(Math.random() * colors.length)]}; left: ${Math.random() * 100}%; top: -20px; border-radius: ${Math.random() > 0.5 ? '50%' : '0'}; animation: confetti-fall ${Math.random() * 2 + 2}s linear forwards; transform: rotate(${Math.random() * 360}deg);`;
                        document.body.appendChild(c);
                        setTimeout(() => c.remove(), 4000);
                    }, i * 30);
                }
            },
            
            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `feedback-toast feedback-${type}`;
                toast.innerHTML = `<div class="toast-icon">${type === 'success' ? 'âœ“' : 'âœ—'}</div><div class="toast-message">${message}</div>`;
                document.body.appendChild(toast);
                setTimeout(() => toast.classList.add('show'), 10);
                setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.remove(), 300); }, 2500);
            },
            
            onCorrect(element) {
                this.playCorrectSound(); this.showConfetti();
                const msg = this.encouragements[Math.floor(Math.random() * this.encouragements.length)];
                this.showToast(msg, 'success');
                if (element) { element.classList.add('correct-feedback'); setTimeout(() => element.classList.remove('correct-feedback'), 600); }
            },
            
            onWrong(element, hint = '') {
                this.playWrongSound();
                const msg = this.hints[Math.floor(Math.random() * this.hints.length)] + (hint ? `<br><small style="font-size:0.85em;">ğŸ’¡ ${hint}</small>` : '');
                this.showToast(msg, 'error');
                if (element) { element.classList.add('wrong-feedback'); setTimeout(() => element.classList.remove('wrong-feedback'), 500); }
            }
        };
        InstantFeedback.init();

        // --- 35é“é¢˜åº“ ---
        const quizData = [
            // 1. éŸ³é«˜ä¸æŒ¯åŠ¨å¿«æ…¢ (7é¢˜)
            { type: 'mcq', q: 'å£°éŸ³çš„é«˜ä½å¯ä»¥ç”¨____æ¥æè¿°ã€‚', opts: ['éŸ³é‡', 'éŸ³é«˜', 'éŸ³è‰²'], a: 1, exp: 'é«˜ä½ç”¨éŸ³é«˜æè¿°ã€‚' },
            { type: 'mcq', q: 'ç‰©ä½“æŒ¯åŠ¨å¾—è¶Šå¿«ï¼Œå‘å‡ºçš„å£°éŸ³å°±____ã€‚', opts: ['è¶Šä½', 'è¶Šé«˜', 'è¶Šå¼º'], a: 1, exp: 'æŒ¯åŠ¨å¿«=å£°éŸ³é«˜ã€‚' },
            { type: 'mcq', q: 'ç‰©ä½“æŒ¯åŠ¨å¾—è¶Šæ…¢ï¼Œå‘å‡ºçš„å£°éŸ³å°±____ã€‚', opts: ['è¶Šä½', 'è¶Šé«˜', 'è¶Šå¼±'], a: 0, exp: 'æŒ¯åŠ¨æ…¢=å£°éŸ³ä½ã€‚' },
            { type: 'fill', q: 'å£°éŸ³çš„é«˜ä½å’Œç‰©ä½“æŒ¯åŠ¨çš„____æœ‰å…³ã€‚', a: ['å¿«æ…¢'], exp: 'å¿«æ…¢å†³å®šé«˜ä½ã€‚' },
            { type: 'matching', q: 'è¯·è¿çº¿è§„å¾‹ï¼š', pairs: [{l:'æŒ¯åŠ¨å¿«', r:'å£°éŸ³é«˜'}, {l:'æŒ¯åŠ¨æ…¢', r:'å£°éŸ³ä½'}, {l:'æŒ¯å¹…å¤§', r:'å£°éŸ³å¼º'}], exp: 'åŒºåˆ†éŸ³é«˜å’ŒéŸ³é‡ã€‚' },
            { type: 'mcq', q: 'èšŠå­çš„å«å£°è™½ç„¶å¼±ï¼Œä½†æ˜¯å¾ˆ____ï¼Œè¯´æ˜å®ƒç¿…è†€æŒ¯åŠ¨å¾ˆå¿«ã€‚', opts: ['é«˜', 'ä½'], a: 0, exp: 'èšŠå­å£°éŸ³é«˜ï¼ˆå°–ï¼‰ã€‚' },
            { type: 'mcq', q: 'ç‰›çš„å«å£°â€œå“â€å¾ˆç²—åšï¼Œè¯´æ˜å®ƒå£°å¸¦æŒ¯åŠ¨æ¯”è¾ƒ____ã€‚', opts: ['å¿«', 'æ…¢'], a: 1, exp: 'å£°éŸ³ä½æ²‰=æŒ¯åŠ¨æ…¢ã€‚' },

            // 2. é’¢å°ºå®éªŒ (10é¢˜)
            { type: 'mcq', q: 'ç ”ç©¶é’¢å°ºéŸ³é«˜å˜åŒ–æ—¶ï¼Œæˆ‘ä»¬è¦æ”¹å˜çš„æ˜¯ï¼Ÿ', opts: ['æ‹¨åŠ¨çš„åŠ›é‡', 'é’¢å°ºä¼¸å‡ºæ¡Œé¢çš„é•¿åº¦', 'é’¢å°ºçš„å®½åº¦'], a: 1, exp: 'æ”¹å˜é•¿åº¦æ¥æ”¹å˜æŒ¯åŠ¨å¿«æ…¢ã€‚' },
            { type: 'mcq', q: 'å®éªŒä¸­ï¼Œæ‹¨åŠ¨é’¢å°ºçš„åŠ›åº¦åº”è¯¥ï¼Ÿ', opts: ['ä¿æŒç›¸åŒ', 'å¿½å¤§å¿½å°', 'è¶Šæ¥è¶Šå¤§'], a: 0, exp: 'æ§åˆ¶å˜é‡æ³•ï¼ŒåŠ›åº¦è¦ä¸€è‡´ã€‚' },
            { type: 'mcq', q: 'é’¢å°ºä¼¸å‡ºæ¡Œé¢è¶Šé•¿ï¼ŒæŒ¯åŠ¨è¶Š____ï¼Œå£°éŸ³è¶Š____ã€‚', opts: ['å¿«ï¼Œé«˜', 'æ…¢ï¼Œä½', 'æ…¢ï¼Œé«˜'], a: 1, exp: 'é•¿=æ…¢=ä½ã€‚' },
            { type: 'mcq', q: 'é’¢å°ºä¼¸å‡ºæ¡Œé¢è¶ŠçŸ­ï¼ŒæŒ¯åŠ¨è¶Š____ï¼Œå£°éŸ³è¶Š____ã€‚', opts: ['å¿«ï¼Œé«˜', 'æ…¢ï¼Œä½', 'å¿«ï¼Œä½'], a: 0, exp: 'çŸ­=å¿«=é«˜ã€‚' },
            { type: 'fill', q: 'æˆ‘ä»¬å¯ä»¥ç”¨____å›¾è¡¨ç¤ºå£°éŸ³é«˜ä½ä¸é’¢å°ºé•¿åº¦çš„å…³ç³»ã€‚', a: ['æŸ±å½¢', 'æŸ±çŠ¶'], exp: 'æŸ±å½¢å›¾ç›´è§‚å±•ç¤ºæ•°æ®ã€‚' },
            { type: 'mcq', q: 'ä¸ºäº†è®©å®éªŒç»“æœæ›´å‡†ç¡®ï¼Œæ¯æ¬¡å®éªŒè¦é‡å¤____æ¬¡ã€‚', opts: ['1', '3', '100'], a: 1, exp: 'é‡å¤3æ¬¡é¿å…å¶ç„¶æ€§ã€‚' },
            { type: 'matching', q: 'è¿çº¿é’¢å°ºå®éªŒç°è±¡ï¼š', pairs: [{l:'ä¼¸å‡º8cm', r:'å£°éŸ³æœ€é«˜'}, {l:'ä¼¸å‡º12cm', r:'å£°éŸ³è¾ƒé«˜'}, {l:'ä¼¸å‡º20cm', r:'å£°éŸ³æœ€ä½'}], exp: 'è¶ŠçŸ­è¶Šé«˜ã€‚' },
            { type: 'mcq', q: 'åœ¨æŸ±å½¢å›¾ä¸­ï¼Œéšç€é’¢å°ºé•¿åº¦å˜é•¿ï¼Œä»£è¡¨éŸ³é«˜çš„æŸ±å­é«˜åº¦åº”è¯¥ï¼Ÿ', opts: ['å˜é«˜', 'å˜ä½', 'ä¸å˜'], a: 1, exp: 'é•¿åº¦å¢åŠ ï¼ŒéŸ³é«˜é™ä½ã€‚' },
            { type: 'mcq', q: 'å¦‚æœæƒ³è®©é’¢å°ºå‘å‡ºæœ€é«˜çš„å£°éŸ³ï¼Œåº”è¯¥æŠŠä¼¸å‡ºéƒ¨åˆ†è°ƒåˆ°ï¼Ÿ', opts: ['5cm', '15cm', '25cm'], a: 0, exp: 'æœ€çŸ­çš„5cmå£°éŸ³æœ€é«˜ã€‚' },
            { type: 'mcq', q: 'ç”¨æ‰‹å‹ä½é’¢å°ºæ˜¯ä¸ºäº†ï¼Ÿ', opts: ['æ”¹å˜éŸ³è‰²', 'é˜²æ­¢å°ºå­æ‰è½æˆ–äº§ç”Ÿæ‚éŸ³', 'å¢åŠ éš¾åº¦'], a: 1, exp: 'å›ºå®šå°ºå­ã€‚' },

            // 3. ç‰©ä½“çš„é•¿çŸ­ä¸å£°éŸ³ (6é¢˜)
            { type: 'mcq', q: 'æ•²å‡»ç²—ç»†ç›¸åŒã€é•¿çŸ­ä¸åŒçš„é“é’‰ï¼Œé•¿é“é’‰å‘å‡ºçš„å£°éŸ³ï¼Ÿ', opts: ['é«˜', 'ä½', 'å¼º'], a: 1, exp: 'é•¿=æ…¢=ä½ã€‚' },
            { type: 'mcq', q: 'æ•²å‡»ç²—ç»†ç›¸åŒã€é•¿çŸ­ä¸åŒçš„é“é’‰ï¼ŒçŸ­é“é’‰å‘å‡ºçš„å£°éŸ³ï¼Ÿ', opts: ['é«˜', 'ä½', 'å¼±'], a: 0, exp: 'çŸ­=å¿«=é«˜ã€‚' },
            { type: 'matching', q: 'è¿çº¿ç‰©ä½“é•¿çŸ­ä¸éŸ³é«˜ï¼š', pairs: [{l:'é•¿ç‰©ä½“', r:'å£°éŸ³ä½'}, {l:'çŸ­ç‰©ä½“', r:'å£°éŸ³é«˜'}, {l:'ä¸­ç­‰ç‰©ä½“', r:'å£°éŸ³ä¸­ç­‰'}], exp: 'æ™®éè§„å¾‹ã€‚' },
            { type: 'mcq', q: 'ç¼–é’Ÿé‡Œä¸ªå¤´è¶Šå¤§çš„é’Ÿï¼Œæ•²å‡»æ—¶å‘å‡ºçš„å£°éŸ³è¶Šï¼Ÿ', opts: ['é«˜', 'ä½'], a: 1, exp: 'å¤§/é•¿ç‰©ä½“å£°éŸ³ä½ã€‚' },
            { type: 'mcq', q: 'å£ç´é‡Œé•¿çš„ç°§ç‰‡å‘å‡ºçš„å£°éŸ³æ¯”çŸ­ç°§ç‰‡ï¼Ÿ', opts: ['é«˜', 'ä½'], a: 1, exp: 'é•¿=ä½ã€‚' },
            { type: 'fill', q: 'å£°éŸ³çš„é«˜ä½å’Œå‘å£°ç‰©ä½“çš„____æœ‰å…³ã€‚', a: ['é•¿çŸ­', 'é•¿åº¦'], exp: 'é•¿åº¦å½±å“é¢‘ç‡ã€‚' },

            // 4. ç‰©ä½“çš„ç²—ç»†ä¸å£°éŸ³ (6é¢˜)
            { type: 'mcq', q: 'æ•²å‡»é•¿åº¦ç›¸åŒã€ç²—ç»†ä¸åŒçš„é“ç®¡ï¼Œç²—é“ç®¡å‘å‡ºçš„å£°éŸ³ï¼Ÿ', opts: ['é«˜', 'ä½'], a: 1, exp: 'ç²—=æ…¢=ä½ã€‚' },
            { type: 'mcq', q: 'æ•²å‡»é•¿åº¦ç›¸åŒã€ç²—ç»†ä¸åŒçš„é“ç®¡ï¼Œç»†é“ç®¡å‘å‡ºçš„å£°éŸ³ï¼Ÿ', opts: ['é«˜', 'ä½'], a: 0, exp: 'ç»†=å¿«=é«˜ã€‚' },
            { type: 'fill', q: 'å£°éŸ³çš„é«˜ä½å’Œå‘å£°ç‰©ä½“çš„____æœ‰å…³ã€‚', a: ['ç²—ç»†'], exp: 'ç²—ç»†å½±å“é¢‘ç‡ã€‚' },
            { type: 'mcq', q: 'å‰ä»–ä¸Šæ¯”è¾ƒç²—çš„å¼¦ï¼Œå¼¹æ‹¨æ—¶å‘å‡ºçš„å£°éŸ³ï¼Ÿ', opts: ['é«˜', 'ä½'], a: 1, exp: 'ç²—å¼¦ä½éŸ³ã€‚' },
            { type: 'matching', q: 'è¿çº¿ç‰©ä½“ç²—ç»†ä¸éŸ³é«˜ï¼š', pairs: [{l:'ç²—ç‰©ä½“', r:'å£°éŸ³ä½'}, {l:'ç»†ç‰©ä½“', r:'å£°éŸ³é«˜'}], exp: 'ç²—ç»†è§„å¾‹ã€‚' },
            { type: 'mcq', q: 'å°æç´çš„å››æ ¹å¼¦ç²—ç»†ä¸åŒï¼Œæœ€ç»†çš„é‚£æ ¹å¼¦å£°éŸ³æœ€ï¼Ÿ', opts: ['é«˜', 'ä½'], a: 0, exp: 'è¶Šç»†è¶Šé«˜ã€‚' },

            // 5. ç»¼åˆåº”ç”¨ (6é¢˜)
            { type: 'mcq', q: 'è¦ä½¿å°æç´å‘å‡ºçš„å£°éŸ³å˜é«˜ï¼Œå¯ä»¥ï¼Ÿ', opts: ['æŠŠå¼¦æ‹§æ¾', 'æŠŠå¼¦æ‹§ç´§', 'æ¢æ ¹ç²—å¼¦'], a: 1, exp: 'æ‹§ç´§=å˜ç´§=æŒ¯åŠ¨å¿«=é«˜éŸ³ã€‚' },
            { type: 'mcq', q: 'å‘æš–æ°´ç“¶å€’æ°´æ—¶ï¼Œéšç€æ°´è¶Šæ¥è¶Šå¤šï¼ˆç©ºæ°”æŸ±å˜çŸ­ï¼‰ï¼Œå£°éŸ³ä¼šï¼Ÿ', opts: ['å˜é«˜', 'å˜ä½', 'ä¸å˜'], a: 0, exp: 'ç©ºæ°”æŸ±å˜çŸ­=æŒ¯åŠ¨å¿«=å£°éŸ³å˜é«˜ã€‚' },
            { type: 'mcq', q: 'å¹å¥ç«–ç¬›æ—¶ï¼ŒæŒ‰ä½çš„å­”è¶Šå¤šï¼ˆç©ºæ°”æŸ±è¶Šé•¿ï¼‰ï¼Œå£°éŸ³è¶Šï¼Ÿ', opts: ['é«˜', 'ä½'], a: 1, exp: 'ç©ºæ°”æŸ±é•¿=ä½éŸ³ã€‚' },
            { type: 'mcq', q: 'åˆ¶ä½œâ€œæ°´æ¯ç´â€æ—¶ï¼Œæ°´è¶Šå¤šçš„æ¯å­æ•²å‡»æ—¶å£°éŸ³è¶Šï¼Ÿ', opts: ['é«˜', 'ä½'], a: 1, exp: 'æ•²å‡»æ—¶æ˜¯æ¯å­+æ°´æŒ¯åŠ¨ï¼Œæ°´å¤š=é‡/é•¿=æ…¢=ä½ã€‚' },
            { type: 'mcq', q: 'è¶ŠçŸ­ã€è¶Šå°ã€è¶Šå°‘ã€è¶Šç»†çš„ç‰©ä½“ï¼ŒæŒ¯åŠ¨è¶Š____ï¼Œå£°éŸ³è¶Š____ã€‚', opts: ['å¿«ï¼Œé«˜', 'æ…¢ï¼Œä½', 'å¿«ï¼Œä½'], a: 0, exp: 'æ€»ç»“æ€§è§„å¾‹ï¼šå°/çŸ­/ç»†/ç´§ = é«˜ã€‚' },
            { type: 'mcq', q: 'ä¸‹åˆ—å…³äºå£°éŸ³é«˜ä½çš„è¯´æ³•ï¼Œé”™è¯¯çš„æ˜¯ï¼Ÿ', opts: ['éŸ³é«˜ç”±æŒ¯åŠ¨å¿«æ…¢å†³å®š', 'ç‰©ä½“è¶Šé•¿å£°éŸ³è¶Šé«˜', 'ç‰©ä½“è¶Šç´§å£°éŸ³è¶Šé«˜'], a: 1, exp: 'ç‰©ä½“è¶Šé•¿å£°éŸ³åº”è¯¥è¶Šä½ã€‚' }
        ];

        // --- é€»è¾‘æ§åˆ¶ ---
        let currentQIndex = 0;
        let userScoreRaw = 0;
        let userMistakes = [];
        let selectedOption = null;
        let matchState = { left: null, right: null, matchedCount: 0, userPairs: [] };
        
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;
            if (type === 'correct') {
                osc.frequency.setValueAtTime(880, now); osc.frequency.exponentialRampToValueAtTime(1760, now + 0.15);
                gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.15);
                osc.start(now); osc.stop(now + 0.15);
            } else if (type === 'wrong') {
                osc.type = 'square'; osc.frequency.setValueAtTime(150, now); osc.frequency.linearRampToValueAtTime(100, now + 0.2);
                gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(now); osc.stop(now + 0.2);
            } else if (type === 'click') {
                osc.frequency.setValueAtTime(600, now); gain.gain.setValueAtTime(0.02, now); gain.gain.linearRampToValueAtTime(0, now + 0.05);
                osc.start(now); osc.stop(now + 0.05);
            }
        }

        function startQuiz() {
            document.getElementById('section-review').classList.remove('active');
            document.getElementById('section-quiz').classList.add('active');
            renderQuestion();
        }

        function renderQuestion() {
            const qData = quizData[currentQIndex];
            const area = document.getElementById('question-area');
            const nextBtn = document.getElementById('nextBtn');
            
            document.getElementById('q-index').innerText = currentQIndex + 1;
            document.getElementById('progressBar').style.width = ((currentQIndex) / quizData.length * 100) + "%";
            
            area.innerHTML = '';
            nextBtn.disabled = true; nextBtn.style.opacity = 0.5;
            selectedOption = null;

            const card = document.createElement('div');
            card.className = 'question-card';
            
            let tagText = qData.type === 'mcq' ? 'é€‰æ‹©é¢˜' : (qData.type === 'fill' ? 'å¡«ç©ºé¢˜' : 'è¿çº¿é¢˜');
            card.innerHTML = `<div class="q-content"><span class="q-tag">${tagText}</span>${qData.q}</div>`;

            if (qData.type === 'mcq') {
                qData.opts.forEach((opt, idx) => {
                    const btn = document.createElement('div');
                    btn.className = 'option-item'; btn.innerText = opt;
                    btn.onclick = () => selectMCQ(btn, idx);
                    card.appendChild(btn);
                });
            } else if (qData.type === 'fill') {
                const input = document.createElement('input');
                input.className = 'fill-input'; input.type = 'text'; input.placeholder = 'è¾“å…¥ç­”æ¡ˆ';
                input.oninput = (e) => {
                    selectedOption = e.target.value.trim();
                    nextBtn.disabled = !selectedOption;
                    nextBtn.style.opacity = selectedOption ? 1 : 0.5;
                };
                // æ·»åŠ å¤±ç„¦å³æ—¶åé¦ˆ
                input.onblur = () => {
                    if (selectedOption) {
                        const isCorrect = qData.a.some(ans => selectedOption.includes(ans));
                        setTimeout(() => {
                            if (isCorrect) {
                                InstantFeedback.onCorrect(input);
                            } else {
                                InstantFeedback.onWrong(input, qData.exp);
                            }
                        }, 200);
                    }
                };
                card.appendChild(input);
            } else if (qData.type === 'matching') {
                renderMatching(card, qData);
            }
            area.appendChild(card);
        }

        function selectMCQ(el, idx) {
            playSound('click');
            
            // ç§»é™¤å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.option-item').forEach(d => {
                d.classList.remove('selected', 'correct-feedback', 'wrong-feedback');
            });
            el.classList.add('selected');
            selectedOption = idx;
            
            // ç«‹å³æ£€æŸ¥ç­”æ¡ˆå¹¶ç»™å‡ºåé¦ˆ
            const qData = quizData[currentQIndex];
            let isCorrect = false;
            
            if (qData.type === 'fill') {
                if (qData.a.some(ans => idx.includes(ans))) isCorrect = true;
            } else {
                if (idx === qData.a) isCorrect = true;
            }
            
            // å»¶è¿Ÿåé¦ˆï¼Œè®©ç”¨æˆ·çœ‹åˆ°é€‰ä¸­æ•ˆæœ
            setTimeout(() => {
                if (isCorrect) {
                    InstantFeedback.onCorrect(el);
                } else {
                    InstantFeedback.onWrong(el, qData.exp);
                }
            }, 200);
            
            // å¯ç”¨ä¸‹ä¸€é¢˜æŒ‰é’®
            document.getElementById('nextBtn').disabled = false;
            document.getElementById('nextBtn').style.opacity = 1;
        }

        function renderMatching(card, qData) {
            const container = document.createElement('div');
            const leftCol = document.createElement('div'); leftCol.className = 'match-col';
            const rightCol = document.createElement('div'); rightCol.className = 'match-col';
            const row = document.createElement('div'); row.className = 'match-row';

            let rItems = [...qData.pairs].sort(()=>Math.random()-0.5);
            matchState = { left: null, right: null, matchedCount: 0, userPairs: [] };

            qData.pairs.forEach(p => {
                const btn = document.createElement('div');
                btn.className = 'match-btn'; btn.innerText = p.l; btn.dataset.val = p.l; btn.dataset.side = 'left';
                btn.onclick = (e) => handleMatchClick(e.target, qData.pairs.length);
                leftCol.appendChild(btn);
            });
            rItems.forEach(p => {
                const btn = document.createElement('div');
                btn.className = 'match-btn'; btn.innerText = p.r; btn.dataset.val = p.r; btn.dataset.side = 'right';
                btn.onclick = (e) => handleMatchClick(e.target, qData.pairs.length);
                rightCol.appendChild(btn);
            });

            row.appendChild(leftCol); row.appendChild(rightCol);
            card.appendChild(row);
        }

        function handleMatchClick(el, totalPairs) {
            playSound('click');
            const side = el.dataset.side;
            el.parentElement.querySelectorAll('.match-btn').forEach(b => b.classList.remove('selected'));
            el.classList.add('selected');
            
            if (side === 'left') matchState.left = el;
            else matchState.right = el;

            if (matchState.left && matchState.right) {
                matchState.userPairs.push({l: matchState.left.dataset.val, r: matchState.right.dataset.val});
                matchState.left.classList.remove('selected'); matchState.left.classList.add('matched');
                matchState.right.classList.remove('selected'); matchState.right.classList.add('matched');
                matchState.left = null; matchState.right = null;
                matchState.matchedCount++;
                if (matchState.matchedCount === totalPairs) {
                    document.getElementById('nextBtn').disabled = false;
                    document.getElementById('nextBtn').style.opacity = 1;
                }
            }
        }

        function nextQuestion() {
            const qData = quizData[currentQIndex];
            let isCorrect = false;
            let myAns = "";

            if (qData.type === 'mcq') {
                if (selectedOption === qData.a) isCorrect = true;
                myAns = qData.opts[selectedOption];
            } else if (qData.type === 'fill') {
                if (qData.a.some(ans => selectedOption.includes(ans))) isCorrect = true;
                myAns = selectedOption;
            } else if (qData.type === 'matching') {
                let correctCount = 0;
                matchState.userPairs.forEach(up => {
                    if (qData.pairs.some(p => p.l === up.l && p.r === up.r)) correctCount++;
                });
                if (correctCount === qData.pairs.length) isCorrect = true;
                myAns = "é…å¯¹é”™è¯¯";
            }

            if (isCorrect) {
                userScoreRaw++;
                playSound('correct');
            } else {
                playSound('wrong');
                userMistakes.push({ q: qData.q, my: myAns, exp: qData.exp });
            }

            currentQIndex++;
            if (currentQIndex < quizData.length) renderQuestion();
            else showResults();
        }

        function showResults() {
            document.getElementById('section-quiz').classList.remove('active');
            document.getElementById('section-result').classList.add('active');
            
            let finalScore = Math.round((userScoreRaw / quizData.length) * 100);
            let temp = 0;
            const scoreEl = document.getElementById('final-score');
            const timer = setInterval(() => {
                if(temp >= finalScore) { clearInterval(timer); scoreEl.innerText = finalScore; }
                else { temp++; scoreEl.innerText = temp; }
            }, 20);

            const reward = document.getElementById('reward-text');
            if(finalScore === 100) reward.innerText = "ğŸ‰ å®Œç¾ï¼ä½ æ˜¯é«˜éŸ³æ­Œå”±å®¶ï¼";
            else if(finalScore >= 80) reward.innerText = "ğŸŒŸ ä¼˜ç§€ï¼å¯¹éŸ³é«˜æŒæ¡å¾—å¾ˆæ£’ï¼";
            else reward.innerText = "ğŸ’ª åŠ æ²¹ï¼è®°ä½ï¼šçŸ­ç´§ç»†å¿«é«˜ï¼";

            if (userMistakes.length > 0) {
                const list = document.getElementById('wrong-list');
                list.style.display = 'block';
                let html = '';
                userMistakes.forEach((m, i) => {
                    html += `<div class="wrong-item"><strong>${i+1}. ${m.q}</strong><br><span style="font-size:0.9em; color:#D32F2F">ä½ çš„å›ç­”ï¼š${m.my}</span><br><span style="font-size:0.9em; color:#388E3C">ğŸ’¡ è§£æï¼š${m.exp}</span></div>`;
                });
                list.innerHTML += html;
            }
        }
    </script>
</body>
</html>